var src = 'KGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsKICAgIHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlICE9PSAndW5kZWZpbmVkJyA/IG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpIDoKICAgIHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCA/IGRlZmluZShmYWN0b3J5KSA6CiAgICAoZnVuY3Rpb24oKSB7CiAgICAJdmFyIGN1cnJlbnQgPSBnbG9iYWwuV2ViQXNzZW1ibHk7CiAgICAJdmFyIGV4cG9ydHMgPSBmYWN0b3J5KCk7CiAgICAJZ2xvYmFsLldlYkFzc2VtYmx5ID0gZXhwb3J0czsKICAgIAlleHBvcnRzLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHsgZ2xvYmFsLldlYkFzc2VtYmx5ID0gY3VycmVudDsgcmV0dXJuIGV4cG9ydHM7IH07CiAgICB9KSgpOwp9KHRoaXMsIChmdW5jdGlvbiAoKSB7ICd1c2Ugc3RyaWN0JzsKCnZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmIDoge307CgpmdW5jdGlvbiBjb21tb25qc1JlcXVpcmUgKCkgewoJdGhyb3cgbmV3IEVycm9yKCdEeW5hbWljIHJlcXVpcmVzIGFyZSBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBieSByb2xsdXAtcGx1Z2luLWNvbW1vbmpzJyk7Cn0KCgoKZnVuY3Rpb24gY3JlYXRlQ29tbW9uanNNb2R1bGUoZm4sIG1vZHVsZSkgewoJcmV0dXJuIG1vZHVsZSA9IHsgZXhwb3J0czoge30gfSwgZm4obW9kdWxlLCBtb2R1bGUuZXhwb3J0cyksIG1vZHVsZS5leHBvcnRzOwp9Cgp2YXIgbG9uZ18xID0gY3JlYXRlQ29tbW9uanNNb2R1bGUoZnVuY3Rpb24gKG1vZHVsZSkgewovKg0KIENvcHlyaWdodCAyMDEzIERhbmllbCBXaXJ0eiA8ZGNvZGVAZGNvZGUuaW8+DQogQ29weXJpZ2h0IDIwMDkgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLg0KDQogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7DQogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLg0KIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdA0KDQogaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wDQoNCiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlDQogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTLUlTIiBCQVNJUywNCiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4NCiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kDQogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuDQogKi8NCg0KLyoqDQogKiBAbGljZW5zZSBsb25nLmpzIChjKSAyMDEzIERhbmllbCBXaXJ0eiA8ZGNvZGVAZGNvZGUuaW8+DQogKiBSZWxlYXNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wDQogKiBzZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9kY29kZUlPL2xvbmcuanMgZm9yIGRldGFpbHMNCiAqLw0KKGZ1bmN0aW9uKGdsb2JhbCwgZmFjdG9yeSkgew0KDQogICAgLyogQU1EICovIGlmICh0eXBlb2YgdW5kZWZpbmVkID09PSAnZnVuY3Rpb24nICYmIHVuZGVmaW5lZFsiYW1kIl0pDQogICAgICAgIHVuZGVmaW5lZChbXSwgZmFjdG9yeSk7DQogICAgLyogQ29tbW9uSlMgKi8gZWxzZSBpZiAodHlwZW9mIGNvbW1vbmpzUmVxdWlyZSA9PT0gJ2Z1bmN0aW9uJyAmJiAnb2JqZWN0JyA9PT0gIm9iamVjdCIgJiYgbW9kdWxlICYmIG1vZHVsZVsiZXhwb3J0cyJdKQ0KICAgICAgICBtb2R1bGVbImV4cG9ydHMiXSA9IGZhY3RvcnkoKTsNCiAgICAvKiBHbG9iYWwgKi8gZWxzZQ0KICAgICAgICAoZ2xvYmFsWyJkY29kZUlPIl0gPSBnbG9iYWxbImRjb2RlSU8iXSB8fCB7fSlbIkxvbmciXSA9IGZhY3RvcnkoKTsNCg0KfSkoY29tbW9uanNHbG9iYWwsIGZ1bmN0aW9uKCkgew0KICAgICJ1c2Ugc3RyaWN0IjsNCg0KICAgIC8qKg0KICAgICAqIENvbnN0cnVjdHMgYSA2NCBiaXQgdHdvJ3MtY29tcGxlbWVudCBpbnRlZ2VyLCBnaXZlbiBpdHMgbG93IGFuZCBoaWdoIDMyIGJpdCB2YWx1ZXMgYXMgKnNpZ25lZCogaW50ZWdlcnMuDQogICAgICogIFNlZSB0aGUgZnJvbSogZnVuY3Rpb25zIGJlbG93IGZvciBtb3JlIGNvbnZlbmllbnQgd2F5cyBvZiBjb25zdHJ1Y3RpbmcgTG9uZ3MuDQogICAgICogQGV4cG9ydHMgTG9uZw0KICAgICAqIEBjbGFzcyBBIExvbmcgY2xhc3MgZm9yIHJlcHJlc2VudGluZyBhIDY0IGJpdCB0d28ncy1jb21wbGVtZW50IGludGVnZXIgdmFsdWUuDQogICAgICogQHBhcmFtIHtudW1iZXJ9IGxvdyBUaGUgbG93IChzaWduZWQpIDMyIGJpdHMgb2YgdGhlIGxvbmcNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGlnaCBUaGUgaGlnaCAoc2lnbmVkKSAzMiBiaXRzIG9mIHRoZSBsb25nDQogICAgICogQHBhcmFtIHtib29sZWFuPX0gdW5zaWduZWQgV2hldGhlciB1bnNpZ25lZCBvciBub3QsIGRlZmF1bHRzIHRvIGBmYWxzZWAgZm9yIHNpZ25lZA0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIExvbmcobG93LCBoaWdoLCB1bnNpZ25lZCkgew0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaGUgbG93IDMyIGJpdHMgYXMgYSBzaWduZWQgdmFsdWUuDQogICAgICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmxvdyA9IGxvdyB8IDA7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRoZSBoaWdoIDMyIGJpdHMgYXMgYSBzaWduZWQgdmFsdWUuDQogICAgICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmhpZ2ggPSBoaWdoIHwgMDsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogV2hldGhlciB1bnNpZ25lZCBvciBub3QuDQogICAgICAgICAqIEB0eXBlIHtib29sZWFufQ0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy51bnNpZ25lZCA9ICEhdW5zaWduZWQ7DQogICAgfQ0KDQogICAgLy8gVGhlIGludGVybmFsIHJlcHJlc2VudGF0aW9uIG9mIGEgbG9uZyBpcyB0aGUgdHdvIGdpdmVuIHNpZ25lZCwgMzItYml0IHZhbHVlcy4NCiAgICAvLyBXZSB1c2UgMzItYml0IHBpZWNlcyBiZWNhdXNlIHRoZXNlIGFyZSB0aGUgc2l6ZSBvZiBpbnRlZ2VycyBvbiB3aGljaA0KICAgIC8vIEphdmFzY3JpcHQgcGVyZm9ybXMgYml0LW9wZXJhdGlvbnMuICBGb3Igb3BlcmF0aW9ucyBsaWtlIGFkZGl0aW9uIGFuZA0KICAgIC8vIG11bHRpcGxpY2F0aW9uLCB3ZSBzcGxpdCBlYWNoIG51bWJlciBpbnRvIDE2IGJpdCBwaWVjZXMsIHdoaWNoIGNhbiBlYXNpbHkgYmUNCiAgICAvLyBtdWx0aXBsaWVkIHdpdGhpbiBKYXZhc2NyaXB0J3MgZmxvYXRpbmctcG9pbnQgcmVwcmVzZW50YXRpb24gd2l0aG91dCBvdmVyZmxvdw0KICAgIC8vIG9yIGNoYW5nZSBpbiBzaWduLg0KICAgIC8vDQogICAgLy8gSW4gdGhlIGFsZ29yaXRobXMgYmVsb3csIHdlIGZyZXF1ZW50bHkgcmVkdWNlIHRoZSBuZWdhdGl2ZSBjYXNlIHRvIHRoZQ0KICAgIC8vIHBvc2l0aXZlIGNhc2UgYnkgbmVnYXRpbmcgdGhlIGlucHV0KHMpIGFuZCB0aGVuIHBvc3QtcHJvY2Vzc2luZyB0aGUgcmVzdWx0Lg0KICAgIC8vIE5vdGUgdGhhdCB3ZSBtdXN0IEFMV0FZUyBjaGVjayBzcGVjaWFsbHkgd2hldGhlciB0aG9zZSB2YWx1ZXMgYXJlIE1JTl9WQUxVRQ0KICAgIC8vICgtMl42MykgYmVjYXVzZSAtTUlOX1ZBTFVFID09IE1JTl9WQUxVRSAoc2luY2UgMl42MyBjYW5ub3QgYmUgcmVwcmVzZW50ZWQgYXMNCiAgICAvLyBhIHBvc2l0aXZlIG51bWJlciwgaXQgb3ZlcmZsb3dzIGJhY2sgaW50byBhIG5lZ2F0aXZlKS4gIE5vdCBoYW5kbGluZyB0aGlzDQogICAgLy8gY2FzZSB3b3VsZCBvZnRlbiByZXN1bHQgaW4gaW5maW5pdGUgcmVjdXJzaW9uLg0KICAgIC8vDQogICAgLy8gQ29tbW9uIGNvbnN0YW50IHZhbHVlcyBaRVJPLCBPTkUsIE5FR19PTkUsIGV0Yy4gYXJlIGRlZmluZWQgYmVsb3cgdGhlIGZyb20qDQogICAgLy8gbWV0aG9kcyBvbiB3aGljaCB0aGV5IGRlcGVuZC4NCg0KICAgIC8qKg0KICAgICAqIEFuIGluZGljYXRvciB1c2VkIHRvIHJlbGlhYmx5IGRldGVybWluZSBpZiBhbiBvYmplY3QgaXMgYSBMb25nIG9yIG5vdC4NCiAgICAgKiBAdHlwZSB7Ym9vbGVhbn0NCiAgICAgKiBAY29uc3QNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIExvbmcucHJvdG90eXBlLl9faXNMb25nX187DQoNCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTG9uZy5wcm90b3R5cGUsICJfX2lzTG9uZ19fIiwgew0KICAgICAgICB2YWx1ZTogdHJ1ZSwNCiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsDQogICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UNCiAgICB9KTsNCg0KICAgIC8qKg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7Kn0gb2JqIE9iamVjdA0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzTG9uZyhvYmopIHsNCiAgICAgICAgcmV0dXJuIChvYmogJiYgb2JqWyJfX2lzTG9uZ19fIl0pID09PSB0cnVlOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoZSBzcGVjaWZpZWQgb2JqZWN0IGlzIGEgTG9uZy4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyp9IG9iaiBPYmplY3QNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKi8NCiAgICBMb25nLmlzTG9uZyA9IGlzTG9uZzsNCg0KICAgIC8qKg0KICAgICAqIEEgY2FjaGUgb2YgdGhlIExvbmcgcmVwcmVzZW50YXRpb25zIG9mIHNtYWxsIGludGVnZXIgdmFsdWVzLg0KICAgICAqIEB0eXBlIHshT2JqZWN0fQ0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIHZhciBJTlRfQ0FDSEUgPSB7fTsNCg0KICAgIC8qKg0KICAgICAqIEEgY2FjaGUgb2YgdGhlIExvbmcgcmVwcmVzZW50YXRpb25zIG9mIHNtYWxsIHVuc2lnbmVkIGludGVnZXIgdmFsdWVzLg0KICAgICAqIEB0eXBlIHshT2JqZWN0fQ0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIHZhciBVSU5UX0NBQ0hFID0ge307DQoNCiAgICAvKioNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW49fSB1bnNpZ25lZA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmcm9tSW50KHZhbHVlLCB1bnNpZ25lZCkgew0KICAgICAgICB2YXIgb2JqLCBjYWNoZWRPYmosIGNhY2hlOw0KICAgICAgICBpZiAodW5zaWduZWQpIHsNCiAgICAgICAgICAgIHZhbHVlID4+Pj0gMDsNCiAgICAgICAgICAgIGlmIChjYWNoZSA9ICgwIDw9IHZhbHVlICYmIHZhbHVlIDwgMjU2KSkgew0KICAgICAgICAgICAgICAgIGNhY2hlZE9iaiA9IFVJTlRfQ0FDSEVbdmFsdWVdOw0KICAgICAgICAgICAgICAgIGlmIChjYWNoZWRPYmopDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWNoZWRPYmo7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvYmogPSBmcm9tQml0cyh2YWx1ZSwgKHZhbHVlIHwgMCkgPCAwID8gLTEgOiAwLCB0cnVlKTsNCiAgICAgICAgICAgIGlmIChjYWNoZSkNCiAgICAgICAgICAgICAgICBVSU5UX0NBQ0hFW3ZhbHVlXSA9IG9iajsNCiAgICAgICAgICAgIHJldHVybiBvYmo7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICB2YWx1ZSB8PSAwOw0KICAgICAgICAgICAgaWYgKGNhY2hlID0gKC0xMjggPD0gdmFsdWUgJiYgdmFsdWUgPCAxMjgpKSB7DQogICAgICAgICAgICAgICAgY2FjaGVkT2JqID0gSU5UX0NBQ0hFW3ZhbHVlXTsNCiAgICAgICAgICAgICAgICBpZiAoY2FjaGVkT2JqKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVkT2JqOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgb2JqID0gZnJvbUJpdHModmFsdWUsIHZhbHVlIDwgMCA/IC0xIDogMCwgZmFsc2UpOw0KICAgICAgICAgICAgaWYgKGNhY2hlKQ0KICAgICAgICAgICAgICAgIElOVF9DQUNIRVt2YWx1ZV0gPSBvYmo7DQogICAgICAgICAgICByZXR1cm4gb2JqOw0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJucyBhIExvbmcgcmVwcmVzZW50aW5nIHRoZSBnaXZlbiAzMiBiaXQgaW50ZWdlciB2YWx1ZS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIDMyIGJpdCBpbnRlZ2VyIGluIHF1ZXN0aW9uDQogICAgICogQHBhcmFtIHtib29sZWFuPX0gdW5zaWduZWQgV2hldGhlciB1bnNpZ25lZCBvciBub3QsIGRlZmF1bHRzIHRvIGBmYWxzZWAgZm9yIHNpZ25lZA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gVGhlIGNvcnJlc3BvbmRpbmcgTG9uZyB2YWx1ZQ0KICAgICAqLw0KICAgIExvbmcuZnJvbUludCA9IGZyb21JbnQ7DQoNCiAgICAvKioNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW49fSB1bnNpZ25lZA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmcm9tTnVtYmVyKHZhbHVlLCB1bnNpZ25lZCkgew0KICAgICAgICBpZiAoaXNOYU4odmFsdWUpIHx8ICFpc0Zpbml0ZSh2YWx1ZSkpDQogICAgICAgICAgICByZXR1cm4gdW5zaWduZWQgPyBVWkVSTyA6IFpFUk87DQogICAgICAgIGlmICh1bnNpZ25lZCkgew0KICAgICAgICAgICAgaWYgKHZhbHVlIDwgMCkNCiAgICAgICAgICAgICAgICByZXR1cm4gVVpFUk87DQogICAgICAgICAgICBpZiAodmFsdWUgPj0gVFdPX1BXUl82NF9EQkwpDQogICAgICAgICAgICAgICAgcmV0dXJuIE1BWF9VTlNJR05FRF9WQUxVRTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIGlmICh2YWx1ZSA8PSAtVFdPX1BXUl82M19EQkwpDQogICAgICAgICAgICAgICAgcmV0dXJuIE1JTl9WQUxVRTsNCiAgICAgICAgICAgIGlmICh2YWx1ZSArIDEgPj0gVFdPX1BXUl82M19EQkwpDQogICAgICAgICAgICAgICAgcmV0dXJuIE1BWF9WQUxVRTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodmFsdWUgPCAwKQ0KICAgICAgICAgICAgcmV0dXJuIGZyb21OdW1iZXIoLXZhbHVlLCB1bnNpZ25lZCkubmVnKCk7DQogICAgICAgIHJldHVybiBmcm9tQml0cygodmFsdWUgJSBUV09fUFdSXzMyX0RCTCkgfCAwLCAodmFsdWUgLyBUV09fUFdSXzMyX0RCTCkgfCAwLCB1bnNpZ25lZCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJucyBhIExvbmcgcmVwcmVzZW50aW5nIHRoZSBnaXZlbiB2YWx1ZSwgcHJvdmlkZWQgdGhhdCBpdCBpcyBhIGZpbml0ZSBudW1iZXIuIE90aGVyd2lzZSwgemVybyBpcyByZXR1cm5lZC4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge251bWJlcn0gdmFsdWUgVGhlIG51bWJlciBpbiBxdWVzdGlvbg0KICAgICAqIEBwYXJhbSB7Ym9vbGVhbj19IHVuc2lnbmVkIFdoZXRoZXIgdW5zaWduZWQgb3Igbm90LCBkZWZhdWx0cyB0byBgZmFsc2VgIGZvciBzaWduZWQNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFRoZSBjb3JyZXNwb25kaW5nIExvbmcgdmFsdWUNCiAgICAgKi8NCiAgICBMb25nLmZyb21OdW1iZXIgPSBmcm9tTnVtYmVyOw0KDQogICAgLyoqDQogICAgICogQHBhcmFtIHtudW1iZXJ9IGxvd0JpdHMNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGlnaEJpdHMNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW49fSB1bnNpZ25lZA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmcm9tQml0cyhsb3dCaXRzLCBoaWdoQml0cywgdW5zaWduZWQpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBMb25nKGxvd0JpdHMsIGhpZ2hCaXRzLCB1bnNpZ25lZCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogUmV0dXJucyBhIExvbmcgcmVwcmVzZW50aW5nIHRoZSA2NCBiaXQgaW50ZWdlciB0aGF0IGNvbWVzIGJ5IGNvbmNhdGVuYXRpbmcgdGhlIGdpdmVuIGxvdyBhbmQgaGlnaCBiaXRzLiBFYWNoIGlzDQogICAgICogIGFzc3VtZWQgdG8gdXNlIDMyIGJpdHMuDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IGxvd0JpdHMgVGhlIGxvdyAzMiBiaXRzDQogICAgICogQHBhcmFtIHtudW1iZXJ9IGhpZ2hCaXRzIFRoZSBoaWdoIDMyIGJpdHMNCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW49fSB1bnNpZ25lZCBXaGV0aGVyIHVuc2lnbmVkIG9yIG5vdCwgZGVmYXVsdHMgdG8gYGZhbHNlYCBmb3Igc2lnbmVkDQogICAgICogQHJldHVybnMgeyFMb25nfSBUaGUgY29ycmVzcG9uZGluZyBMb25nIHZhbHVlDQogICAgICovDQogICAgTG9uZy5mcm9tQml0cyA9IGZyb21CaXRzOw0KDQogICAgLyoqDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtudW1iZXJ9IGJhc2UNCiAgICAgKiBAcGFyYW0ge251bWJlcn0gZXhwb25lbnQNCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfQ0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIHZhciBwb3dfZGJsID0gTWF0aC5wb3c7IC8vIFVzZWQgNCB0aW1lcyAoNCo4IHRvIDE1KzQpDQoNCiAgICAvKioNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyDQogICAgICogQHBhcmFtIHsoYm9vbGVhbnxudW1iZXIpPX0gdW5zaWduZWQNCiAgICAgKiBAcGFyYW0ge251bWJlcj19IHJhZGl4DQogICAgICogQHJldHVybnMgeyFMb25nfQ0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGZyb21TdHJpbmcoc3RyLCB1bnNpZ25lZCwgcmFkaXgpIHsNCiAgICAgICAgaWYgKHN0ci5sZW5ndGggPT09IDApDQogICAgICAgICAgICB0aHJvdyBFcnJvcignZW1wdHkgc3RyaW5nJyk7DQogICAgICAgIGlmIChzdHIgPT09ICJOYU4iIHx8IHN0ciA9PT0gIkluZmluaXR5IiB8fCBzdHIgPT09ICIrSW5maW5pdHkiIHx8IHN0ciA9PT0gIi1JbmZpbml0eSIpDQogICAgICAgICAgICByZXR1cm4gWkVSTzsNCiAgICAgICAgaWYgKHR5cGVvZiB1bnNpZ25lZCA9PT0gJ251bWJlcicpIHsNCiAgICAgICAgICAgIC8vIEZvciBnb29nLm1hdGgubG9uZyBjb21wYXRpYmlsaXR5DQogICAgICAgICAgICByYWRpeCA9IHVuc2lnbmVkLA0KICAgICAgICAgICAgdW5zaWduZWQgPSBmYWxzZTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHVuc2lnbmVkID0gISEgdW5zaWduZWQ7DQogICAgICAgIH0NCiAgICAgICAgcmFkaXggPSByYWRpeCB8fCAxMDsNCiAgICAgICAgaWYgKHJhZGl4IDwgMiB8fCAzNiA8IHJhZGl4KQ0KICAgICAgICAgICAgdGhyb3cgUmFuZ2VFcnJvcigncmFkaXgnKTsNCg0KICAgICAgICB2YXIgcDsNCiAgICAgICAgaWYgKChwID0gc3RyLmluZGV4T2YoJy0nKSkgPiAwKQ0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ2ludGVyaW9yIGh5cGhlbicpOw0KICAgICAgICBlbHNlIGlmIChwID09PSAwKSB7DQogICAgICAgICAgICByZXR1cm4gZnJvbVN0cmluZyhzdHIuc3Vic3RyaW5nKDEpLCB1bnNpZ25lZCwgcmFkaXgpLm5lZygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRG8gc2V2ZXJhbCAoOCkgZGlnaXRzIGVhY2ggdGltZSB0aHJvdWdoIHRoZSBsb29wLCBzbyBhcyB0bw0KICAgICAgICAvLyBtaW5pbWl6ZSB0aGUgY2FsbHMgdG8gdGhlIHZlcnkgZXhwZW5zaXZlIGVtdWxhdGVkIGRpdi4NCiAgICAgICAgdmFyIHJhZGl4VG9Qb3dlciA9IGZyb21OdW1iZXIocG93X2RibChyYWRpeCwgOCkpOw0KDQogICAgICAgIHZhciByZXN1bHQgPSBaRVJPOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkgKz0gOCkgew0KICAgICAgICAgICAgdmFyIHNpemUgPSBNYXRoLm1pbig4LCBzdHIubGVuZ3RoIC0gaSksDQogICAgICAgICAgICAgICAgdmFsdWUgPSBwYXJzZUludChzdHIuc3Vic3RyaW5nKGksIGkgKyBzaXplKSwgcmFkaXgpOw0KICAgICAgICAgICAgaWYgKHNpemUgPCA4KSB7DQogICAgICAgICAgICAgICAgdmFyIHBvd2VyID0gZnJvbU51bWJlcihwb3dfZGJsKHJhZGl4LCBzaXplKSk7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0Lm11bChwb3dlcikuYWRkKGZyb21OdW1iZXIodmFsdWUpKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0Lm11bChyYWRpeFRvUG93ZXIpOw0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5hZGQoZnJvbU51bWJlcih2YWx1ZSkpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIHJlc3VsdC51bnNpZ25lZCA9IHVuc2lnbmVkOw0KICAgICAgICByZXR1cm4gcmVzdWx0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBMb25nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBzdHJpbmcsIHdyaXR0ZW4gdXNpbmcgdGhlIHNwZWNpZmllZCByYWRpeC4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gc3RyIFRoZSB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBMb25nDQogICAgICogQHBhcmFtIHsoYm9vbGVhbnxudW1iZXIpPX0gdW5zaWduZWQgV2hldGhlciB1bnNpZ25lZCBvciBub3QsIGRlZmF1bHRzIHRvIGBmYWxzZWAgZm9yIHNpZ25lZA0KICAgICAqIEBwYXJhbSB7bnVtYmVyPX0gcmFkaXggVGhlIHJhZGl4IGluIHdoaWNoIHRoZSB0ZXh0IGlzIHdyaXR0ZW4gKDItMzYpLCBkZWZhdWx0cyB0byAxMA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gVGhlIGNvcnJlc3BvbmRpbmcgTG9uZyB2YWx1ZQ0KICAgICAqLw0KICAgIExvbmcuZnJvbVN0cmluZyA9IGZyb21TdHJpbmc7DQoNCiAgICAvKioNCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd8IXtsb3c6IG51bWJlciwgaGlnaDogbnVtYmVyLCB1bnNpZ25lZDogYm9vbGVhbn19IHZhbA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBmcm9tVmFsdWUodmFsKSB7DQogICAgICAgIGlmICh2YWwgLyogaXMgY29tcGF0aWJsZSAqLyBpbnN0YW5jZW9mIExvbmcpDQogICAgICAgICAgICByZXR1cm4gdmFsOw0KICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ251bWJlcicpDQogICAgICAgICAgICByZXR1cm4gZnJvbU51bWJlcih2YWwpOw0KICAgICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpDQogICAgICAgICAgICByZXR1cm4gZnJvbVN0cmluZyh2YWwpOw0KICAgICAgICAvLyBUaHJvd3MgZm9yIG5vbi1vYmplY3RzLCBjb252ZXJ0cyBub24taW5zdGFuY2VvZiBMb25nOg0KICAgICAgICByZXR1cm4gZnJvbUJpdHModmFsLmxvdywgdmFsLmhpZ2gsIHZhbC51bnNpZ25lZCk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ29udmVydHMgdGhlIHNwZWNpZmllZCB2YWx1ZSB0byBhIExvbmcuDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfCF7bG93OiBudW1iZXIsIGhpZ2g6IG51bWJlciwgdW5zaWduZWQ6IGJvb2xlYW59fSB2YWwgVmFsdWUNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9DQogICAgICovDQogICAgTG9uZy5mcm9tVmFsdWUgPSBmcm9tVmFsdWU7DQoNCiAgICAvLyBOT1RFOiB0aGUgY29tcGlsZXIgc2hvdWxkIGlubGluZSB0aGVzZSBjb25zdGFudCB2YWx1ZXMgYmVsb3cgYW5kIHRoZW4gcmVtb3ZlIHRoZXNlIHZhcmlhYmxlcywgc28gdGhlcmUgc2hvdWxkIGJlDQogICAgLy8gbm8gcnVudGltZSBwZW5hbHR5IGZvciB0aGVzZS4NCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQGNvbnN0DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFRXT19QV1JfMTZfREJMID0gMSA8PCAxNjsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQGNvbnN0DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFRXT19QV1JfMjRfREJMID0gMSA8PCAyNDsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQGNvbnN0DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFRXT19QV1JfMzJfREJMID0gVFdPX1BXUl8xNl9EQkwgKiBUV09fUFdSXzE2X0RCTDsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQGNvbnN0DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFRXT19QV1JfNjRfREJMID0gVFdPX1BXUl8zMl9EQkwgKiBUV09fUFdSXzMyX0RCTDsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHtudW1iZXJ9DQogICAgICogQGNvbnN0DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFRXT19QV1JfNjNfREJMID0gVFdPX1BXUl82NF9EQkwgLyAyOw0KDQogICAgLyoqDQogICAgICogQHR5cGUgeyFMb25nfQ0KICAgICAqIEBjb25zdA0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIHZhciBUV09fUFdSXzI0ID0gZnJvbUludChUV09fUFdSXzI0X0RCTCk7DQoNCiAgICAvKioNCiAgICAgKiBAdHlwZSB7IUxvbmd9DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFpFUk8gPSBmcm9tSW50KDApOw0KDQogICAgLyoqDQogICAgICogU2lnbmVkIHplcm8uDQogICAgICogQHR5cGUgeyFMb25nfQ0KICAgICAqLw0KICAgIExvbmcuWkVSTyA9IFpFUk87DQoNCiAgICAvKioNCiAgICAgKiBAdHlwZSB7IUxvbmd9DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIFVaRVJPID0gZnJvbUludCgwLCB0cnVlKTsNCg0KICAgIC8qKg0KICAgICAqIFVuc2lnbmVkIHplcm8uDQogICAgICogQHR5cGUgeyFMb25nfQ0KICAgICAqLw0KICAgIExvbmcuVVpFUk8gPSBVWkVSTzsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICB2YXIgT05FID0gZnJvbUludCgxKTsNCg0KICAgIC8qKg0KICAgICAqIFNpZ25lZCBvbmUuDQogICAgICogQHR5cGUgeyFMb25nfQ0KICAgICAqLw0KICAgIExvbmcuT05FID0gT05FOw0KDQogICAgLyoqDQogICAgICogQHR5cGUgeyFMb25nfQ0KICAgICAqIEBpbm5lcg0KICAgICAqLw0KICAgIHZhciBVT05FID0gZnJvbUludCgxLCB0cnVlKTsNCg0KICAgIC8qKg0KICAgICAqIFVuc2lnbmVkIG9uZS4NCiAgICAgKiBAdHlwZSB7IUxvbmd9DQogICAgICovDQogICAgTG9uZy5VT05FID0gVU9ORTsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICB2YXIgTkVHX09ORSA9IGZyb21JbnQoLTEpOw0KDQogICAgLyoqDQogICAgICogU2lnbmVkIG5lZ2F0aXZlIG9uZS4NCiAgICAgKiBAdHlwZSB7IUxvbmd9DQogICAgICovDQogICAgTG9uZy5ORUdfT05FID0gTkVHX09ORTsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICB2YXIgTUFYX1ZBTFVFID0gZnJvbUJpdHMoMHhGRkZGRkZGRnwwLCAweDdGRkZGRkZGfDAsIGZhbHNlKTsNCg0KICAgIC8qKg0KICAgICAqIE1heGltdW0gc2lnbmVkIHZhbHVlLg0KICAgICAqIEB0eXBlIHshTG9uZ30NCiAgICAgKi8NCiAgICBMb25nLk1BWF9WQUxVRSA9IE1BWF9WQUxVRTsNCg0KICAgIC8qKg0KICAgICAqIEB0eXBlIHshTG9uZ30NCiAgICAgKiBAaW5uZXINCiAgICAgKi8NCiAgICB2YXIgTUFYX1VOU0lHTkVEX1ZBTFVFID0gZnJvbUJpdHMoMHhGRkZGRkZGRnwwLCAweEZGRkZGRkZGfDAsIHRydWUpOw0KDQogICAgLyoqDQogICAgICogTWF4aW11bSB1bnNpZ25lZCB2YWx1ZS4NCiAgICAgKiBAdHlwZSB7IUxvbmd9DQogICAgICovDQogICAgTG9uZy5NQVhfVU5TSUdORURfVkFMVUUgPSBNQVhfVU5TSUdORURfVkFMVUU7DQoNCiAgICAvKioNCiAgICAgKiBAdHlwZSB7IUxvbmd9DQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIE1JTl9WQUxVRSA9IGZyb21CaXRzKDAsIDB4ODAwMDAwMDB8MCwgZmFsc2UpOw0KDQogICAgLyoqDQogICAgICogTWluaW11bSBzaWduZWQgdmFsdWUuDQogICAgICogQHR5cGUgeyFMb25nfQ0KICAgICAqLw0KICAgIExvbmcuTUlOX1ZBTFVFID0gTUlOX1ZBTFVFOw0KDQogICAgLyoqDQogICAgICogQGFsaWFzIExvbmcucHJvdG90eXBlDQogICAgICogQGlubmVyDQogICAgICovDQogICAgdmFyIExvbmdQcm90b3R5cGUgPSBMb25nLnByb3RvdHlwZTsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoZSBMb25nIHRvIGEgMzIgYml0IGludGVnZXIsIGFzc3VtaW5nIGl0IGlzIGEgMzIgYml0IGludGVnZXIuDQogICAgICogQHJldHVybnMge251bWJlcn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnRvSW50ID0gZnVuY3Rpb24gdG9JbnQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnVuc2lnbmVkID8gdGhpcy5sb3cgPj4+IDAgOiB0aGlzLmxvdzsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ29udmVydHMgdGhlIExvbmcgdG8gYSB0aGUgbmVhcmVzdCBmbG9hdGluZy1wb2ludCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHZhbHVlIChkb3VibGUsIDUzIGJpdCBtYW50aXNzYSkuDQogICAgICogQHJldHVybnMge251bWJlcn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnRvTnVtYmVyID0gZnVuY3Rpb24gdG9OdW1iZXIoKSB7DQogICAgICAgIGlmICh0aGlzLnVuc2lnbmVkKQ0KICAgICAgICAgICAgcmV0dXJuICgodGhpcy5oaWdoID4+PiAwKSAqIFRXT19QV1JfMzJfREJMKSArICh0aGlzLmxvdyA+Pj4gMCk7DQogICAgICAgIHJldHVybiB0aGlzLmhpZ2ggKiBUV09fUFdSXzMyX0RCTCArICh0aGlzLmxvdyA+Pj4gMCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoZSBMb25nIHRvIGEgc3RyaW5nIHdyaXR0ZW4gaW4gdGhlIHNwZWNpZmllZCByYWRpeC4NCiAgICAgKiBAcGFyYW0ge251bWJlcj19IHJhZGl4IFJhZGl4ICgyLTM2KSwgZGVmYXVsdHMgdG8gMTANCiAgICAgKiBAcmV0dXJucyB7c3RyaW5nfQ0KICAgICAqIEBvdmVycmlkZQ0KICAgICAqIEB0aHJvd3Mge1JhbmdlRXJyb3J9IElmIGByYWRpeGAgaXMgb3V0IG9mIHJhbmdlDQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uIHRvU3RyaW5nKHJhZGl4KSB7DQogICAgICAgIHJhZGl4ID0gcmFkaXggfHwgMTA7DQogICAgICAgIGlmIChyYWRpeCA8IDIgfHwgMzYgPCByYWRpeCkNCiAgICAgICAgICAgIHRocm93IFJhbmdlRXJyb3IoJ3JhZGl4Jyk7DQogICAgICAgIGlmICh0aGlzLmlzWmVybygpKQ0KICAgICAgICAgICAgcmV0dXJuICcwJzsNCiAgICAgICAgaWYgKHRoaXMuaXNOZWdhdGl2ZSgpKSB7IC8vIFVuc2lnbmVkIExvbmdzIGFyZSBuZXZlciBuZWdhdGl2ZQ0KICAgICAgICAgICAgaWYgKHRoaXMuZXEoTUlOX1ZBTFVFKSkgew0KICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY2hhbmdlIHRoZSBMb25nIHZhbHVlIGJlZm9yZSBpdCBjYW4gYmUgbmVnYXRlZCwgc28gd2UgcmVtb3ZlDQogICAgICAgICAgICAgICAgLy8gdGhlIGJvdHRvbS1tb3N0IGRpZ2l0IGluIHRoaXMgYmFzZSBhbmQgdGhlbiByZWN1cnNlIHRvIGRvIHRoZSByZXN0Lg0KICAgICAgICAgICAgICAgIHZhciByYWRpeExvbmcgPSBmcm9tTnVtYmVyKHJhZGl4KSwNCiAgICAgICAgICAgICAgICAgICAgZGl2ID0gdGhpcy5kaXYocmFkaXhMb25nKSwNCiAgICAgICAgICAgICAgICAgICAgcmVtMSA9IGRpdi5tdWwocmFkaXhMb25nKS5zdWIodGhpcyk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGRpdi50b1N0cmluZyhyYWRpeCkgKyByZW0xLnRvSW50KCkudG9TdHJpbmcocmFkaXgpOw0KICAgICAgICAgICAgfSBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuICctJyArIHRoaXMubmVnKCkudG9TdHJpbmcocmFkaXgpOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gRG8gc2V2ZXJhbCAoNikgZGlnaXRzIGVhY2ggdGltZSB0aHJvdWdoIHRoZSBsb29wLCBzbyBhcyB0bw0KICAgICAgICAvLyBtaW5pbWl6ZSB0aGUgY2FsbHMgdG8gdGhlIHZlcnkgZXhwZW5zaXZlIGVtdWxhdGVkIGRpdi4NCiAgICAgICAgdmFyIHJhZGl4VG9Qb3dlciA9IGZyb21OdW1iZXIocG93X2RibChyYWRpeCwgNiksIHRoaXMudW5zaWduZWQpLA0KICAgICAgICAgICAgcmVtID0gdGhpczsNCiAgICAgICAgdmFyIHJlc3VsdCA9ICcnOw0KICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgICAgdmFyIHJlbURpdiA9IHJlbS5kaXYocmFkaXhUb1Bvd2VyKSwNCiAgICAgICAgICAgICAgICBpbnR2YWwgPSByZW0uc3ViKHJlbURpdi5tdWwocmFkaXhUb1Bvd2VyKSkudG9JbnQoKSA+Pj4gMCwNCiAgICAgICAgICAgICAgICBkaWdpdHMgPSBpbnR2YWwudG9TdHJpbmcocmFkaXgpOw0KICAgICAgICAgICAgcmVtID0gcmVtRGl2Ow0KICAgICAgICAgICAgaWYgKHJlbS5pc1plcm8oKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZGlnaXRzICsgcmVzdWx0Ow0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgd2hpbGUgKGRpZ2l0cy5sZW5ndGggPCA2KQ0KICAgICAgICAgICAgICAgICAgICBkaWdpdHMgPSAnMCcgKyBkaWdpdHM7DQogICAgICAgICAgICAgICAgcmVzdWx0ID0gJycgKyBkaWdpdHMgKyByZXN1bHQ7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgaGlnaCAzMiBiaXRzIGFzIGEgc2lnbmVkIGludGVnZXIuDQogICAgICogQHJldHVybnMge251bWJlcn0gU2lnbmVkIGhpZ2ggYml0cw0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuZ2V0SGlnaEJpdHMgPSBmdW5jdGlvbiBnZXRIaWdoQml0cygpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaGlnaDsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgaGlnaCAzMiBiaXRzIGFzIGFuIHVuc2lnbmVkIGludGVnZXIuDQogICAgICogQHJldHVybnMge251bWJlcn0gVW5zaWduZWQgaGlnaCBiaXRzDQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5nZXRIaWdoQml0c1Vuc2lnbmVkID0gZnVuY3Rpb24gZ2V0SGlnaEJpdHNVbnNpZ25lZCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaGlnaCA+Pj4gMDsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogR2V0cyB0aGUgbG93IDMyIGJpdHMgYXMgYSBzaWduZWQgaW50ZWdlci4NCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBTaWduZWQgbG93IGJpdHMNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmdldExvd0JpdHMgPSBmdW5jdGlvbiBnZXRMb3dCaXRzKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5sb3c7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIEdldHMgdGhlIGxvdyAzMiBiaXRzIGFzIGFuIHVuc2lnbmVkIGludGVnZXIuDQogICAgICogQHJldHVybnMge251bWJlcn0gVW5zaWduZWQgbG93IGJpdHMNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmdldExvd0JpdHNVbnNpZ25lZCA9IGZ1bmN0aW9uIGdldExvd0JpdHNVbnNpZ25lZCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMubG93ID4+PiAwOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBHZXRzIHRoZSBudW1iZXIgb2YgYml0cyBuZWVkZWQgdG8gcmVwcmVzZW50IHRoZSBhYnNvbHV0ZSB2YWx1ZSBvZiB0aGlzIExvbmcuDQogICAgICogQHJldHVybnMge251bWJlcn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmdldE51bUJpdHNBYnMgPSBmdW5jdGlvbiBnZXROdW1CaXRzQWJzKCkgew0KICAgICAgICBpZiAodGhpcy5pc05lZ2F0aXZlKCkpIC8vIFVuc2lnbmVkIExvbmdzIGFyZSBuZXZlciBuZWdhdGl2ZQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZXEoTUlOX1ZBTFVFKSA/IDY0IDogdGhpcy5uZWcoKS5nZXROdW1CaXRzQWJzKCk7DQogICAgICAgIHZhciB2YWwgPSB0aGlzLmhpZ2ggIT0gMCA/IHRoaXMuaGlnaCA6IHRoaXMubG93Ow0KICAgICAgICBmb3IgKHZhciBiaXQgPSAzMTsgYml0ID4gMDsgYml0LS0pDQogICAgICAgICAgICBpZiAoKHZhbCAmICgxIDw8IGJpdCkpICE9IDApDQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgIHJldHVybiB0aGlzLmhpZ2ggIT0gMCA/IGJpdCArIDMzIDogYml0ICsgMTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogVGVzdHMgaWYgdGhpcyBMb25nJ3MgdmFsdWUgZXF1YWxzIHplcm8uDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5pc1plcm8gPSBmdW5jdGlvbiBpc1plcm8oKSB7DQogICAgICAgIHJldHVybiB0aGlzLmhpZ2ggPT09IDAgJiYgdGhpcy5sb3cgPT09IDA7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGlzIG5lZ2F0aXZlLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuaXNOZWdhdGl2ZSA9IGZ1bmN0aW9uIGlzTmVnYXRpdmUoKSB7DQogICAgICAgIHJldHVybiAhdGhpcy51bnNpZ25lZCAmJiB0aGlzLmhpZ2ggPCAwOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUZXN0cyBpZiB0aGlzIExvbmcncyB2YWx1ZSBpcyBwb3NpdGl2ZS4NCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmlzUG9zaXRpdmUgPSBmdW5jdGlvbiBpc1Bvc2l0aXZlKCkgew0KICAgICAgICByZXR1cm4gdGhpcy51bnNpZ25lZCB8fCB0aGlzLmhpZ2ggPj0gMDsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogVGVzdHMgaWYgdGhpcyBMb25nJ3MgdmFsdWUgaXMgb2RkLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuaXNPZGQgPSBmdW5jdGlvbiBpc09kZCgpIHsNCiAgICAgICAgcmV0dXJuICh0aGlzLmxvdyAmIDEpID09PSAxOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUZXN0cyBpZiB0aGlzIExvbmcncyB2YWx1ZSBpcyBldmVuLg0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuaXNFdmVuID0gZnVuY3Rpb24gaXNFdmVuKCkgew0KICAgICAgICByZXR1cm4gKHRoaXMubG93ICYgMSkgPT09IDA7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGVxdWFscyB0aGUgc3BlY2lmaWVkJ3MuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBvdGhlciBPdGhlciB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuZXF1YWxzID0gZnVuY3Rpb24gZXF1YWxzKG90aGVyKSB7DQogICAgICAgIGlmICghaXNMb25nKG90aGVyKSkNCiAgICAgICAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsNCiAgICAgICAgaWYgKHRoaXMudW5zaWduZWQgIT09IG90aGVyLnVuc2lnbmVkICYmICh0aGlzLmhpZ2ggPj4+IDMxKSA9PT0gMSAmJiAob3RoZXIuaGlnaCA+Pj4gMzEpID09PSAxKQ0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICByZXR1cm4gdGhpcy5oaWdoID09PSBvdGhlci5oaWdoICYmIHRoaXMubG93ID09PSBvdGhlci5sb3c7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGVxdWFscyB0aGUgc3BlY2lmaWVkJ3MuIFRoaXMgaXMgYW4gYWxpYXMgb2Yge0BsaW5rIExvbmcjZXF1YWxzfS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIHZhbHVlDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5lcSA9IExvbmdQcm90b3R5cGUuZXF1YWxzOw0KDQogICAgLyoqDQogICAgICogVGVzdHMgaWYgdGhpcyBMb25nJ3MgdmFsdWUgZGlmZmVycyBmcm9tIHRoZSBzcGVjaWZpZWQncy4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIHZhbHVlDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5ub3RFcXVhbHMgPSBmdW5jdGlvbiBub3RFcXVhbHMob3RoZXIpIHsNCiAgICAgICAgcmV0dXJuICF0aGlzLmVxKC8qIHZhbGlkYXRlcyAqLyBvdGhlcik7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGRpZmZlcnMgZnJvbSB0aGUgc3BlY2lmaWVkJ3MuIFRoaXMgaXMgYW4gYWxpYXMgb2Yge0BsaW5rIExvbmcjbm90RXF1YWxzfS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIHZhbHVlDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5uZXEgPSBMb25nUHJvdG90eXBlLm5vdEVxdWFsczsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGlzIGxlc3MgdGhhbiB0aGUgc3BlY2lmaWVkJ3MuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBvdGhlciBPdGhlciB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUubGVzc1RoYW4gPSBmdW5jdGlvbiBsZXNzVGhhbihvdGhlcikgew0KICAgICAgICByZXR1cm4gdGhpcy5jb21wKC8qIHZhbGlkYXRlcyAqLyBvdGhlcikgPCAwOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUZXN0cyBpZiB0aGlzIExvbmcncyB2YWx1ZSBpcyBsZXNzIHRoYW4gdGhlIHNwZWNpZmllZCdzLiBUaGlzIGlzIGFuIGFsaWFzIG9mIHtAbGluayBMb25nI2xlc3NUaGFufS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIHZhbHVlDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5sdCA9IExvbmdQcm90b3R5cGUubGVzc1RoYW47DQoNCiAgICAvKioNCiAgICAgKiBUZXN0cyBpZiB0aGlzIExvbmcncyB2YWx1ZSBpcyBsZXNzIHRoYW4gb3IgZXF1YWwgdGhlIHNwZWNpZmllZCdzLg0KICAgICAqIEBwYXJhbSB7IUxvbmd8bnVtYmVyfHN0cmluZ30gb3RoZXIgT3RoZXIgdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmxlc3NUaGFuT3JFcXVhbCA9IGZ1bmN0aW9uIGxlc3NUaGFuT3JFcXVhbChvdGhlcikgew0KICAgICAgICByZXR1cm4gdGhpcy5jb21wKC8qIHZhbGlkYXRlcyAqLyBvdGhlcikgPD0gMDsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogVGVzdHMgaWYgdGhpcyBMb25nJ3MgdmFsdWUgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRoZSBzcGVjaWZpZWQncy4gVGhpcyBpcyBhbiBhbGlhcyBvZiB7QGxpbmsgTG9uZyNsZXNzVGhhbk9yRXF1YWx9Lg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7IUxvbmd8bnVtYmVyfHN0cmluZ30gb3RoZXIgT3RoZXIgdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmx0ZSA9IExvbmdQcm90b3R5cGUubGVzc1RoYW5PckVxdWFsOw0KDQogICAgLyoqDQogICAgICogVGVzdHMgaWYgdGhpcyBMb25nJ3MgdmFsdWUgaXMgZ3JlYXRlciB0aGFuIHRoZSBzcGVjaWZpZWQncy4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIHZhbHVlDQogICAgICogQHJldHVybnMge2Jvb2xlYW59DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5ncmVhdGVyVGhhbiA9IGZ1bmN0aW9uIGdyZWF0ZXJUaGFuKG90aGVyKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXAoLyogdmFsaWRhdGVzICovIG90aGVyKSA+IDA7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiB0aGUgc3BlY2lmaWVkJ3MuIFRoaXMgaXMgYW4gYWxpYXMgb2Yge0BsaW5rIExvbmcjZ3JlYXRlclRoYW59Lg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7IUxvbmd8bnVtYmVyfHN0cmluZ30gb3RoZXIgT3RoZXIgdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmd0ID0gTG9uZ1Byb3RvdHlwZS5ncmVhdGVyVGhhbjsNCg0KICAgIC8qKg0KICAgICAqIFRlc3RzIGlmIHRoaXMgTG9uZydzIHZhbHVlIGlzIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0aGUgc3BlY2lmaWVkJ3MuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBvdGhlciBPdGhlciB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuZ3JlYXRlclRoYW5PckVxdWFsID0gZnVuY3Rpb24gZ3JlYXRlclRoYW5PckVxdWFsKG90aGVyKSB7DQogICAgICAgIHJldHVybiB0aGlzLmNvbXAoLyogdmFsaWRhdGVzICovIG90aGVyKSA+PSAwOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBUZXN0cyBpZiB0aGlzIExvbmcncyB2YWx1ZSBpcyBncmVhdGVyIHRoYW4gb3IgZXF1YWwgdGhlIHNwZWNpZmllZCdzLiBUaGlzIGlzIGFuIGFsaWFzIG9mIHtAbGluayBMb25nI2dyZWF0ZXJUaGFuT3JFcXVhbH0uDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBvdGhlciBPdGhlciB2YWx1ZQ0KICAgICAqIEByZXR1cm5zIHtib29sZWFufQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuZ3RlID0gTG9uZ1Byb3RvdHlwZS5ncmVhdGVyVGhhbk9yRXF1YWw7DQoNCiAgICAvKioNCiAgICAgKiBDb21wYXJlcyB0aGlzIExvbmcncyB2YWx1ZSB3aXRoIHRoZSBzcGVjaWZpZWQncy4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIHZhbHVlDQogICAgICogQHJldHVybnMge251bWJlcn0gMCBpZiB0aGV5IGFyZSB0aGUgc2FtZSwgMSBpZiB0aGUgdGhpcyBpcyBncmVhdGVyIGFuZCAtMQ0KICAgICAqICBpZiB0aGUgZ2l2ZW4gb25lIGlzIGdyZWF0ZXINCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmNvbXBhcmUgPSBmdW5jdGlvbiBjb21wYXJlKG90aGVyKSB7DQogICAgICAgIGlmICghaXNMb25nKG90aGVyKSkNCiAgICAgICAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsNCiAgICAgICAgaWYgKHRoaXMuZXEob3RoZXIpKQ0KICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgIHZhciB0aGlzTmVnID0gdGhpcy5pc05lZ2F0aXZlKCksDQogICAgICAgICAgICBvdGhlck5lZyA9IG90aGVyLmlzTmVnYXRpdmUoKTsNCiAgICAgICAgaWYgKHRoaXNOZWcgJiYgIW90aGVyTmVnKQ0KICAgICAgICAgICAgcmV0dXJuIC0xOw0KICAgICAgICBpZiAoIXRoaXNOZWcgJiYgb3RoZXJOZWcpDQogICAgICAgICAgICByZXR1cm4gMTsNCiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB0aGUgc2lnbiBiaXRzIGFyZSB0aGUgc2FtZQ0KICAgICAgICBpZiAoIXRoaXMudW5zaWduZWQpDQogICAgICAgICAgICByZXR1cm4gdGhpcy5zdWIob3RoZXIpLmlzTmVnYXRpdmUoKSA/IC0xIDogMTsNCiAgICAgICAgLy8gQm90aCBhcmUgcG9zaXRpdmUgaWYgYXQgbGVhc3Qgb25lIGlzIHVuc2lnbmVkDQogICAgICAgIHJldHVybiAob3RoZXIuaGlnaCA+Pj4gMCkgPiAodGhpcy5oaWdoID4+PiAwKSB8fCAob3RoZXIuaGlnaCA9PT0gdGhpcy5oaWdoICYmIChvdGhlci5sb3cgPj4+IDApID4gKHRoaXMubG93ID4+PiAwKSkgPyAtMSA6IDE7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvbXBhcmVzIHRoaXMgTG9uZydzIHZhbHVlIHdpdGggdGhlIHNwZWNpZmllZCdzLiBUaGlzIGlzIGFuIGFsaWFzIG9mIHtAbGluayBMb25nI2NvbXBhcmV9Lg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7IUxvbmd8bnVtYmVyfHN0cmluZ30gb3RoZXIgT3RoZXIgdmFsdWUNCiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSAwIGlmIHRoZXkgYXJlIHRoZSBzYW1lLCAxIGlmIHRoZSB0aGlzIGlzIGdyZWF0ZXIgYW5kIC0xDQogICAgICogIGlmIHRoZSBnaXZlbiBvbmUgaXMgZ3JlYXRlcg0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuY29tcCA9IExvbmdQcm90b3R5cGUuY29tcGFyZTsNCg0KICAgIC8qKg0KICAgICAqIE5lZ2F0ZXMgdGhpcyBMb25nJ3MgdmFsdWUuDQogICAgICogQHJldHVybnMgeyFMb25nfSBOZWdhdGVkIExvbmcNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLm5lZ2F0ZSA9IGZ1bmN0aW9uIG5lZ2F0ZSgpIHsNCiAgICAgICAgaWYgKCF0aGlzLnVuc2lnbmVkICYmIHRoaXMuZXEoTUlOX1ZBTFVFKSkNCiAgICAgICAgICAgIHJldHVybiBNSU5fVkFMVUU7DQogICAgICAgIHJldHVybiB0aGlzLm5vdCgpLmFkZChPTkUpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBOZWdhdGVzIHRoaXMgTG9uZydzIHZhbHVlLiBUaGlzIGlzIGFuIGFsaWFzIG9mIHtAbGluayBMb25nI25lZ2F0ZX0uDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHJldHVybnMgeyFMb25nfSBOZWdhdGVkIExvbmcNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLm5lZyA9IExvbmdQcm90b3R5cGUubmVnYXRlOw0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGUgc3VtIG9mIHRoaXMgYW5kIHRoZSBzcGVjaWZpZWQgTG9uZy4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IGFkZGVuZCBBZGRlbmQNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFN1bQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gYWRkKGFkZGVuZCkgew0KICAgICAgICBpZiAoIWlzTG9uZyhhZGRlbmQpKQ0KICAgICAgICAgICAgYWRkZW5kID0gZnJvbVZhbHVlKGFkZGVuZCk7DQoNCiAgICAgICAgLy8gRGl2aWRlIGVhY2ggbnVtYmVyIGludG8gNCBjaHVua3Mgb2YgMTYgYml0cywgYW5kIHRoZW4gc3VtIHRoZSBjaHVua3MuDQoNCiAgICAgICAgdmFyIGE0OCA9IHRoaXMuaGlnaCA+Pj4gMTY7DQogICAgICAgIHZhciBhMzIgPSB0aGlzLmhpZ2ggJiAweEZGRkY7DQogICAgICAgIHZhciBhMTYgPSB0aGlzLmxvdyA+Pj4gMTY7DQogICAgICAgIHZhciBhMDAgPSB0aGlzLmxvdyAmIDB4RkZGRjsNCg0KICAgICAgICB2YXIgYjQ4ID0gYWRkZW5kLmhpZ2ggPj4+IDE2Ow0KICAgICAgICB2YXIgYjMyID0gYWRkZW5kLmhpZ2ggJiAweEZGRkY7DQogICAgICAgIHZhciBiMTYgPSBhZGRlbmQubG93ID4+PiAxNjsNCiAgICAgICAgdmFyIGIwMCA9IGFkZGVuZC5sb3cgJiAweEZGRkY7DQoNCiAgICAgICAgdmFyIGM0OCA9IDAsIGMzMiA9IDAsIGMxNiA9IDAsIGMwMCA9IDA7DQogICAgICAgIGMwMCArPSBhMDAgKyBiMDA7DQogICAgICAgIGMxNiArPSBjMDAgPj4+IDE2Ow0KICAgICAgICBjMDAgJj0gMHhGRkZGOw0KICAgICAgICBjMTYgKz0gYTE2ICsgYjE2Ow0KICAgICAgICBjMzIgKz0gYzE2ID4+PiAxNjsNCiAgICAgICAgYzE2ICY9IDB4RkZGRjsNCiAgICAgICAgYzMyICs9IGEzMiArIGIzMjsNCiAgICAgICAgYzQ4ICs9IGMzMiA+Pj4gMTY7DQogICAgICAgIGMzMiAmPSAweEZGRkY7DQogICAgICAgIGM0OCArPSBhNDggKyBiNDg7DQogICAgICAgIGM0OCAmPSAweEZGRkY7DQogICAgICAgIHJldHVybiBmcm9tQml0cygoYzE2IDw8IDE2KSB8IGMwMCwgKGM0OCA8PCAxNikgfCBjMzIsIHRoaXMudW5zaWduZWQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoZSBkaWZmZXJlbmNlIG9mIHRoaXMgYW5kIHRoZSBzcGVjaWZpZWQgTG9uZy4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IHN1YnRyYWhlbmQgU3VidHJhaGVuZA0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gRGlmZmVyZW5jZQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuc3VidHJhY3QgPSBmdW5jdGlvbiBzdWJ0cmFjdChzdWJ0cmFoZW5kKSB7DQogICAgICAgIGlmICghaXNMb25nKHN1YnRyYWhlbmQpKQ0KICAgICAgICAgICAgc3VidHJhaGVuZCA9IGZyb21WYWx1ZShzdWJ0cmFoZW5kKTsNCiAgICAgICAgcmV0dXJuIHRoaXMuYWRkKHN1YnRyYWhlbmQubmVnKCkpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoZSBkaWZmZXJlbmNlIG9mIHRoaXMgYW5kIHRoZSBzcGVjaWZpZWQgTG9uZy4gVGhpcyBpcyBhbiBhbGlhcyBvZiB7QGxpbmsgTG9uZyNzdWJ0cmFjdH0uDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBzdWJ0cmFoZW5kIFN1YnRyYWhlbmQNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IERpZmZlcmVuY2UNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnN1YiA9IExvbmdQcm90b3R5cGUuc3VidHJhY3Q7DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoZSBwcm9kdWN0IG9mIHRoaXMgYW5kIHRoZSBzcGVjaWZpZWQgTG9uZy4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG11bHRpcGxpZXIgTXVsdGlwbGllcg0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gUHJvZHVjdA0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUubXVsdGlwbHkgPSBmdW5jdGlvbiBtdWx0aXBseShtdWx0aXBsaWVyKSB7DQogICAgICAgIGlmICh0aGlzLmlzWmVybygpKQ0KICAgICAgICAgICAgcmV0dXJuIFpFUk87DQogICAgICAgIGlmICghaXNMb25nKG11bHRpcGxpZXIpKQ0KICAgICAgICAgICAgbXVsdGlwbGllciA9IGZyb21WYWx1ZShtdWx0aXBsaWVyKTsNCiAgICAgICAgaWYgKG11bHRpcGxpZXIuaXNaZXJvKCkpDQogICAgICAgICAgICByZXR1cm4gWkVSTzsNCiAgICAgICAgaWYgKHRoaXMuZXEoTUlOX1ZBTFVFKSkNCiAgICAgICAgICAgIHJldHVybiBtdWx0aXBsaWVyLmlzT2RkKCkgPyBNSU5fVkFMVUUgOiBaRVJPOw0KICAgICAgICBpZiAobXVsdGlwbGllci5lcShNSU5fVkFMVUUpKQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuaXNPZGQoKSA/IE1JTl9WQUxVRSA6IFpFUk87DQoNCiAgICAgICAgaWYgKHRoaXMuaXNOZWdhdGl2ZSgpKSB7DQogICAgICAgICAgICBpZiAobXVsdGlwbGllci5pc05lZ2F0aXZlKCkpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubmVnKCkubXVsKG11bHRpcGxpZXIubmVnKCkpOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5lZygpLm11bChtdWx0aXBsaWVyKS5uZWcoKTsNCiAgICAgICAgfSBlbHNlIGlmIChtdWx0aXBsaWVyLmlzTmVnYXRpdmUoKSkNCiAgICAgICAgICAgIHJldHVybiB0aGlzLm11bChtdWx0aXBsaWVyLm5lZygpKS5uZWcoKTsNCg0KICAgICAgICAvLyBJZiBib3RoIGxvbmdzIGFyZSBzbWFsbCwgdXNlIGZsb2F0IG11bHRpcGxpY2F0aW9uDQogICAgICAgIGlmICh0aGlzLmx0KFRXT19QV1JfMjQpICYmIG11bHRpcGxpZXIubHQoVFdPX1BXUl8yNCkpDQogICAgICAgICAgICByZXR1cm4gZnJvbU51bWJlcih0aGlzLnRvTnVtYmVyKCkgKiBtdWx0aXBsaWVyLnRvTnVtYmVyKCksIHRoaXMudW5zaWduZWQpOw0KDQogICAgICAgIC8vIERpdmlkZSBlYWNoIGxvbmcgaW50byA0IGNodW5rcyBvZiAxNiBiaXRzLCBhbmQgdGhlbiBhZGQgdXAgNHg0IHByb2R1Y3RzLg0KICAgICAgICAvLyBXZSBjYW4gc2tpcCBwcm9kdWN0cyB0aGF0IHdvdWxkIG92ZXJmbG93Lg0KDQogICAgICAgIHZhciBhNDggPSB0aGlzLmhpZ2ggPj4+IDE2Ow0KICAgICAgICB2YXIgYTMyID0gdGhpcy5oaWdoICYgMHhGRkZGOw0KICAgICAgICB2YXIgYTE2ID0gdGhpcy5sb3cgPj4+IDE2Ow0KICAgICAgICB2YXIgYTAwID0gdGhpcy5sb3cgJiAweEZGRkY7DQoNCiAgICAgICAgdmFyIGI0OCA9IG11bHRpcGxpZXIuaGlnaCA+Pj4gMTY7DQogICAgICAgIHZhciBiMzIgPSBtdWx0aXBsaWVyLmhpZ2ggJiAweEZGRkY7DQogICAgICAgIHZhciBiMTYgPSBtdWx0aXBsaWVyLmxvdyA+Pj4gMTY7DQogICAgICAgIHZhciBiMDAgPSBtdWx0aXBsaWVyLmxvdyAmIDB4RkZGRjsNCg0KICAgICAgICB2YXIgYzQ4ID0gMCwgYzMyID0gMCwgYzE2ID0gMCwgYzAwID0gMDsNCiAgICAgICAgYzAwICs9IGEwMCAqIGIwMDsNCiAgICAgICAgYzE2ICs9IGMwMCA+Pj4gMTY7DQogICAgICAgIGMwMCAmPSAweEZGRkY7DQogICAgICAgIGMxNiArPSBhMTYgKiBiMDA7DQogICAgICAgIGMzMiArPSBjMTYgPj4+IDE2Ow0KICAgICAgICBjMTYgJj0gMHhGRkZGOw0KICAgICAgICBjMTYgKz0gYTAwICogYjE2Ow0KICAgICAgICBjMzIgKz0gYzE2ID4+PiAxNjsNCiAgICAgICAgYzE2ICY9IDB4RkZGRjsNCiAgICAgICAgYzMyICs9IGEzMiAqIGIwMDsNCiAgICAgICAgYzQ4ICs9IGMzMiA+Pj4gMTY7DQogICAgICAgIGMzMiAmPSAweEZGRkY7DQogICAgICAgIGMzMiArPSBhMTYgKiBiMTY7DQogICAgICAgIGM0OCArPSBjMzIgPj4+IDE2Ow0KICAgICAgICBjMzIgJj0gMHhGRkZGOw0KICAgICAgICBjMzIgKz0gYTAwICogYjMyOw0KICAgICAgICBjNDggKz0gYzMyID4+PiAxNjsNCiAgICAgICAgYzMyICY9IDB4RkZGRjsNCiAgICAgICAgYzQ4ICs9IGE0OCAqIGIwMCArIGEzMiAqIGIxNiArIGExNiAqIGIzMiArIGEwMCAqIGI0ODsNCiAgICAgICAgYzQ4ICY9IDB4RkZGRjsNCiAgICAgICAgcmV0dXJuIGZyb21CaXRzKChjMTYgPDwgMTYpIHwgYzAwLCAoYzQ4IDw8IDE2KSB8IGMzMiwgdGhpcy51bnNpZ25lZCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhlIHByb2R1Y3Qgb2YgdGhpcyBhbmQgdGhlIHNwZWNpZmllZCBMb25nLiBUaGlzIGlzIGFuIGFsaWFzIG9mIHtAbGluayBMb25nI211bHRpcGx5fS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG11bHRpcGxpZXIgTXVsdGlwbGllcg0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gUHJvZHVjdA0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUubXVsID0gTG9uZ1Byb3RvdHlwZS5tdWx0aXBseTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhpcyBMb25nIGRpdmlkZWQgYnkgdGhlIHNwZWNpZmllZC4gVGhlIHJlc3VsdCBpcyBzaWduZWQgaWYgdGhpcyBMb25nIGlzIHNpZ25lZCBvcg0KICAgICAqICB1bnNpZ25lZCBpZiB0aGlzIExvbmcgaXMgdW5zaWduZWQuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBkaXZpc29yIERpdmlzb3INCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFF1b3RpZW50DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5kaXZpZGUgPSBmdW5jdGlvbiBkaXZpZGUoZGl2aXNvcikgew0KICAgICAgICBpZiAoIWlzTG9uZyhkaXZpc29yKSkNCiAgICAgICAgICAgIGRpdmlzb3IgPSBmcm9tVmFsdWUoZGl2aXNvcik7DQogICAgICAgIGlmIChkaXZpc29yLmlzWmVybygpKQ0KICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ2RpdmlzaW9uIGJ5IHplcm8nKTsNCiAgICAgICAgaWYgKHRoaXMuaXNaZXJvKCkpDQogICAgICAgICAgICByZXR1cm4gdGhpcy51bnNpZ25lZCA/IFVaRVJPIDogWkVSTzsNCiAgICAgICAgdmFyIGFwcHJveCwgcmVtLCByZXM7DQogICAgICAgIGlmICghdGhpcy51bnNpZ25lZCkgew0KICAgICAgICAgICAgLy8gVGhpcyBzZWN0aW9uIGlzIG9ubHkgcmVsZXZhbnQgZm9yIHNpZ25lZCBsb25ncyBhbmQgaXMgZGVyaXZlZCBmcm9tIHRoZQ0KICAgICAgICAgICAgLy8gY2xvc3VyZSBsaWJyYXJ5IGFzIGEgd2hvbGUuDQogICAgICAgICAgICBpZiAodGhpcy5lcShNSU5fVkFMVUUpKSB7DQogICAgICAgICAgICAgICAgaWYgKGRpdmlzb3IuZXEoT05FKSB8fCBkaXZpc29yLmVxKE5FR19PTkUpKQ0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gTUlOX1ZBTFVFOyAgLy8gcmVjYWxsIHRoYXQgLU1JTl9WQUxVRSA9PSBNSU5fVkFMVUUNCiAgICAgICAgICAgICAgICBlbHNlIGlmIChkaXZpc29yLmVxKE1JTl9WQUxVRSkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBPTkU7DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIC8vIEF0IHRoaXMgcG9pbnQsIHdlIGhhdmUgfG90aGVyfCA+PSAyLCBzbyB8dGhpcy9vdGhlcnwgPCB8TUlOX1ZBTFVFfC4NCiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbGZUaGlzID0gdGhpcy5zaHIoMSk7DQogICAgICAgICAgICAgICAgICAgIGFwcHJveCA9IGhhbGZUaGlzLmRpdihkaXZpc29yKS5zaGwoMSk7DQogICAgICAgICAgICAgICAgICAgIGlmIChhcHByb3guZXEoWkVSTykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkaXZpc29yLmlzTmVnYXRpdmUoKSA/IE9ORSA6IE5FR19PTkU7DQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZW0gPSB0aGlzLnN1YihkaXZpc29yLm11bChhcHByb3gpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IGFwcHJveC5hZGQocmVtLmRpdihkaXZpc29yKSk7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSBlbHNlIGlmIChkaXZpc29yLmVxKE1JTl9WQUxVRSkpDQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMudW5zaWduZWQgPyBVWkVSTyA6IFpFUk87DQogICAgICAgICAgICBpZiAodGhpcy5pc05lZ2F0aXZlKCkpIHsNCiAgICAgICAgICAgICAgICBpZiAoZGl2aXNvci5pc05lZ2F0aXZlKCkpDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm5lZygpLmRpdihkaXZpc29yLm5lZygpKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5uZWcoKS5kaXYoZGl2aXNvcikubmVnKCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGRpdmlzb3IuaXNOZWdhdGl2ZSgpKQ0KICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpdihkaXZpc29yLm5lZygpKS5uZWcoKTsNCiAgICAgICAgICAgIHJlcyA9IFpFUk87DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAvLyBUaGUgYWxnb3JpdGhtIGJlbG93IGhhcyBub3QgYmVlbiBtYWRlIGZvciB1bnNpZ25lZCBsb25ncy4gSXQncyB0aGVyZWZvcmUNCiAgICAgICAgICAgIC8vIHJlcXVpcmVkIHRvIHRha2Ugc3BlY2lhbCBjYXJlIG9mIHRoZSBNU0IgcHJpb3IgdG8gcnVubmluZyBpdC4NCiAgICAgICAgICAgIGlmICghZGl2aXNvci51bnNpZ25lZCkNCiAgICAgICAgICAgICAgICBkaXZpc29yID0gZGl2aXNvci50b1Vuc2lnbmVkKCk7DQogICAgICAgICAgICBpZiAoZGl2aXNvci5ndCh0aGlzKSkNCiAgICAgICAgICAgICAgICByZXR1cm4gVVpFUk87DQogICAgICAgICAgICBpZiAoZGl2aXNvci5ndCh0aGlzLnNocnUoMSkpKSAvLyAxNSA+Pj4gMSA9IDcgOyB3aXRoIGRpdmlzb3IgPSA4IDsgdHJ1ZQ0KICAgICAgICAgICAgICAgIHJldHVybiBVT05FOw0KICAgICAgICAgICAgcmVzID0gVVpFUk87DQogICAgICAgIH0NCg0KICAgICAgICAvLyBSZXBlYXQgdGhlIGZvbGxvd2luZyB1bnRpbCB0aGUgcmVtYWluZGVyIGlzIGxlc3MgdGhhbiBvdGhlcjogIGZpbmQgYQ0KICAgICAgICAvLyBmbG9hdGluZy1wb2ludCB0aGF0IGFwcHJveGltYXRlcyByZW1haW5kZXIgLyBvdGhlciAqZnJvbSBiZWxvdyosIGFkZCB0aGlzDQogICAgICAgIC8vIGludG8gdGhlIHJlc3VsdCwgYW5kIHN1YnRyYWN0IGl0IGZyb20gdGhlIHJlbWFpbmRlci4gIEl0IGlzIGNyaXRpY2FsIHRoYXQNCiAgICAgICAgLy8gdGhlIGFwcHJveGltYXRlIHZhbHVlIGlzIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgcmVhbCB2YWx1ZSBzbyB0aGF0IHRoZQ0KICAgICAgICAvLyByZW1haW5kZXIgbmV2ZXIgYmVjb21lcyBuZWdhdGl2ZS4NCiAgICAgICAgcmVtID0gdGhpczsNCiAgICAgICAgd2hpbGUgKHJlbS5ndGUoZGl2aXNvcikpIHsNCiAgICAgICAgICAgIC8vIEFwcHJveGltYXRlIHRoZSByZXN1bHQgb2YgZGl2aXNpb24uIFRoaXMgbWF5IGJlIGEgbGl0dGxlIGdyZWF0ZXIgb3INCiAgICAgICAgICAgIC8vIHNtYWxsZXIgdGhhbiB0aGUgYWN0dWFsIHZhbHVlLg0KICAgICAgICAgICAgYXBwcm94ID0gTWF0aC5tYXgoMSwgTWF0aC5mbG9vcihyZW0udG9OdW1iZXIoKSAvIGRpdmlzb3IudG9OdW1iZXIoKSkpOw0KDQogICAgICAgICAgICAvLyBXZSB3aWxsIHR3ZWFrIHRoZSBhcHByb3hpbWF0ZSByZXN1bHQgYnkgY2hhbmdpbmcgaXQgaW4gdGhlIDQ4LXRoIGRpZ2l0IG9yDQogICAgICAgICAgICAvLyB0aGUgc21hbGxlc3Qgbm9uLWZyYWN0aW9uYWwgZGlnaXQsIHdoaWNoZXZlciBpcyBsYXJnZXIuDQogICAgICAgICAgICB2YXIgbG9nMiA9IE1hdGguY2VpbChNYXRoLmxvZyhhcHByb3gpIC8gTWF0aC5MTjIpLA0KICAgICAgICAgICAgICAgIGRlbHRhID0gKGxvZzIgPD0gNDgpID8gMSA6IHBvd19kYmwoMiwgbG9nMiAtIDQ4KSwNCg0KICAgICAgICAgICAgLy8gRGVjcmVhc2UgdGhlIGFwcHJveGltYXRpb24gdW50aWwgaXQgaXMgc21hbGxlciB0aGFuIHRoZSByZW1haW5kZXIuICBOb3RlDQogICAgICAgICAgICAvLyB0aGF0IGlmIGl0IGlzIHRvbyBsYXJnZSwgdGhlIHByb2R1Y3Qgb3ZlcmZsb3dzIGFuZCBpcyBuZWdhdGl2ZS4NCiAgICAgICAgICAgICAgICBhcHByb3hSZXMgPSBmcm9tTnVtYmVyKGFwcHJveCksDQogICAgICAgICAgICAgICAgYXBwcm94UmVtID0gYXBwcm94UmVzLm11bChkaXZpc29yKTsNCiAgICAgICAgICAgIHdoaWxlIChhcHByb3hSZW0uaXNOZWdhdGl2ZSgpIHx8IGFwcHJveFJlbS5ndChyZW0pKSB7DQogICAgICAgICAgICAgICAgYXBwcm94IC09IGRlbHRhOw0KICAgICAgICAgICAgICAgIGFwcHJveFJlcyA9IGZyb21OdW1iZXIoYXBwcm94LCB0aGlzLnVuc2lnbmVkKTsNCiAgICAgICAgICAgICAgICBhcHByb3hSZW0gPSBhcHByb3hSZXMubXVsKGRpdmlzb3IpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvLyBXZSBrbm93IHRoZSBhbnN3ZXIgY2FuJ3QgYmUgemVyby4uLiBhbmQgYWN0dWFsbHksIHplcm8gd291bGQgY2F1c2UNCiAgICAgICAgICAgIC8vIGluZmluaXRlIHJlY3Vyc2lvbiBzaW5jZSB3ZSB3b3VsZCBtYWtlIG5vIHByb2dyZXNzLg0KICAgICAgICAgICAgaWYgKGFwcHJveFJlcy5pc1plcm8oKSkNCiAgICAgICAgICAgICAgICBhcHByb3hSZXMgPSBPTkU7DQoNCiAgICAgICAgICAgIHJlcyA9IHJlcy5hZGQoYXBwcm94UmVzKTsNCiAgICAgICAgICAgIHJlbSA9IHJlbS5zdWIoYXBwcm94UmVtKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gcmVzOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoaXMgTG9uZyBkaXZpZGVkIGJ5IHRoZSBzcGVjaWZpZWQuIFRoaXMgaXMgYW4gYWxpYXMgb2Yge0BsaW5rIExvbmcjZGl2aWRlfS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IGRpdmlzb3IgRGl2aXNvcg0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gUXVvdGllbnQNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLmRpdiA9IExvbmdQcm90b3R5cGUuZGl2aWRlOw0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGlzIExvbmcgbW9kdWxvIHRoZSBzcGVjaWZpZWQuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBkaXZpc29yIERpdmlzb3INCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFJlbWFpbmRlcg0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUubW9kdWxvID0gZnVuY3Rpb24gbW9kdWxvKGRpdmlzb3IpIHsNCiAgICAgICAgaWYgKCFpc0xvbmcoZGl2aXNvcikpDQogICAgICAgICAgICBkaXZpc29yID0gZnJvbVZhbHVlKGRpdmlzb3IpOw0KICAgICAgICByZXR1cm4gdGhpcy5zdWIodGhpcy5kaXYoZGl2aXNvcikubXVsKGRpdmlzb3IpKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGlzIExvbmcgbW9kdWxvIHRoZSBzcGVjaWZpZWQuIFRoaXMgaXMgYW4gYWxpYXMgb2Yge0BsaW5rIExvbmcjbW9kdWxvfS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IGRpdmlzb3IgRGl2aXNvcg0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gUmVtYWluZGVyDQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5tb2QgPSBMb25nUHJvdG90eXBlLm1vZHVsbzsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhlIGJpdHdpc2UgTk9UIG9mIHRoaXMgTG9uZy4NCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5ub3QgPSBmdW5jdGlvbiBub3QoKSB7DQogICAgICAgIHJldHVybiBmcm9tQml0cyh+dGhpcy5sb3csIH50aGlzLmhpZ2gsIHRoaXMudW5zaWduZWQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoZSBiaXR3aXNlIEFORCBvZiB0aGlzIExvbmcgYW5kIHRoZSBzcGVjaWZpZWQuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBvdGhlciBPdGhlciBMb25nDQogICAgICogQHJldHVybnMgeyFMb25nfQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuYW5kID0gZnVuY3Rpb24gYW5kKG90aGVyKSB7DQogICAgICAgIGlmICghaXNMb25nKG90aGVyKSkNCiAgICAgICAgICAgIG90aGVyID0gZnJvbVZhbHVlKG90aGVyKTsNCiAgICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMubG93ICYgb3RoZXIubG93LCB0aGlzLmhpZ2ggJiBvdGhlci5oaWdoLCB0aGlzLnVuc2lnbmVkKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogUmV0dXJucyB0aGUgYml0d2lzZSBPUiBvZiB0aGlzIExvbmcgYW5kIHRoZSBzcGVjaWZpZWQuDQogICAgICogQHBhcmFtIHshTG9uZ3xudW1iZXJ8c3RyaW5nfSBvdGhlciBPdGhlciBMb25nDQogICAgICogQHJldHVybnMgeyFMb25nfQ0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUub3IgPSBmdW5jdGlvbiBvcihvdGhlcikgew0KICAgICAgICBpZiAoIWlzTG9uZyhvdGhlcikpDQogICAgICAgICAgICBvdGhlciA9IGZyb21WYWx1ZShvdGhlcik7DQogICAgICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdyB8IG90aGVyLmxvdywgdGhpcy5oaWdoIHwgb3RoZXIuaGlnaCwgdGhpcy51bnNpZ25lZCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhlIGJpdHdpc2UgWE9SIG9mIHRoaXMgTG9uZyBhbmQgdGhlIGdpdmVuIG9uZS4NCiAgICAgKiBAcGFyYW0geyFMb25nfG51bWJlcnxzdHJpbmd9IG90aGVyIE90aGVyIExvbmcNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9DQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS54b3IgPSBmdW5jdGlvbiB4b3Iob3RoZXIpIHsNCiAgICAgICAgaWYgKCFpc0xvbmcob3RoZXIpKQ0KICAgICAgICAgICAgb3RoZXIgPSBmcm9tVmFsdWUob3RoZXIpOw0KICAgICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3cgXiBvdGhlci5sb3csIHRoaXMuaGlnaCBeIG90aGVyLmhpZ2gsIHRoaXMudW5zaWduZWQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoaXMgTG9uZyB3aXRoIGJpdHMgc2hpZnRlZCB0byB0aGUgbGVmdCBieSB0aGUgZ2l2ZW4gYW1vdW50Lg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfCFMb25nfSBudW1CaXRzIE51bWJlciBvZiBiaXRzDQogICAgICogQHJldHVybnMgeyFMb25nfSBTaGlmdGVkIExvbmcNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnNoaWZ0TGVmdCA9IGZ1bmN0aW9uIHNoaWZ0TGVmdChudW1CaXRzKSB7DQogICAgICAgIGlmIChpc0xvbmcobnVtQml0cykpDQogICAgICAgICAgICBudW1CaXRzID0gbnVtQml0cy50b0ludCgpOw0KICAgICAgICBpZiAoKG51bUJpdHMgJj0gNjMpID09PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIGVsc2UgaWYgKG51bUJpdHMgPCAzMikNCiAgICAgICAgICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdyA8PCBudW1CaXRzLCAodGhpcy5oaWdoIDw8IG51bUJpdHMpIHwgKHRoaXMubG93ID4+PiAoMzIgLSBudW1CaXRzKSksIHRoaXMudW5zaWduZWQpOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICByZXR1cm4gZnJvbUJpdHMoMCwgdGhpcy5sb3cgPDwgKG51bUJpdHMgLSAzMiksIHRoaXMudW5zaWduZWQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoaXMgTG9uZyB3aXRoIGJpdHMgc2hpZnRlZCB0byB0aGUgbGVmdCBieSB0aGUgZ2l2ZW4gYW1vdW50LiBUaGlzIGlzIGFuIGFsaWFzIG9mIHtAbGluayBMb25nI3NoaWZ0TGVmdH0uDQogICAgICogQGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtudW1iZXJ8IUxvbmd9IG51bUJpdHMgTnVtYmVyIG9mIGJpdHMNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFNoaWZ0ZWQgTG9uZw0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuc2hsID0gTG9uZ1Byb3RvdHlwZS5zaGlmdExlZnQ7DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoaXMgTG9uZyB3aXRoIGJpdHMgYXJpdGhtZXRpY2FsbHkgc2hpZnRlZCB0byB0aGUgcmlnaHQgYnkgdGhlIGdpdmVuIGFtb3VudC4NCiAgICAgKiBAcGFyYW0ge251bWJlcnwhTG9uZ30gbnVtQml0cyBOdW1iZXIgb2YgYml0cw0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gU2hpZnRlZCBMb25nDQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5zaGlmdFJpZ2h0ID0gZnVuY3Rpb24gc2hpZnRSaWdodChudW1CaXRzKSB7DQogICAgICAgIGlmIChpc0xvbmcobnVtQml0cykpDQogICAgICAgICAgICBudW1CaXRzID0gbnVtQml0cy50b0ludCgpOw0KICAgICAgICBpZiAoKG51bUJpdHMgJj0gNjMpID09PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIGVsc2UgaWYgKG51bUJpdHMgPCAzMikNCiAgICAgICAgICAgIHJldHVybiBmcm9tQml0cygodGhpcy5sb3cgPj4+IG51bUJpdHMpIHwgKHRoaXMuaGlnaCA8PCAoMzIgLSBudW1CaXRzKSksIHRoaXMuaGlnaCA+PiBudW1CaXRzLCB0aGlzLnVuc2lnbmVkKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmV0dXJuIGZyb21CaXRzKHRoaXMuaGlnaCA+PiAobnVtQml0cyAtIDMyKSwgdGhpcy5oaWdoID49IDAgPyAwIDogLTEsIHRoaXMudW5zaWduZWQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoaXMgTG9uZyB3aXRoIGJpdHMgYXJpdGhtZXRpY2FsbHkgc2hpZnRlZCB0byB0aGUgcmlnaHQgYnkgdGhlIGdpdmVuIGFtb3VudC4gVGhpcyBpcyBhbiBhbGlhcyBvZiB7QGxpbmsgTG9uZyNzaGlmdFJpZ2h0fS4NCiAgICAgKiBAZnVuY3Rpb24NCiAgICAgKiBAcGFyYW0ge251bWJlcnwhTG9uZ30gbnVtQml0cyBOdW1iZXIgb2YgYml0cw0KICAgICAqIEByZXR1cm5zIHshTG9uZ30gU2hpZnRlZCBMb25nDQogICAgICovDQogICAgTG9uZ1Byb3RvdHlwZS5zaHIgPSBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHQ7DQoNCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIHRoaXMgTG9uZyB3aXRoIGJpdHMgbG9naWNhbGx5IHNoaWZ0ZWQgdG8gdGhlIHJpZ2h0IGJ5IHRoZSBnaXZlbiBhbW91bnQuDQogICAgICogQHBhcmFtIHtudW1iZXJ8IUxvbmd9IG51bUJpdHMgTnVtYmVyIG9mIGJpdHMNCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFNoaWZ0ZWQgTG9uZw0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUuc2hpZnRSaWdodFVuc2lnbmVkID0gZnVuY3Rpb24gc2hpZnRSaWdodFVuc2lnbmVkKG51bUJpdHMpIHsNCiAgICAgICAgaWYgKGlzTG9uZyhudW1CaXRzKSkNCiAgICAgICAgICAgIG51bUJpdHMgPSBudW1CaXRzLnRvSW50KCk7DQogICAgICAgIG51bUJpdHMgJj0gNjM7DQogICAgICAgIGlmIChudW1CaXRzID09PSAwKQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgdmFyIGhpZ2ggPSB0aGlzLmhpZ2g7DQogICAgICAgICAgICBpZiAobnVtQml0cyA8IDMyKSB7DQogICAgICAgICAgICAgICAgdmFyIGxvdyA9IHRoaXMubG93Ow0KICAgICAgICAgICAgICAgIHJldHVybiBmcm9tQml0cygobG93ID4+PiBudW1CaXRzKSB8IChoaWdoIDw8ICgzMiAtIG51bUJpdHMpKSwgaGlnaCA+Pj4gbnVtQml0cywgdGhpcy51bnNpZ25lZCk7DQogICAgICAgICAgICB9IGVsc2UgaWYgKG51bUJpdHMgPT09IDMyKQ0KICAgICAgICAgICAgICAgIHJldHVybiBmcm9tQml0cyhoaWdoLCAwLCB0aGlzLnVuc2lnbmVkKTsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICByZXR1cm4gZnJvbUJpdHMoaGlnaCA+Pj4gKG51bUJpdHMgLSAzMiksIDAsIHRoaXMudW5zaWduZWQpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybnMgdGhpcyBMb25nIHdpdGggYml0cyBsb2dpY2FsbHkgc2hpZnRlZCB0byB0aGUgcmlnaHQgYnkgdGhlIGdpdmVuIGFtb3VudC4gVGhpcyBpcyBhbiBhbGlhcyBvZiB7QGxpbmsgTG9uZyNzaGlmdFJpZ2h0VW5zaWduZWR9Lg0KICAgICAqIEBmdW5jdGlvbg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfCFMb25nfSBudW1CaXRzIE51bWJlciBvZiBiaXRzDQogICAgICogQHJldHVybnMgeyFMb25nfSBTaGlmdGVkIExvbmcNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnNocnUgPSBMb25nUHJvdG90eXBlLnNoaWZ0UmlnaHRVbnNpZ25lZDsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoaXMgTG9uZyB0byBzaWduZWQuDQogICAgICogQHJldHVybnMgeyFMb25nfSBTaWduZWQgbG9uZw0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUudG9TaWduZWQgPSBmdW5jdGlvbiB0b1NpZ25lZCgpIHsNCiAgICAgICAgaWYgKCF0aGlzLnVuc2lnbmVkKQ0KICAgICAgICAgICAgcmV0dXJuIHRoaXM7DQogICAgICAgIHJldHVybiBmcm9tQml0cyh0aGlzLmxvdywgdGhpcy5oaWdoLCBmYWxzZSk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoaXMgTG9uZyB0byB1bnNpZ25lZC4NCiAgICAgKiBAcmV0dXJucyB7IUxvbmd9IFVuc2lnbmVkIGxvbmcNCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnRvVW5zaWduZWQgPSBmdW5jdGlvbiB0b1Vuc2lnbmVkKCkgew0KICAgICAgICBpZiAodGhpcy51bnNpZ25lZCkNCiAgICAgICAgICAgIHJldHVybiB0aGlzOw0KICAgICAgICByZXR1cm4gZnJvbUJpdHModGhpcy5sb3csIHRoaXMuaGlnaCwgdHJ1ZSk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoaXMgTG9uZyB0byBpdHMgYnl0ZSByZXByZXNlbnRhdGlvbi4NCiAgICAgKiBAcGFyYW0ge2Jvb2xlYW49fSBsZSBXaGV0aGVyIGxpdHRsZSBvciBiaWcgZW5kaWFuLCBkZWZhdWx0cyB0byBiaWcgZW5kaWFuDQogICAgICogQHJldHVybnMgeyFBcnJheS48bnVtYmVyPn0gQnl0ZSByZXByZXNlbnRhdGlvbg0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUudG9CeXRlcyA9IGZ1bmN0aW9uKGxlKSB7DQogICAgICAgIHJldHVybiBsZSA/IHRoaXMudG9CeXRlc0xFKCkgOiB0aGlzLnRvQnl0ZXNCRSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDb252ZXJ0cyB0aGlzIExvbmcgdG8gaXRzIGxpdHRsZSBlbmRpYW4gYnl0ZSByZXByZXNlbnRhdGlvbi4NCiAgICAgKiBAcmV0dXJucyB7IUFycmF5LjxudW1iZXI+fSBMaXR0bGUgZW5kaWFuIGJ5dGUgcmVwcmVzZW50YXRpb24NCiAgICAgKi8NCiAgICBMb25nUHJvdG90eXBlLnRvQnl0ZXNMRSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgaGkgPSB0aGlzLmhpZ2gsDQogICAgICAgICAgICBsbyA9IHRoaXMubG93Ow0KICAgICAgICByZXR1cm4gWw0KICAgICAgICAgICAgIGxvICAgICAgICAgJiAweGZmLA0KICAgICAgICAgICAgKGxvID4+PiAgOCkgJiAweGZmLA0KICAgICAgICAgICAgKGxvID4+PiAxNikgJiAweGZmLA0KICAgICAgICAgICAgKGxvID4+PiAyNCkgJiAweGZmLA0KICAgICAgICAgICAgIGhpICAgICAgICAgJiAweGZmLA0KICAgICAgICAgICAgKGhpID4+PiAgOCkgJiAweGZmLA0KICAgICAgICAgICAgKGhpID4+PiAxNikgJiAweGZmLA0KICAgICAgICAgICAgKGhpID4+PiAyNCkgJiAweGZmDQogICAgICAgIF07DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvbnZlcnRzIHRoaXMgTG9uZyB0byBpdHMgYmlnIGVuZGlhbiBieXRlIHJlcHJlc2VudGF0aW9uLg0KICAgICAqIEByZXR1cm5zIHshQXJyYXkuPG51bWJlcj59IEJpZyBlbmRpYW4gYnl0ZSByZXByZXNlbnRhdGlvbg0KICAgICAqLw0KICAgIExvbmdQcm90b3R5cGUudG9CeXRlc0JFID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBoaSA9IHRoaXMuaGlnaCwNCiAgICAgICAgICAgIGxvID0gdGhpcy5sb3c7DQogICAgICAgIHJldHVybiBbDQogICAgICAgICAgICAoaGkgPj4+IDI0KSAmIDB4ZmYsDQogICAgICAgICAgICAoaGkgPj4+IDE2KSAmIDB4ZmYsDQogICAgICAgICAgICAoaGkgPj4+ICA4KSAmIDB4ZmYsDQogICAgICAgICAgICAgaGkgICAgICAgICAmIDB4ZmYsDQogICAgICAgICAgICAobG8gPj4+IDI0KSAmIDB4ZmYsDQogICAgICAgICAgICAobG8gPj4+IDE2KSAmIDB4ZmYsDQogICAgICAgICAgICAobG8gPj4+ICA4KSAmIDB4ZmYsDQogICAgICAgICAgICAgbG8gICAgICAgICAmIDB4ZmYNCiAgICAgICAgXTsNCiAgICB9Ow0KDQogICAgcmV0dXJuIExvbmc7DQp9KTsKfSk7CgovLwovLyBDdXN0b20gZXJyb3Igc3ViY2xhc3Nlcy4KLy8gTm90aGluZyB0b28gdW51c3VhbCBoZXJlLgovLwoKZnVuY3Rpb24gQ29tcGlsZUVycm9yJDEobWVzc2FnZSkgewogIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2UgfHwgIiI7CiAgaWYgKEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKSB7CiAgICAgIEVycm9yLmNhcHR1cmVTdGFja1RyYWNlKHRoaXMsIENvbXBpbGVFcnJvciQxKTsKICB9Cn0KQ29tcGlsZUVycm9yJDEucHJvdG90eXBlID0gbmV3IEVycm9yKCk7CkNvbXBpbGVFcnJvciQxLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IENvbXBpbGVFcnJvciQxOwoKCmZ1bmN0aW9uIExpbmtFcnJvcihtZXNzYWdlKSB7CiAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCAiIjsKICBpZiAoRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UpIHsKICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgTGlua0Vycm9yKTsKICB9Cn0KTGlua0Vycm9yLnByb3RvdHlwZSA9IG5ldyBFcnJvcigpOwpMaW5rRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gTGlua0Vycm9yOwoKCnZhciBSdW50aW1lRXJyb3IkMSA9IEVycm9yOwoKLyoKZXhwb3J0IGZ1bmN0aW9uIFJ1bnRpbWVFcnJvcihtZXNzYWdlKSB7CiAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCAiIgogIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkgewogICAgICBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLCBSdW50aW1lRXJyb3IpOwogIH0KfQpSdW50aW1lRXJyb3IucHJvdG90eXBlID0gbmV3IEVycm9yKCkKUnVudGltZUVycm9yLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IFJ1bnRpbWVFcnJvcgoqLwoKLy8KLy8gQWxsIHRoZSBtYW55IGxvdmVseSBjb25zdGFudHMgd2UgbmVlZCB0byBrbm93Ci8vIGluIG9yZGVyIHRvIHBhcnNlIHRoZSBXQVNNIGJpbmFyeSBmb3JtYXQuCi8vCgp2YXIgUEFHRV9TSVpFID0gNjQgKiAxMDI0OwoKdmFyIFRZUEVTID0gewogIFVOS05PV046IDB4MDAsCiAgSTMyOiAtMHgwMSwKICBJNjQ6IC0weDAyLAogIEYzMjogLTB4MDMsCiAgRjY0OiAtMHgwNCwKICBBTllGVU5DOiAtMHgxMCwKICBGVU5DOiAtMHgyMCwKICBOT05FOiAtMHg0MAp9OwoKdmFyIEVYVEVSTkFMX0tJTkRTID0gewogIEZVTkNUSU9OOiAwLAogIFRBQkxFOiAxLAogIE1FTU9SWTogMiwKICBHTE9CQUw6IDMKfTsKCnZhciBFWFRFUk5BTF9LSU5EX05BTUVTID0gewogIEZVTkNUSU9OOiAiZnVuY3Rpb24iLAogIFRBQkxFOiAidGFibGUiLAogIE1FTU9SWTogIm1lbW9yeSIsCiAgR0xPQkFMOiAiZ2xvYmFsIgp9OwoKdmFyIFNFQ1RJT05TID0gewogIFRZUEU6IDEsCiAgSU1QT1JUOiAyLAogIEZVTkNUSU9OOiAzLAogIFRBQkxFOiA0LAogIE1FTU9SWTogNSwKICBHTE9CQUw6IDYsCiAgRVhQT1JUOiA3LAogIFNUQVJUOiA4LAogIEVMRU1FTlQ6IDksCiAgQ09ERTogMTAsCiAgREFUQTogMTEKfTsKCnZhciBUT0tFTlMgPSB7CiAgTUFHSUNfTlVNQkVSOiAweDZkNzM2MTAwLAogIFZFUlNJT05fTlVNQkVSOiAweGQKfTsKCnZhciBPUENPREVTID0gewogIC8vIENvbnRyb2wgZmxvdwogIFVOUkVBQ0hBQkxFOiAweDAwLAogIE5PUDogMHgwMSwKICBCTE9DSzogMHgwMiwKICBMT09QOiAweDAzLAogIElGOiAweDA0LAogIEVMU0U6IDB4MDUsCiAgRU5EOiAweDBiLAogIEJSOiAweDBjLAogIEJSX0lGOiAweDBkLAogIEJSX1RBQkxFOiAweDBlLAogIFJFVFVSTjogMHgwZiwKICAvLyBDYWxscwogIENBTEw6IDB4MTAsCiAgQ0FMTF9JTkRJUkVDVDogMHgxMSwKICAvLyBQYXJhbWV0cmljIG9wZXJhdG9ycwogIERST1A6IDB4MWEsCiAgU0VMRUNUOiAweDFiLAogIC8vIFZhcmlhYmxlIGFjY2Vzc2VzCiAgR0VUX0xPQ0FMOiAweDIwLAogIFNFVF9MT0NBTDogMHgyMSwKICBURUVfTE9DQUw6IDB4MjIsCiAgR0VUX0dMT0JBTDogMHgyMywKICBTRVRfR0xPQkFMOiAweDI0LAogIC8vIE1lbW9yeS1yZWxhdGVkIG9wZXJhdG9ycwogIEkzMl9MT0FEOiAweDI4LAogIEk2NF9MT0FEOiAweDI5LAogIEYzMl9MT0FEOiAweDJhLAogIEY2NF9MT0FEOiAweDJiLAogIEkzMl9MT0FEOF9TOiAweDJjLAogIEkzMl9MT0FEOF9VOiAweDJkLAogIEkzMl9MT0FEMTZfUzogMHgyZSwKICBJMzJfTE9BRDE2X1U6IDB4MmYsCiAgSTY0X0xPQUQ4X1M6IDB4MzAsCiAgSTY0X0xPQUQ4X1U6IDB4MzEsCiAgSTY0X0xPQUQxNl9TOiAweDMyLAogIEk2NF9MT0FEMTZfVTogMHgzMywKICBJNjRfTE9BRDMyX1M6IDB4MzQsCiAgSTY0X0xPQUQzMl9VOiAweDM1LAogIEkzMl9TVE9SRTogMHgzNiwKICBJNjRfU1RPUkU6IDB4MzcsCiAgRjMyX1NUT1JFOiAweDM4LAogIEY2NF9TVE9SRTogMHgzOSwKICBJMzJfU1RPUkU4OiAweDNhLAogIEkzMl9TVE9SRTE2OiAweDNiLAogIEk2NF9TVE9SRTg6IDB4M2MsCiAgSTY0X1NUT1JFMTY6IDB4M2QsCiAgSTY0X1NUT1JFMzI6IDB4M2UsCiAgQ1VSUkVOVF9NRU1PUlk6IDB4M2YsCiAgR1JPV19NRU1PUlk6IDB4NDAsCiAgLy8gQ29uc3RhbnRzCiAgSTMyX0NPTlNUOiAweDQxLAogIEk2NF9DT05TVDogMHg0MiwKICBGMzJfQ09OU1Q6IDB4NDMsCiAgRjY0X0NPTlNUOiAweDQ0LAogIC8vIENvbXBhcmlzb24gb3BlcmF0b3JzCiAgSTMyX0VRWjogMHg0NSwKICBJMzJfRVE6IDB4NDYsCiAgSTMyX05FOiAweDQ3LAogIEkzMl9MVF9TOiAweDQ4LAogIEkzMl9MVF9VOiAweDQ5LAogIEkzMl9HVF9TOiAweDRhLAogIEkzMl9HVF9VOiAweDRiLAogIEkzMl9MRV9TOiAweDRjLAogIEkzMl9MRV9VOiAweDRkLAogIEkzMl9HRV9TOiAweDRlLAogIEkzMl9HRV9VOiAweDRmLAogIEk2NF9FUVo6IDB4NTAsCiAgSTY0X0VROiAweDUxLAogIEk2NF9ORTogMHg1MiwKICBJNjRfTFRfUzogMHg1MywKICBJNjRfTFRfVTogMHg1NCwKICBJNjRfR1RfUzogMHg1NSwKICBJNjRfR1RfVTogMHg1NiwKICBJNjRfTEVfUzogMHg1NywKICBJNjRfTEVfVTogMHg1OCwKICBJNjRfR0VfUzogMHg1OSwKICBJNjRfR0VfVTogMHg1YSwKICBGMzJfRVE6IDB4NWIsCiAgRjMyX05FOiAweDVjLAogIEYzMl9MVDogMHg1ZCwKICBGMzJfR1Q6IDB4NWUsCiAgRjMyX0xFOiAweDVmLAogIEYzMl9HRTogMHg2MCwKICBGNjRfRVE6IDB4NjEsCiAgRjY0X05FOiAweDYyLAogIEY2NF9MVDogMHg2MywKICBGNjRfR1Q6IDB4NjQsCiAgRjY0X0xFOiAweDY1LAogIEY2NF9HRTogMHg2NiwKICAvLyBOdW1lcmljIG9wZXJhdG9ycwogIEkzMl9DTFo6IDB4NjcsCiAgSTMyX0NUWjogMHg2OCwKICBJMzJfUE9QQ05UOiAweDY5LAogIEkzMl9BREQ6IDB4NmEsCiAgSTMyX1NVQjogMHg2YiwKICBJMzJfTVVMOiAweDZjLAogIEkzMl9ESVZfUzogMHg2ZCwKICBJMzJfRElWX1U6IDB4NmUsCiAgSTMyX1JFTV9TOiAweDZmLAogIEkzMl9SRU1fVTogMHg3MCwKICBJMzJfQU5EOiAweDcxLAogIEkzMl9PUjogMHg3MiwKICBJMzJfWE9SOiAweDczLAogIEkzMl9TSEw6IDB4NzQsCiAgSTMyX1NIUl9TOiAweDc1LAogIEkzMl9TSFJfVTogMHg3NiwKICBJMzJfUk9UTDogMHg3NywKICBJMzJfUk9UUjogMHg3OCwKICBJNjRfQ0xaOiAweDc5LAogIEk2NF9DVFo6IDB4N2EsCiAgSTY0X1BPUENOVDogMHg3YiwKICBJNjRfQUREOiAweDdjLAogIEk2NF9TVUI6IDB4N2QsCiAgSTY0X01VTDogMHg3ZSwKICBJNjRfRElWX1M6IDB4N2YsCiAgSTY0X0RJVl9VOiAweDgwLAogIEk2NF9SRU1fUzogMHg4MSwKICBJNjRfUkVNX1U6IDB4ODIsCiAgSTY0X0FORDogMHg4MywKICBJNjRfT1I6IDB4ODQsCiAgSTY0X1hPUjogMHg4NSwKICBJNjRfU0hMOiAweDg2LAogIEk2NF9TSFJfUzogMHg4NywKICBJNjRfU0hSX1U6IDB4ODgsCiAgSTY0X1JPVEw6IDB4ODksCiAgSTY0X1JPVFI6IDB4OGEsCiAgRjMyX0FCUzogMHg4YiwKICBGMzJfTkVHOiAweDhjLAogIEYzMl9DRUlMOiAweDhkLAogIEYzMl9GTE9PUjogMHg4ZSwKICBGMzJfVFJVTkM6IDB4OGYsCiAgRjMyX05FQVJFU1Q6IDB4OTAsCiAgRjMyX1NRUlQ6IDB4OTEsCiAgRjMyX0FERDogMHg5MiwKICBGMzJfU1VCOiAweDkzLAogIEYzMl9NVUw6IDB4OTQsCiAgRjMyX0RJVjogMHg5NSwKICBGMzJfTUlOOiAweDk2LAogIEYzMl9NQVg6IDB4OTcsCiAgRjMyX0NPUFlTSUdOOiAweDk4LAogIEY2NF9BQlM6IDB4OTksCiAgRjY0X05FRzogMHg5YSwKICBGNjRfQ0VJTDogMHg5YiwKICBGNjRfRkxPT1I6IDB4OWMsCiAgRjY0X1RSVU5DOiAweDlkLAogIEY2NF9ORUFSRVNUOiAweDllLAogIEY2NF9TUVJUOiAweDlmLAogIEY2NF9BREQ6IDB4YTAsCiAgRjY0X1NVQjogMHhhMSwKICBGNjRfTVVMOiAweGEyLAogIEY2NF9ESVY6IDB4YTMsCiAgRjY0X01JTjogMHhhNCwKICBGNjRfTUFYOiAweGE1LAogIEY2NF9DT1BZU0lHTjogMHhhNiwKICAvLyBDb252ZXJzaW9ucwogIEkzMl9XUkFQX0k2NDogMHhhNywKICBJMzJfVFJVTkNfU19GMzI6IDB4YTgsCiAgSTMyX1RSVU5DX1VfRjMyOiAweGE5LAogIEkzMl9UUlVOQ19TX0Y2NDogMHhhYSwKICBJMzJfVFJVTkNfVV9GNjQ6IDB4YWIsCiAgSTY0X0VYVEVORF9TX0kzMjogMHhhYywKICBJNjRfRVhURU5EX1VfSTMyOiAweGFkLAogIEk2NF9UUlVOQ19TX0YzMjogMHhhZSwKICBJNjRfVFJVTkNfVV9GMzI6IDB4YWYsCiAgSTY0X1RSVU5DX1NfRjY0OiAweGIwLAogIEk2NF9UUlVOQ19VX0Y2NDogMHhiMSwKICBGMzJfQ09OVkVSVF9TX0kzMjogMHhiMiwKICBGMzJfQ09OVkVSVF9VX0kzMjogMHhiMywKICBGMzJfQ09OVkVSVF9TX0k2NDogMHhiNCwKICBGMzJfQ09OVkVSVF9VX0k2NDogMHhiNSwKICBGMzJfREVNT1RFX0Y2NDogMHhiNiwKICBGNjRfQ09OVkVSVF9TX0kzMjogMHhiNywKICBGNjRfQ09OVkVSVF9VX0kzMjogMHhiOCwKICBGNjRfQ09OVkVSVF9TX0k2NDogMHhiOSwKICBGNjRfQ09OVkVSVF9VX0k2NDogMHhiYSwKICBGNjRfUFJPTU9URV9GMzI6IDB4YmIsCiAgLy8gUmVpbnRlcnByZXRhdGlvbnMKICBJMzJfUkVJTlRFUlBSRVRfRjMyOiAweGJjLAogIEk2NF9SRUlOVEVSUFJFVF9GNjQ6IDB4YmQsCiAgRjMyX1JFSU5URVJQUkVUX0kzMjogMHhiZSwKICBGNjRfUkVJTlRFUlBSRVRfSTY0OiAweGJmCn07CgovLwovLyBUaGUgV0FTTSAic3RhbmRhcmQgbGlicmFyeSIuCi8vCi8vIFRoZXNlIGFyZSBhbGwgdGhlIGhlbHBlciBmdW5jdGlvbnMgdGhhdCB3ZSBuZWVkIHRvIGhhdmUgYXZhaWxhYmxlCi8vIGZvciB1c2UgYnkgdGhlIHRyYW5zbGF0ZWQgSlMgY29kZS4gIFRoZXkgaW1wbGVtZW50IHZhcmlvdXMgYml0cyBvZgovLyB0aGUgc2VtYW50aWNzIG9mIFdBU00sIHdoaWNoIGRvbid0IHNlZW0gdG8gYmUgYXMgY2xvc2UgdG8gdGhlCi8vIHNlbWFudGljcyBvZiBKUyBhcyBJIHdvdWxkIGhhdmUgbGlrZWQuLi4KLy8KLy8gVHdvIHRoaW5ncyBvZiBwYXJ0aWN1bGFyIGludGVyZXN0OgovLwovLyAgKiBXZSBlbXVsYXRlIDY0LWJpdCBpbnRlZ2VycyB1c2luZyBhIHRoaXJkLXBhcnR5IGBMb25nYCBjbGFzcy4KLy8gICAgSXQgbWlnaHQgYmUgZnVuIHRvIHRyeSB0byB3cml0ZSBhIHNtYWxsZXIgdmVyc2lvbiB3aXRoIGp1c3QKLy8gICAgdGhlIGJpdHMgd2UgbmVlZCwgaW1wbGVtZW50ZWQgZGlyZWN0bHkgaW4gdGhlc2UgaGVscGVyIGZ1bmN0aW9ucy4KLy8KLy8gICogVGhlIGZsb2F0MzIgZnVuY3Rpb25zIGhhdmUgYSBsb3Qgb2YgbXVja2luZyBhcm91bmQgd2l0aCBOYU5zLgovLyAgICBXQVNNIHJlcXVpcmVzIHRoYXQgd2UgcHJlc2VydmUgc3BlY2lmaWMgYml0IHBhdHRlcm5zIGluIE5hTnMKLy8gICAgYW5kIGFzIGZhciBhcyBJIGNhbiB0ZWxsLCBKYXZhU2NyaXB0IGRvZXNuJ3QgZG8gdGhpcyByZWxpYWJseS4KLy8gICAgSW4gcGFydGljdWxhciwgaWYgeW91IHdyaXRlIGEgMzItYml0IGZsb2F0IHRvIGFuIEFycmF5QnVmZmVyCi8vICAgIGFuZCByZWFkIGl0IGJhY2ssIGl0IHdpbGwgYmUgY29udmVydGVkIGZyb20gc2lnbmFsbGluZyB0bwovLyAgICBub24tc2lnbmFsbGluZy4KLy8KLy8gICAgV2Ugd29yayBhcm91bmQgdGhpcyBmb3Igbm93IGJ5IGJveGluZyBOYU5zIGludG8gYSBOdW1iZXIgb2JqZWN0Ci8vICAgIGFuZCBzZXR0aW5nIGEgc2VwYXJ0ZSBmbGFnLCBidXQgdGhhdCdzIHZlcnkgaGFja2luZyBhbmQgSSdtIHN1cmUKLy8gICAgdmVyeSBzbG93LiAgSXQgd291bGQgYmUgZ3JlYXQgdG8gZmluZCBhIGJldHRlciB3YXkuLi4KLy8KCnZhciBzdGRsaWIkMSA9IHt9OwoKCi8vIEEgbGl0dGxlIHNjcmF0Y2ggc3BhY2UgZm9yIGV4YW1pbmluZyB0aGUgYml0cwovLyBvZiBhIGZsb2F0LCBjb252ZXJ0aW5nIGZsb2F0PC0+aW50LCBldGMuCnZhciBzY3JhdGNoQnVmJDEgPSBuZXcgQXJyYXlCdWZmZXIoOCk7CnZhciBzY3JhdGNoQnl0ZXMkMSA9IG5ldyBVaW50OEFycmF5KHNjcmF0Y2hCdWYkMSk7CnZhciBzY3JhdGNoRGF0YSQxID0gbmV3IERhdGFWaWV3KHNjcmF0Y2hCdWYkMSk7CgovLyBIZWxwZnVsIGNvbnN0YW50cy4Kc3RkbGliJDEuSU5UMzJfTUlOID0gMHg4MDAwMDAwMHwwOwpzdGRsaWIkMS5JTlQzMl9NQVggPSAweDdGRkZGRkZGfDA7CnN0ZGxpYiQxLlVJTlQzMl9NSU4gPSAweDAwMDAwMDAwPj4+MDsKc3RkbGliJDEuVUlOVDMyX01BWCA9IDB4RkZGRkZGRkY+Pj4wOwoKLy8gTWlzYyBzdHJ1Y3R1cmFsIGZ1bmN0aW9ucy4Kc3RkbGliJDEudHJhcCA9IGZ1bmN0aW9uKG1zZykgeyB2YXIgZSA9IG5ldyBSdW50aW1lRXJyb3IkMShtc2cgfHwgIml0J3MgYSB0cmFwISIpOyB0aHJvdyBlIH07CgovLyBpMzIgb3BlcmF0aW9ucyB0aGF0IGFyZSBub3QgcHJpbWl0aXZlIG9wZXJhdG9ycwpzdGRsaWIkMS5pMzJfbXVsID0gTWF0aC5pbXVsOwpzdGRsaWIkMS5pMzJfY2x6ID0gTWF0aC5jbHozMjsKc3RkbGliJDEuaTMyX3JvdGwgPSBmdW5jdGlvbih2LCBuKSB7IHJldHVybiAoKHYgPDwgbikgfCAodiA+Pj4gKDMyIC0gbikpICl8MH07CnN0ZGxpYiQxLmkzMl9yb3RyID0gZnVuY3Rpb24odiwgbikgeyByZXR1cm4gKCh2ID4+PiBuKSB8ICh2IDw8ICgzMiAtIG4pKSApfDB9OwpzdGRsaWIkMS5pMzJfY3R6ID0gZnVuY3Rpb24odikgewogIHYgPSB2fDA7CiAgdmFyIGNvdW50ID0gMDsKICB2YXIgYml0ID0gMHgwMTsKICB3aGlsZSAoYml0ICYmICh2ICYgYml0KSA9PT0gMCkgewogICAgY291bnQrKzsKICAgIGJpdCA9IChiaXQgPDwgMSkgJiAweEZGRkZGRkZGOwogIH0KICByZXR1cm4gY291bnQKfTsKc3RkbGliJDEuaTMyX3BvcGNudCA9IGZ1bmN0aW9uKHYpIHsKICB2ID0gdnwwOwogIHZhciBjb3VudCA9IDA7CiAgdmFyIGJpdCA9IDB4MDE7CiAgd2hpbGUgKGJpdCkgewogICAgaWYgKHYgJiBiaXQpIHsgY291bnQrKzsgfQogICAgYml0ID0gKGJpdCA8PCAxKSAmIDB4RkZGRkZGRkY7CiAgfQogIHJldHVybiBjb3VudAp9OwpzdGRsaWIkMS5pMzJfcmVpbnRlcnByZXRfZjMyID0gZnVuY3Rpb24odikgewogIHNjcmF0Y2hEYXRhJDEuc2V0RmxvYXQzMigwLCB2LCB0cnVlKTsKICBpZiAodHlwZW9mIHYgPT09ICdvYmplY3QnICYmIHYuX3NpZ25hbGxpbmcpIHsKICAgIHNjcmF0Y2hCeXRlcyQxWzJdICY9IH4weDQwOwogIH0KICByZXR1cm4gc2NyYXRjaERhdGEkMS5nZXRJbnQzMigwLCB0cnVlKQp9OwoKLy8gaTY0IG9wZXJhdGlvbnMKc3RkbGliJDEuaTY0X2FkZCA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMuYWRkKHJocykgfTsKc3RkbGliJDEuaTY0X3N1YiA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMuc3ViKHJocykgfTsKc3RkbGliJDEuaTY0X211bCA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMubXVsKHJocykgfTsKc3RkbGliJDEuaTY0X2Rpdl9zID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy5kaXYocmhzKSB9OwpzdGRsaWIkMS5pNjRfZGl2X3UgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLnRvVW5zaWduZWQoKS5kaXYocmhzLnRvVW5zaWduZWQoKS50b1Vuc2lnbmVkKCkpIH07CnN0ZGxpYiQxLmk2NF9yZW1fcyA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMubW9kKHJocykgfTsKc3RkbGliJDEuaTY0X3JlbV91ID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy50b1Vuc2lnbmVkKCkubW9kKHJocy50b1Vuc2lnbmVkKCkpLnRvVW5zaWduZWQoKS50b1NpZ25lZCgpIH07CnN0ZGxpYiQxLmk2NF9hbmQgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLmFuZChyaHMpIH07CnN0ZGxpYiQxLmk2NF9vciA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMub3IocmhzKSB9OwpzdGRsaWIkMS5pNjRfeG9yID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy54b3IocmhzKSB9OwpzdGRsaWIkMS5pNjRfc2hsID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy5zaGwocmhzKSB9OwpzdGRsaWIkMS5pNjRfc2hyX3MgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLnNocihyaHMpIH07CnN0ZGxpYiQxLmk2NF9zaHJfdSA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMuc2hydShyaHMpIH07CnN0ZGxpYiQxLmk2NF9lcSA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMuZXEocmhzKSB9OwpzdGRsaWIkMS5pNjRfbmUgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLm5lcShyaHMpIH07CnN0ZGxpYiQxLmk2NF9sdF9zID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy5sdChyaHMpIH07CnN0ZGxpYiQxLmk2NF9sdF91ID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy50b1Vuc2lnbmVkKCkubHQocmhzLnRvVW5zaWduZWQoKSkgfTsKc3RkbGliJDEuaTY0X2d0X3MgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLmd0KHJocykgfTsKc3RkbGliJDEuaTY0X2d0X3UgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLnRvVW5zaWduZWQoKS5ndChyaHMudG9VbnNpZ25lZCgpKSB9OwpzdGRsaWIkMS5pNjRfbGVfcyA9IGZ1bmN0aW9uKGxocywgcmhzKSB7IHJldHVybiBsaHMubHRlKHJocykgfTsKc3RkbGliJDEuaTY0X2xlX3UgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLnRvVW5zaWduZWQoKS5sdGUocmhzLnRvVW5zaWduZWQoKSkgfTsKc3RkbGliJDEuaTY0X2dlX3MgPSBmdW5jdGlvbihsaHMsIHJocykgeyByZXR1cm4gbGhzLmd0ZShyaHMpIH07CnN0ZGxpYiQxLmk2NF9nZV91ID0gZnVuY3Rpb24obGhzLCByaHMpIHsgcmV0dXJuIGxocy50b1Vuc2lnbmVkKCkuZ3RlKHJocy50b1Vuc2lnbmVkKCkpIH07CnN0ZGxpYiQxLmk2NF9yb3RsID0gZnVuY3Rpb24odiwgbikgeyByZXR1cm4gdi5zaGwobikub3Iodi5zaHJ1KGxvbmdfMS5mcm9tTnVtYmVyKDY0KS5zdWIobikpKX07CnN0ZGxpYiQxLmk2NF9yb3RyID0gZnVuY3Rpb24odiwgbikgeyByZXR1cm4gdi5zaHJ1KG4pLm9yKHYuc2hsKGxvbmdfMS5mcm9tTnVtYmVyKDY0KS5zdWIobikpKX07CnN0ZGxpYiQxLmk2NF9jbHogPSBmdW5jdGlvbih2KSB7CiAgdmFyIGNvdW50ID0gc3RkbGliJDEuaTMyX2Nseih2LmdldEhpZ2hCaXRzKCkpOwogIGlmIChjb3VudCA9PT0gMzIpIHsKICAgIGNvdW50ICs9IHN0ZGxpYiQxLmkzMl9jbHoodi5nZXRMb3dCaXRzKCkpOwogIH0KICByZXR1cm4gbG9uZ18xLmZyb21OdW1iZXIoY291bnQpCn07ICAKc3RkbGliJDEuaTY0X2N0eiA9IGZ1bmN0aW9uKHYpIHsKICB2YXIgY291bnQgPSBzdGRsaWIkMS5pMzJfY3R6KHYuZ2V0TG93Qml0cygpKTsKICBpZiAoY291bnQgPT09IDMyKSB7CiAgICBjb3VudCArPSBzdGRsaWIkMS5pMzJfY3R6KHYuZ2V0SGlnaEJpdHMoKSk7CiAgfQogIHJldHVybiBsb25nXzEuZnJvbU51bWJlcihjb3VudCkKfTsKc3RkbGliJDEuaTY0X3BvcGNudCA9IGZ1bmN0aW9uKHYpIHsKICByZXR1cm4gbG9uZ18xLmZyb21OdW1iZXIoc3RkbGliJDEuaTMyX3BvcGNudCh2LmdldEhpZ2hCaXRzKCkpICsgc3RkbGliJDEuaTMyX3BvcGNudCh2LmdldExvd0JpdHMoKSkpCn07CnN0ZGxpYiQxLmk2NF9yZWludGVycHJldF9mNjQgPSBmdW5jdGlvbih2KSB7CiAgc2NyYXRjaERhdGEkMS5zZXRGbG9hdDY0KDAsIHYsIHRydWUpOwogIHZhciBsb3cgPSBzY3JhdGNoRGF0YSQxLmdldEludDMyKDAsIHRydWUpOwogIHZhciBoaWdoID0gc2NyYXRjaERhdGEkMS5nZXRJbnQzMig0LCB0cnVlKTsKICByZXR1cm4gbmV3IGxvbmdfMShsb3csIGhpZ2gpCn07CgovLyBmMzIgb3BlcmF0aW9ucwpzdGRsaWIkMS5Ub0YzMiA9IGZ1bmN0aW9uICh2KSB7CiAgaWYgKGlzTmFOKHYpICYmIHR5cGVvZiB2ID09PSAnb2JqZWN0JykgewogICAgcmV0dXJuIHYKICB9CiAgcmV0dXJuIE1hdGguZnJvdW5kKHYpCn07CnN0ZGxpYiQxLmYzMl9taW4gPSBNYXRoLm1pbjsKc3RkbGliJDEuZjMyX21heCA9IE1hdGgubWF4OwpzdGRsaWIkMS5mMzJfc3FydCA9IE1hdGguc3FydDsKc3RkbGliJDEuZjMyX2Zsb29yID0gTWF0aC5mbG9vcjsKc3RkbGliJDEuZjMyX2NlaWwgPSBNYXRoLmNlaWw7CnN0ZGxpYiQxLmYzMl90cnVuYyA9IE1hdGgudHJ1bmM7CnN0ZGxpYiQxLmYzMl9uZWFyZXN0ID0gZnVuY3Rpb24gKHYpIHsKICAvLyB0aWVzIHRvIGV2ZW4uLi50aGVyZSBtdXN0IGJlIGEgYmV0dGVyIHdheT8/CiAgaWYgKE1hdGguYWJzKHYgLSBNYXRoLnRydW5jKHYpKSA9PT0gMC41KSB7IHJldHVybiAyICogTWF0aC5yb3VuZCh2IC8gMikgfQogIHJldHVybiBNYXRoLnJvdW5kKHYpCn07CnN0ZGxpYiQxLmYzMl9hYnMgPSBmdW5jdGlvbiAodikgewogIGlmIChpc05hTih2KSkgewogICAgc2NyYXRjaERhdGEkMS5zZXRGbG9hdDMyKDAsIHYsIHRydWUpOwogICAgc2NyYXRjaEJ5dGVzJDFbM10gJj0gfjB4ODA7CiAgICB2YXIgcmVzID0gc2NyYXRjaERhdGEkMS5nZXRGbG9hdDMyKDAsIHRydWUpOwogICAgaWYgKHR5cGVvZiB2ID09PSAnb2JqZWN0JyAmJiB2Ll9zaWduYWxsaW5nKSB7CiAgICAgIHJlcyA9IG5ldyBOdW1iZXIocmVzKTsKICAgICAgcmVzLl9zaWduYWxsaW5nID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiByZXMKICB9CiAgcmV0dXJuIE1hdGguYWJzKHYpCn07CnN0ZGxpYiQxLmYzMl9uZWcgPSBmdW5jdGlvbiAodikgewogIGlmIChpc05hTih2KSkgewogICAgc2NyYXRjaERhdGEkMS5zZXRGbG9hdDMyKDAsIHYsIHRydWUpOwogICAgaWYgKHNjcmF0Y2hCeXRlcyQxWzNdICYgMHg4MCkgewogICAgICBzY3JhdGNoQnl0ZXMkMVszXSAmPSB+MHg4MDsKICAgIH0gZWxzZSB7CiAgICAgIHNjcmF0Y2hCeXRlcyQxWzNdIHw9IDB4ODA7CiAgICB9CiAgICB2YXIgcmVzID0gc2NyYXRjaERhdGEkMS5nZXRGbG9hdDMyKDAsIHRydWUpOwogICAgaWYgKHR5cGVvZiB2ID09PSAnb2JqZWN0JyAmJiB2Ll9zaWduYWxsaW5nKSB7CiAgICAgIHJlcyA9IG5ldyBOdW1iZXIocmVzKTsKICAgICAgcmVzLl9zaWduYWxsaW5nID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiByZXMKICB9CiAgcmV0dXJuIC12Cn07CnN0ZGxpYiQxLmYzMl9zaWdub2YgPSBmdW5jdGlvbih2KSB7CiAgaWYgKGlzTmFOKHYpKSB7CiAgICBzY3JhdGNoRGF0YSQxLnNldEZsb2F0MzIoMCwgdiwgdHJ1ZSk7CiAgICByZXR1cm4gKHNjcmF0Y2hCeXRlcyQxWzNdICYgMHg4MCkgPyAtMSA6IDEKICB9CiAgcmV0dXJuICh2ID4gMCB8fCAxIC8gdiA+IDApID8gMSA6IC0xCn07CnN0ZGxpYiQxLmYzMl9jb3B5c2lnbiA9IGZ1bmN0aW9uICh4LCB5KSB7CiAgdmFyIHNpZ24gPSBzdGRsaWIkMS5mMzJfc2lnbm9mKHkpOwogIGlmIChpc05hTih4KSkgewogICAgc2NyYXRjaERhdGEkMS5zZXRGbG9hdDMyKDAsIHgsIHRydWUpOwogICAgaWYgKHNpZ24gPT09IC0xKSB7CiAgICAgIHNjcmF0Y2hCeXRlcyQxWzNdIHw9IDB4ODA7CiAgICB9IGVsc2UgewogICAgICBzY3JhdGNoQnl0ZXMkMVszXSAmPSB+MHg4MDsKICAgIH0KICAgIHZhciB2ID0gc2NyYXRjaERhdGEkMS5nZXRGbG9hdDMyKDAsIHRydWUpOwogICAgaWYgKHR5cGVvZiB4ID09PSAnb2JqZWN0JyAmJiB4Ll9zaWduYWxsaW5nKSB7CiAgICAgIHYgPSBuZXcgTnVtYmVyKHYpOwogICAgICB2Ll9zaWduYWxsaW5nID0gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB2CiAgfQogIHJldHVybiBzaWduICogTWF0aC5hYnMoeCkKfTsKc3RkbGliJDEuZjMyX3JlaW50ZXJwcmV0X2kzMiA9IGZ1bmN0aW9uKHYpIHsKICBzY3JhdGNoRGF0YSQxLnNldEludDMyKDAsIHYsIHRydWUpOwogIHZhciB2ID0gc2NyYXRjaERhdGEkMS5nZXRGbG9hdDMyKDAsIHRydWUpOwogIGlmIChpc05hTih2KSkgewogICAgaWYgKCEoc2NyYXRjaEJ5dGVzJDFbMl0gJiAweDQwKSkgewogICAgICB2ID0gbmV3IE51bWJlcih2KTsKICAgICAgdi5fc2lnbmFsbGluZyA9IHRydWU7CiAgICB9CiAgfQogIHJldHVybiB2Cn07CnN0ZGxpYiQxLmYzMl9sb2FkX2ZpeF9zaWduYWxsaW5nID0gZnVuY3Rpb24odiwgSFU4LCBhZGRyKSB7CiAgaWYgKGlzTmFOKHYpKSB7CiAgICBpZiAoIShIVThbYWRkciArIDJdICYgMHg0MCkpIHsKICAgICAgdiA9IG5ldyBOdW1iZXIodik7CiAgICAgIHYuX3NpZ25hbGxpbmcgPSB0cnVlOwogICAgfQogIH0KICByZXR1cm4gdgp9OwpzdGRsaWIkMS5mMzJfc3RvcmVfZml4X3NpZ25hbGxpbmcgPSBmdW5jdGlvbih2LCBIVTgsIGFkZHIpIHsKICBpZiAoaXNOYU4odikpIHsKICAgIGlmICh0eXBlb2YgdiA9PT0gJ29iamVjdCcgJiYgdi5fc2lnbmFsbGluZykgewogICAgICBIVThbYWRkciArIDJdICY9IH4weDQwOwogICAgfQogIH0KfTsKCi8vIGY2NCBvcGVyYXRpb25zCnN0ZGxpYiQxLmY2NF9taW4gPSBNYXRoLm1pbjsKc3RkbGliJDEuZjY0X21heCA9IE1hdGgubWF4OwpzdGRsaWIkMS5mNjRfc3FydCA9IE1hdGguc3FydDsKc3RkbGliJDEuZjY0X2Zsb29yID0gTWF0aC5mbG9vcjsKc3RkbGliJDEuZjY0X2NlaWwgPSBNYXRoLmNlaWw7CnN0ZGxpYiQxLmY2NF90cnVuYyA9IE1hdGgudHJ1bmM7CnN0ZGxpYiQxLmY2NF9uZWFyZXN0ID0gc3RkbGliJDEuZjMyX25lYXJlc3Q7CnN0ZGxpYiQxLmY2NF9hYnMgPSBmdW5jdGlvbiAodikgewogIGlmIChpc05hTih2KSkgewogICAgc2NyYXRjaERhdGEkMS5zZXRGbG9hdDY0KDAsIHYsIHRydWUpOwogICAgc2NyYXRjaEJ5dGVzJDFbN10gJj0gfjB4ODA7CiAgICByZXR1cm4gc2NyYXRjaERhdGEkMS5nZXRGbG9hdDY0KDAsIHRydWUpCiAgfQogIHJldHVybiBNYXRoLmFicyh2KQp9OwpzdGRsaWIkMS5mNjRfbmVnID0gZnVuY3Rpb24gKHYpIHsKICBpZiAoaXNOYU4odikpIHsKICAgIHNjcmF0Y2hEYXRhJDEuc2V0RmxvYXQ2NCgwLCB2LCB0cnVlKTsKICAgIGlmIChzY3JhdGNoQnl0ZXMkMVs3XSAmIDB4ODApIHsKICAgICAgc2NyYXRjaEJ5dGVzJDFbN10gJj0gfjB4ODA7CiAgICB9IGVsc2UgewogICAgICBzY3JhdGNoQnl0ZXMkMVs3XSB8PSAweDgwOwogICAgfQogICAgcmV0dXJuIHNjcmF0Y2hEYXRhJDEuZ2V0RmxvYXQ2NCgwLCB0cnVlKQogIH0KICByZXR1cm4gLXYKfTsKc3RkbGliJDEuZjY0X3NpZ25vZiA9IGZ1bmN0aW9uKHYpIHsKICBpZiAoaXNOYU4odikpIHsKICAgIHNjcmF0Y2hEYXRhJDEuc2V0RmxvYXQ2NCgwLCB2LCB0cnVlKTsKICAgIHJldHVybiAoc2NyYXRjaEJ5dGVzJDFbN10gJiAweDgwKSA/IC0xIDogMQogIH0KICByZXR1cm4gKHYgPiAwIHx8IDEgLyB2ID4gMCkgPyAxIDogLTEKfTsKc3RkbGliJDEuZjY0X2NvcHlzaWduID0gZnVuY3Rpb24gKHgsIHkpIHsKICB2YXIgc2lnbiA9IHN0ZGxpYiQxLmY2NF9zaWdub2YoeSk7CiAgaWYgKGlzTmFOKHgpKSB7CiAgICBzY3JhdGNoRGF0YSQxLnNldEZsb2F0NjQoMCwgeCwgdHJ1ZSk7CiAgICBpZiAoc2lnbiA9PT0gLTEpIHsKICAgICAgc2NyYXRjaEJ5dGVzJDFbN10gfD0gMHg4MDsKICAgIH0gZWxzZSB7CiAgICAgIHNjcmF0Y2hCeXRlcyQxWzddICY9IH4weDgwOwogICAgfQogICAgcmV0dXJuIHNjcmF0Y2hEYXRhJDEuZ2V0RmxvYXQ2NCgwLCB0cnVlKQogIH0KICByZXR1cm4gc2lnbiAqIE1hdGguYWJzKHgpCn07CnN0ZGxpYiQxLmY2NF9yZWludGVycHJldF9pNjQgPSBmdW5jdGlvbih2KSB7CiAgc2NyYXRjaERhdGEkMS5zZXRJbnQzMigwLCB2LmxvdywgdHJ1ZSk7CiAgc2NyYXRjaERhdGEkMS5zZXRJbnQzMig0LCB2LmhpZ2gsIHRydWUpOwogIHJldHVybiBzY3JhdGNoRGF0YSQxLmdldEZsb2F0NjQoMCwgdHJ1ZSkKfTsKCi8vCi8vIFZhcmlvdXMgbWlzYyBoZWxwZXIgZnVuY3Rpb25zLgovLwoKCgpmdW5jdGlvbiBhc3NlcnRJc0RlZmluZWQob2JqKSB7CiAgaWYgKHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCkKICB9Cn0KCmZ1bmN0aW9uIGFzc2VydElzSW5zdGFuY2Uob2JqLCBDbHMpIHsKICBpZiAoIShvYmogaW5zdGFuY2VvZiBDbHMpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCkKICB9Cn0KCmZ1bmN0aW9uIGFzc2VydElzVHlwZShvYmosIHR5cHN0cikgewogIGlmICh0eXBlb2Ygb2JqICE9PSB0eXBzdHIpIHsKICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKQogIH0KfQoKZnVuY3Rpb24gYXNzZXJ0SXNDYWxsYWJsZShvYmopIHsKICAvLyBYWFggVE9ETzogbW9yZSBjb21wbGljYXRlZCBjYXNlcwogIGlmICh0eXBlb2Ygb2JqICE9PSAiZnVuY3Rpb24iICkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpCiAgfQp9CgpmdW5jdGlvbiBUb1dBU01WYWx1ZShqc1ZhbHVlLCB0eXApIHsKICBpZiAodHlwZW9mIGpzVmFsdWUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICByZXR1cm4ganNWYWx1ZQogIH0KICBpZiAodHlwZW9mIGpzVmFsdWUgIT09ICdudW1iZXInICYmICEgKGpzVmFsdWUgaW5zdGFuY2VvZiBOdW1iZXIpKSB7CiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJjYW50IHBhc3Mgbm9uLW51bWJlciBpbiB0byBXQVNNIikKICB9CiAgc3dpdGNoICh0eXApIHsKICAgIGNhc2UgVFlQRVMuSTMyOgogICAgICByZXR1cm4ganNWYWx1ZXwwCiAgICBjYXNlIFRZUEVTLkk2NDoKICAgICAgcmV0dXJuIGxvbmdfMS5mcm9tTnVtYmVyKGpzVmFsdWUpCiAgICBjYXNlIFRZUEVTLkYzMjoKICAgICAgcmV0dXJuIHN0ZGxpYiQxLlRvRjMyKGpzVmFsdWUpCiAgICBjYXNlIFRZUEVTLkY2NDoKICAgICAgcmV0dXJuICtqc1ZhbHVlCiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJVbmtub3duIHR5cGU6ICIgKyB0eXApCiAgfQp9CgpmdW5jdGlvbiBUb0pTVmFsdWUod2FzbVZhbHVlLCB0eXApIHsKICBzd2l0Y2ggKHR5cCkgewogICAgY2FzZSBUWVBFUy5JMzI6CiAgICBjYXNlIFRZUEVTLkYzMjoKICAgIGNhc2UgVFlQRVMuRjY0OgogICAgICByZXR1cm4gd2FzbVZhbHVlCiAgICBjYXNlIFRZUEVTLkk2NDoKICAgICAgLy8gWFhYIFRPRE86IHByZWNpc2Ugc2VtYW50aWNzIGhlcmU/CiAgICAgIC8vIEkgdGhpbmsgd2UncmUgc3VwcG9zZWQgdG8gcmV0dXJuIGFuIGVycm9yLi4uCiAgICAgIHJldHVybiB3YXNtVmFsdWUudG9OdW1iZXIoKQogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidW5rbm93biBXQVNNIHR5cGU6ICIgKyB0eXApCiAgfQp9CgpmdW5jdGlvbiBUb05vbldyYXBwaW5nVWludDMyKHYpIHsKICAvLyBYWFggVE9ETzogdGhyb3cgUmFuZ2VFcnJvciBpZiA+IFVJTlQzMl9NQVgKICByZXR1cm4gdiA+Pj4gMAp9Cgp2YXIgc2NyYXRjaEJ1ZiA9IG5ldyBBcnJheUJ1ZmZlcig4KTsKdmFyIHNjcmF0Y2hCeXRlcyA9IG5ldyBVaW50OEFycmF5KHNjcmF0Y2hCdWYpOwp2YXIgc2NyYXRjaERhdGEgPSBuZXcgRGF0YVZpZXcoc2NyYXRjaEJ1Zik7CgpmdW5jdGlvbiByZW5kZXJKU1ZhbHVlKHYsIGNvbnN0YW50cykgewogIC8vIFdlIG5lZWQgdG8gcHJlc2VydmUgdHdvIHRoaW5ncyB0aGF0IGRvbid0IHJvdW5kLXRyaXAgdGhyb3VnaCB2LnRvU3RyaW5nKCk6CiAgLy8gICogdGhlIGRpc3RpbmN0aW9uIGJldHdlZW4gLTAgYW5kIDAKICAvLyAgKiB0aGUgcHJlY2lzZSBiaXQtcGF0dGVybiBvZiBhbiBOYU4KICBpZiAodHlwZW9mIHYgPT09ICJudW1iZXIiIHx8ICh0eXBlb2YgdiA9PT0gIm9iamVjdCIgJiYgdiBpbnN0YW5jZW9mIE51bWJlcikpIHsKICAgIGlmIChpc05hTih2KSkgewogICAgICAvLyBYWFggVE9ETzogcmUtd29yayB0aGlzIHRvIGp1c3QgcGFzcyBpdCBpbiBhcyBhIGNvbnN0YW50CiAgICAgIHNjcmF0Y2hEYXRhLnNldEZsb2F0NjQoMCwgdiwgdHJ1ZSk7CiAgICAgIHJldHVybiAiV2ViQXNzZW1ibHkuX2Zyb21OYU5CeXRlcyhbIiArIHNjcmF0Y2hCeXRlcy5qb2luKCIsIikgKyAiXSwiICsgKCEhdi5fc2lnbmFsbGluZykgKyAiKSIKICAgIH0KICAgIHJldHVybiAiIiArICgoKHYgPCAwIHx8IDEgLyB2IDwgMCkgPyAiLSIgOiAiIikgKyBNYXRoLmFicyh2KSkKICB9CiAgLy8gU3BlY2lhbCByZW5kZXJpbmcgcmVxdWlyZWQgZm9yIExvbmcgaW5zdGFuY2VzLgogIGlmICh2IGluc3RhbmNlb2YgbG9uZ18xKSB7CiAgICByZXR1cm4gIm5ldyBMb25nKCIgKyB2LmxvdyArICIsIiArIHYuaGlnaCArICIpIgogIH0KICAvLyBRdW90ZSBzaW1wbGUgc3RyaW5ncyBkaXJlY3RseSwgYnV0IHBsYWNlIG1vcmUgY29tcGxleCBvbmVzCiAgLy8gYXMgY29uc3RhbnRzIHNvIHRoYXQgd2UgZG9uJ3QgaGF2ZSB0byB0cnkgdG8gZXNjYXBlIHRoZW0uCiAgaWYgKHR5cGVvZiB2ID09PSAnc3RyaW5nJykgewogICAgaWYgKC9eW0EtWmEtejAtOV8gJC1dKiQvLnRlc3QodikpIHsKICAgICAgcmV0dXJuICInIiArIHYgKyAiJyIKICAgIH0KICAgIGNvbnN0YW50cy5wdXNoKHYpOwogICAgcmV0dXJuICJjb25zdGFudHNbIiArIChjb25zdGFudHMubGVuZ3RoIC0gMSkgKyAiXSIKICB9CiAgLy8gRXZlcnl0aGluZyBlbHNlIGp1c3QgcmVuZGVycyBhcyBhIHN0cmluZy4KICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoJ3JlbmRlcmluZyB1bmtub3duIHR5cGUgb2YgdmFsdWU6ICcgKyAodHlwZW9mIHYpICsgIiA6ICIgKyB2KQogIHJldHVybiB2Cn0KCmZ1bmN0aW9uIF9mcm9tTmFOQnl0ZXMoYnl0ZXMsIGlzU2lnbmFsbGluZykgewogIGZvciAodmFyIGkgPSAwOyBpIDwgODsgaSsrKSB7CiAgICBzY3JhdGNoQnl0ZXNbaV0gPSBieXRlc1tpXTsKICB9CiAgdmFyIHYgPSBzY3JhdGNoRGF0YS5nZXRGbG9hdDY0KDAsIHRydWUpOwogIGlmIChpc1NpZ25hbGxpbmcpIHsKICAgIHYgPSBuZXcgTnVtYmVyKHYpOwogICAgdi5fc2lnbmFsbGluZyA9IHRydWU7CiAgfQogIHJldHVybiB2Cn0KCmZ1bmN0aW9uIG1ha2VTaWdTdHIoZnVuY1NpZykgewogICB2YXIgdHlwZUNvZGVzID0gW107CiAgIGZ1bmN0aW9uIHR5cGVDb2RlKHR5cCkgewogICAgIHN3aXRjaCAodHlwKSB7CiAgICAgICBjYXNlIFRZUEVTLkkzMjoKICAgICAgICAgcmV0dXJuICJpIgogICAgICAgY2FzZSBUWVBFUy5JNjQ6CiAgICAgICAgIHJldHVybiAibCIKICAgICAgIGNhc2UgVFlQRVMuRjMyOgogICAgICAgICByZXR1cm4gImYiCiAgICAgICBjYXNlIFRZUEVTLkY2NDoKICAgICAgICAgcmV0dXJuICJkIgogICAgICAgZGVmYXVsdDoKICAgICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bmV4cGVjdGVkIHR5cGU6ICIgKyB0eXApCiAgICAgfQogICB9CiAgIGZ1bmNTaWcucGFyYW1fdHlwZXMuZm9yRWFjaChmdW5jdGlvbih0eXApIHsKICAgICB0eXBlQ29kZXMucHVzaCh0eXBlQ29kZSh0eXApKTsKICAgfSk7CiAgIHR5cGVDb2Rlcy5wdXNoKCItPiIpOwogICBmdW5jU2lnLnJldHVybl90eXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cCkgewogICAgIHR5cGVDb2Rlcy5wdXNoKHR5cGVDb2RlKHR5cCkpOwogICB9KTsKICAgcmV0dXJuIHR5cGVDb2Rlcy5qb2luKCIiKQp9CgpmdW5jdGlvbiBkdW1wKCkgewogIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gInVuZGVmaW5lZCIgfHwgISBwcm9jZXNzLnN0ZGVycikgewogICAgcmV0dXJuIGNvbnNvbGUubG9nLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cykKICB9CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBhcmcgPSBhcmd1bWVudHNbaV07CiAgICBpZiAodHlwZW9mIGFyZyA9PT0gJ3N0cmluZycpIHsKICAgICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUoYXJnKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyZyA9PT0gJ251bWJlcicgfHwgKGFyZyBpbnN0YW5jZW9mIE51bWJlcikpIHsKICAgICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUocmVuZGVySlNWYWx1ZShhcmcpKTsKICAgIH0gZWxzZSB7CiAgICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlKEpTT04uc3RyaW5naWZ5KGFyZykpOwogICAgfQogICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUoJyAnKTsKICB9CiAgcHJvY2Vzcy5zdGRlcnIud3JpdGUoJ1xuJyk7Cn0KCi8vCi8vIFBhcnNlIFdBU00gYmluYXJ5IGZvcm1hdCBpbnRvIGFuIGluLW1lbW9yeSByZXByZXNlbnRhdGlvbi4KLy8KLy8gVGhpcyBpcyBhIGZhaXJseSBzdHJhaWdodGZvcndhcmQgcHJvY2VkdXJhbCBwYXJzZXIgZm9yIHRoZSBXQVNNCi8vIGJpbmFyeSBmb3JtYXQuICBJdCBnZW5lcmF0ZXMgYW4gb2JqZWN0IHdpdGggdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgovLwovLyAgewovLyAgICBzZWN0aW9uczogICA8YXJyYXkgb2Yga25vd24gc2VjdGlvbnMsIGluZGV4ZXMgYnkgc2VjdGlvbiBpZD4sCi8vICAgIGNvbnN0YW50czogIDxhcnJheSBvZiBjb25zdGFudHMgcGFyc2VkIG91dCBvZiB0aGUgYmluYXJ5PgovLyAgfQovLwovLyBZb3UgbXVzdCBwcm92aWRlIHRoZSBhcnJheSBvZiBwYXJzZWQgY29uc3RhbnRzIHdoZW4gaW5zdGFudGlhdGluZwovLyBhbiBpbnN0YW5jZSBmcm9tIHRoZSBwYXJzZWQgbW9kdWxlLgovLwovLyBCeSBmYXIgdGhlIG1vc3QgaW50ZXJlc3RpbmcgcGllY2Ugb2YgdGhpcyBtb2R1bGUsIGlzIHRoZSBwYXJzaW5nIG9mCi8vIGZ1bmN0aW9uIGNvZGUuICBJdCBjdXJyZW50IGRvZXMgYSBkaXJlY3Qgb3Bjb2RlLWJ5LW9wY29kZSB0cmFuc2xhdGlvbgovLyBpbnRvIEphdmFTY3JpcHQsIGJ1aWxkaW5nIHVwIGFuIGFycmF5IG9mIHN0cmluZ3MgaW4gbWVtb3J5IHRoYXQgd2UgY2FuCi8vIGxhdGVyIHJlbmRlciBpbnRvIGEgZnVsbCBmdW5jdGlvbiBkZWZpbml0aW9uLgovLwovLyBJdCdzIHByb2JhYmx5IHdvcnRoIHBhcnNpbmcgaW50byBhbiBpbnRlcm1lZGlhdGUgcmVwcmVzZW50YXRpb24gYXQKLy8gc29tZSBwb2ludCwgc28gdGhhdCB3ZSBjYW4gZG8gc29tZSBiYXNpYyBvcHRpbWl6YXRpb25zIHN1Y2ggYXMgY29udmVydGluZwovLyBzdGFjayBhY2Nlc3NlcyBpbnRvIGV4cHJlc3Npb25zLCBjb21iaW5pbmcgYm91bmRzIGNoZWNrcywgYW5kIHNvLW9uLgovLwoKZnVuY3Rpb24gcGFyc2VCaW5hcnlFbmNvZGluZyhieXRlcykgewoKICB2YXIgcyA9IG5ldyBQYXJzZVN0cmVhbShieXRlcyk7IAoKICB2YXIgc2VjdGlvbnMgPSBbbnVsbF07CiAgdmFyIGNvbnN0YW50cyA9IFtdOwoKICBwYXJzZUZpbGVIZWFkZXIoKTsKICBwYXJzZUtub3duU2VjdGlvbnMoKTsKCiAgcmV0dXJuIHsKICAgIHNlY3Rpb25zOiBzZWN0aW9ucywKICAgIGNvbnN0YW50czogY29uc3RhbnRzCiAgfQoKICBmdW5jdGlvbiBwYXJzZVZhbHVlVHlwZSgpIHsKICAgIHZhciB2ID0gcy5yZWFkX3ZhcmludDcoKTsKICAgIGlmICh2ID49IDAgfHwgdiA8IFRZUEVTLkY2NCkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIkludmFsaWQgdmFsdWVfdHlwZTogIiArIHYpCiAgICB9CiAgICByZXR1cm4gdgogIH0KCiAgZnVuY3Rpb24gcGFyc2VCbG9ja1R5cGUoKSB7CiAgICB2YXIgdiA9IHMucmVhZF92YXJpbnQ3KCk7CiAgICBpZiAodiA+PSAwIHx8ICh2IDwgVFlQRVMuRjY0ICYmIHYgIT09IFRZUEVTLk5PTkUpKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiSW52YWxpZCBibG9ja190eXBlOiAiICsgdikKICAgIH0KICAgIHJldHVybiB2CiAgfQoKICBmdW5jdGlvbiBwYXJzZUVsZW1UeXBlKCkgewogICAgdmFyIHYgPSBzLnJlYWRfdmFyaW50NygpOwogICAgaWYgKHYgIT09IFRZUEVTLkFOWUZVTkMpIHsKICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJJbnZhbGlkIGVsZW1fdHlwZTogIiArIHYpCiAgICB9CiAgICByZXR1cm4gdgogIH0KCiAgZnVuY3Rpb24gcGFyc2VFeHRlcm5hbEtpbmQoKSB7CiAgICB2YXIgdiA9IHMucmVhZF91aW50OCgpOwogICAgaWYgKHYgPiBFWFRFUk5BTF9LSU5EUy5HTE9CQUwpIHsKICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJJbnZhbGlkIGV4dGVybmFsX2tpbmQ6ICIgKyB2KQogICAgfQogICAgcmV0dXJuIHYKICB9CgogIGZ1bmN0aW9uIHBhcnNlRnVuY1R5cGUoKSB7CiAgICB2YXIgZiA9IHt9OwogICAgZi5mb3JtID0gcy5yZWFkX3ZhcmludDcoKTsKICAgIGlmIChmLmZvcm0gIT09IFRZUEVTLkZVTkMpIHsKICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJJbnZhbGlkIGZ1bmNfdHlwZSBmb3JtOiAiICsgZi5mb3JtKQogICAgfQogICAgdmFyIHBhcmFtX2NvdW50ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwogICAgZi5wYXJhbV90eXBlcyA9IFtdOwogICAgd2hpbGUgKHBhcmFtX2NvdW50ID4gMCkgewogICAgICBmLnBhcmFtX3R5cGVzLnB1c2gocGFyc2VWYWx1ZVR5cGUoKSk7CiAgICAgIHBhcmFtX2NvdW50LS07CiAgICB9CiAgICB2YXIgcmV0dXJuX2NvdW50ID0gcy5yZWFkX3ZhcnVpbnQxKCk7CiAgICBmLnJldHVybl90eXBlcyA9IFtdOwogICAgd2hpbGUgKHJldHVybl9jb3VudCA+IDApIHsKICAgICAgZi5yZXR1cm5fdHlwZXMucHVzaChwYXJzZVZhbHVlVHlwZSgpKTsKICAgICAgcmV0dXJuX2NvdW50LS07CiAgICB9CiAgICByZXR1cm4gZgogIH0KCiAgZnVuY3Rpb24gcGFyc2VHbG9iYWxUeXBlKCkgewogICAgdmFyIGcgPSB7fTsKICAgIGcuY29udGVudF90eXBlID0gcGFyc2VWYWx1ZVR5cGUoKTsKICAgIGcubXV0YWJpbGl0eSA9IHMucmVhZF92YXJ1aW50MSgpOwogICAgcmV0dXJuIGcKICB9CgogIGZ1bmN0aW9uIHBhcnNlVGFibGVUeXBlKCkgewogICAgdmFyIHQgPSB7fTsKICAgIHQuZWxlbWVudF90eXBlID0gcGFyc2VFbGVtVHlwZSgpOwogICAgdC5saW1pdHMgPSBwYXJzZVJlc2l6YWJsZUxpbWl0cygpOwogICAgcmV0dXJuIHQKICB9CgogIGZ1bmN0aW9uIHBhcnNlTWVtb3J5VHlwZSgpIHsKICAgIHZhciBtID0ge307CiAgICBtLmxpbWl0cyA9IHBhcnNlUmVzaXphYmxlTGltaXRzKCk7CiAgICBpZiAobS5saW1pdHMuaW5pdGlhbCA+IDY1NTM2KSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibWVtb3J5IHNpemUgZ3JlYXQgdGhhbiA0R2lCIikKICAgIH0KICAgIGlmIChtLmxpbWl0cy5tYXhpbXVtICYmIG0ubGltaXRzLm1heGltdW0gPiA2NTUzNikgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm1lbW9yeSBzaXplIGdyZWF0IHRoYW4gNEdpQiIpCiAgICB9CiAgICByZXR1cm4gbQogIH0KCiAgZnVuY3Rpb24gcGFyc2VSZXNpemFibGVMaW1pdHMoKSB7CiAgICB2YXIgbCA9IHt9OwogICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQxKCk7CiAgICBsLmluaXRpYWwgPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICBpZiAoZmxhZ3MpIHsKICAgICAgbC5tYXhpbXVtID0gcy5yZWFkX3ZhcnVpbnQzMigpOwogICAgICBpZiAobC5tYXhpbXVtIDwgbC5pbml0aWFsKSB7CiAgICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJtYXhpbXVtIGNhbm5vdCBiZSBsZXNzIHRoYW4gaW5pdGlhbCIpCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGwubWF4aW11bSA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gbAogIH0KCiAgZnVuY3Rpb24gcGFyc2VJbml0RXhwcih0eXApIHsKICAgIHZhciBlID0ge307CiAgICBlLm9wID0gcy5yZWFkX2J5dGUoKTsKICAgIHN3aXRjaCAoZS5vcCkgewogICAgICBjYXNlIE9QQ09ERVMuSTMyX0NPTlNUOgogICAgICAgIGlmICh0eXAgIT09IFRZUEVTLkkzMikgewogICAgICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJpbnZhbGlkIGluaXRfZXhwciB0eXBlOiAiICsgdHlwKQogICAgICAgIH0KICAgICAgICBlLmpzZXhwciA9IHJlbmRlckpTVmFsdWUocy5yZWFkX3ZhcmludDMyKCksIGNvbnN0YW50cyk7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSBPUENPREVTLkk2NF9DT05TVDoKICAgICAgICBpZiAodHlwICE9PSBUWVBFUy5JNjQpIHsKICAgICAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiaW52YWxpZCBpbml0X2V4cHIgdHlwZTogIiArIHR5cCkKICAgICAgICB9CiAgICAgICAgZS5qc2V4cHIgPSByZW5kZXJKU1ZhbHVlKHMucmVhZF92YXJpbnQ2NCgpLCBjb25zdGFudHMpOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgT1BDT0RFUy5GMzJfQ09OU1Q6CiAgICAgICAgaWYgKHR5cCAhPT0gVFlQRVMuRjMyKSB7CiAgICAgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImludmFsaWQgaW5pdF9leHByIHR5cGU6ICIgKyB0eXApCiAgICAgICAgfQogICAgICAgIGUuanNleHByID0gcmVuZGVySlNWYWx1ZShzLnJlYWRfZmxvYXQzMigpLCBjb25zdGFudHMpOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgT1BDT0RFUy5GNjRfQ09OU1Q6CiAgICAgICAgaWYgKHR5cCAhPT0gVFlQRVMuRjY0KSB7CiAgICAgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImludmFsaWQgaW5pdF9leHByIHR5cGU6ICIgKyB0eXApCiAgICAgICAgfQogICAgICAgIGUuanNleHByID0gcmVuZGVySlNWYWx1ZShzLnJlYWRfZmxvYXQ2NCgpLCBjb25zdGFudHMpOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgT1BDT0RFUy5HRVRfR0xPQkFMOgogICAgICAgIHZhciBpbmRleCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgICB2YXIgZ2xvYmFscyA9IGdldEltcG9ydGVkR2xvYmFscygpOwogICAgICAgIGlmIChpbmRleCA+PSBnbG9iYWxzLmxlbmd0aCkgewogICAgICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJpbml0X2V4cHIgcmVmZXJzIHRvIG5vbi1pbXBvcnRlZCBnbG9iYWw6ICIgKyBpbmRleCkKICAgICAgICB9CiAgICAgICAgaWYgKGdsb2JhbHNbaW5kZXhdLnR5cGUuY29udGVudF90eXBlICE9PSB0eXApIHsKICAgICAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiaW5pdF9leHByIHJlZmVycyB0byBnbG9iYWwgb2YgaW5jb3JyZWN0IHR5cGUiKQogICAgICAgIH0KICAgICAgICBpZiAoZ2xvYmFsc1tpbmRleF0udHlwZS5tdXRhYmlsaXR5KSB7CiAgICAgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImluaXRfZXhwciByZWZlcnMgdG8gbXV0YWJsZSBnbG9iYWwiKQogICAgICAgIH0KICAgICAgICBlLmpzZXhwciA9ICJHIiArIGluZGV4OwogICAgICAgIGJyZWFrCiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJVbnN1cHBvcnRlZCBpbml0IGV4cHIgb3Bjb2RlOiAweCIgKyBlLm9wLnRvU3RyaW5nKDE2KSkKICAgIH0KICAgIGlmIChzLnJlYWRfYnl0ZSgpICE9PSBPUENPREVTLkVORCkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIlVuc3VwcG9ydGVkIGluaXQgZXhwciBjb2RlIikKICAgIH0KICAgIHJldHVybiBlCiAgfQoKICBmdW5jdGlvbiBwYXJzZUZpbGVIZWFkZXIoKSB7CiAgICBpZiAocy5yZWFkX3VpbnQzMigpICE9PSBUT0tFTlMuTUFHSUNfTlVNQkVSKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiaW5jb3JyZWN0IG1hZ2ljIG51bWJlciIpCiAgICB9CiAgICBpZiAocy5yZWFkX3VpbnQzMigpICE9PSBUT0tFTlMuVkVSU0lPTl9OVU1CRVIpIHsKICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJpbmNvcnJlY3QgdmVyc2lvbiBudW1iZXIiKQogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VLbm93blNlY3Rpb25zKCkgewogICAgd2hpbGUgKHMuaGFzX21vcmVfYnl0ZXMoKSkgewogICAgICB2YXIgaWQgPSBzLnJlYWRfdmFydWludDcoKTsKICAgICAgdmFyIHBheWxvYWRfbGVuID0gcy5yZWFkX3ZhcnVpbnQzMigpOwogICAgICB2YXIgbmV4dF9zZWN0aW9uX2lkeCA9IHMuaWR4ICsgcGF5bG9hZF9sZW47CiAgICAgIC8vIElnbm9yaW5nIG5hbWVkIHNlY3Rpb25zIGZvciBub3csIGJ1dCBwYXJzaW5nCiAgICAgIC8vIHRoZW0ganVzdCBlbm91Z2ggdG8gZGV0ZWN0IHdlbGwtZm9ybWVkbmVzcy4KICAgICAgaWYgKCFpZCkgewogICAgICAgIHZhciBuYW1lX2xlbiA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgICBkdW1wKCJjdXN0b20gc2VjdGlvbjogIiwgcy5yZWFkX2J5dGVzKG5hbWVfbGVuKSk7CiAgICAgICAgcy5za2lwX3RvKG5leHRfc2VjdGlvbl9pZHgpOwogICAgICAgIGNvbnRpbnVlCiAgICAgIH0KICAgICAgLy8gS25vd24gc2VjdGlvbnMgYXJlIG5vdCBhbGxvd2VkIHRvIGFwcGVhciBvdXQtb2Ytb3JkZXIuCiAgICAgIGlmIChpZCA8IHNlY3Rpb25zLmxlbmd0aCkgeyB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm91dC1vZi1vcmRlciBzZWN0aW9uOiAiICsgaWQudG9TdHJpbmcoKSkgfQogICAgICAvLyBCdXQgc29tZSBzZWN0aW9ucyBtYXkgYmUgbWlzc2luZy4KICAgICAgd2hpbGUgKHNlY3Rpb25zLmxlbmd0aCA8IGlkKSB7CiAgICAgICAgc2VjdGlvbnMucHVzaChudWxsKTsKICAgICAgfQogICAgICBzZWN0aW9ucy5wdXNoKHBhcnNlU2VjdGlvbihpZCkpOwogICAgICAvLyBDaGVjayB0aGF0IHdlIGRpZG4ndCByZWFkeSBwYXN0IHRoZSBkZWNsYXJlZCBlbmQgb2Ygc2VjdGlvbi4KICAgICAgLy8gSXQncyBPSyBpZiB0aGVyZSB3YXMgc29tZSBleHRyYSBwYWRkaW5nIGdhcmJhZ2UgaW4gdGhlIHBheWxvYWQgZGF0YS4KICAgICAgcy5za2lwX3RvKG5leHRfc2VjdGlvbl9pZHgpOwogICAgfQogICAgLy8gRmlsbCB0aGUgcmVzdCBvZiB0aGUga25vd24gc2VjdGlvbnMgd2l0aCBudWxscy4KICAgIHdoaWxlIChzZWN0aW9ucy5sZW5ndGggPD0gU0VDVElPTlMuREFUQSkgewogICAgICBzZWN0aW9ucy5wdXNoKG51bGwpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VTZWN0aW9uKGlkKSB7CiAgICBzd2l0Y2ggKGlkKSB7CiAgICAgIGNhc2UgU0VDVElPTlMuVFlQRToKCXJldHVybiBwYXJzZVR5cGVTZWN0aW9uKCkKICAgICAgY2FzZSBTRUNUSU9OUy5JTVBPUlQ6CglyZXR1cm4gcGFyc2VJbXBvcnRTZWN0aW9uKCkKICAgICAgY2FzZSBTRUNUSU9OUy5GVU5DVElPTjoKCXJldHVybiBwYXJzZUZ1bmN0aW9uU2VjdGlvbigpCiAgICAgIGNhc2UgU0VDVElPTlMuVEFCTEU6CglyZXR1cm4gcGFyc2VUYWJsZVNlY3Rpb24oKQogICAgICBjYXNlIFNFQ1RJT05TLk1FTU9SWToKCXJldHVybiBwYXJzZU1lbW9yeVNlY3Rpb24oKQogICAgICBjYXNlIFNFQ1RJT05TLkdMT0JBTDoKCXJldHVybiBwYXJzZUdsb2JhbFNlY3Rpb24oKQogICAgICBjYXNlIFNFQ1RJT05TLkVYUE9SVDoKCXJldHVybiBwYXJzZUV4cG9ydFNlY3Rpb24oKQogICAgICBjYXNlIFNFQ1RJT05TLlNUQVJUOgoJcmV0dXJuIHBhcnNlU3RhcnRTZWN0aW9uKCkKICAgICAgY2FzZSBTRUNUSU9OUy5FTEVNRU5UOgoJcmV0dXJuIHBhcnNlRWxlbWVudFNlY3Rpb24oKQogICAgICBjYXNlIFNFQ1RJT05TLkNPREU6CglyZXR1cm4gcGFyc2VDb2RlU2VjdGlvbigpCiAgICAgIGNhc2UgU0VDVElPTlMuREFUQToKCXJldHVybiBwYXJzZURhdGFTZWN0aW9uKCkKICAgICAgZGVmYXVsdDoKCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5rbm93biBzZWN0aW9uIGNvZGU6ICIgKyBpZCkKICAgIH0KICB9CgogIGZ1bmN0aW9uIHBhcnNlVHlwZVNlY3Rpb24oKSB7CiAgICB2YXIgY291bnQgPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICB2YXIgZW50cmllcyA9IFtdOwogICAgd2hpbGUgKGNvdW50ID4gMCkgewogICAgICBlbnRyaWVzLnB1c2gocGFyc2VGdW5jVHlwZSgpKTsKICAgICAgY291bnQtLTsKICAgIH0KICAgIHJldHVybiBlbnRyaWVzCiAgfQoKICB2YXIgaGFzVGFibGUgPSBmYWxzZTsKICB2YXIgaGFzTWVtb3J5ID0gZmFsc2U7CgogIGZ1bmN0aW9uIHBhcnNlSW1wb3J0U2VjdGlvbigpIHsKICAgIHZhciBjb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAgICAgIGVudHJpZXMucHVzaChwYXJzZUltcG9ydEVudHJ5KCkpOwogICAgICBjb3VudC0tOwogICAgfQogICAgcmV0dXJuIGVudHJpZXMKCiAgICBmdW5jdGlvbiBwYXJzZUltcG9ydEVudHJ5KCkgewogICAgICB2YXIgaSA9IHt9OwogICAgICB2YXIgbW9kdWxlX2xlbiA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgaS5tb2R1bGVfbmFtZSA9IHMucmVhZF9ieXRlcyhtb2R1bGVfbGVuKTsKICAgICAgdmFyIGZpZWxkX2xlbiA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgaS5pdGVtX25hbWUgPSBzLnJlYWRfYnl0ZXMoZmllbGRfbGVuKTsKICAgICAgaS5raW5kID0gcGFyc2VFeHRlcm5hbEtpbmQoKTsKICAgICAgc3dpdGNoIChpLmtpbmQpIHsKCWNhc2UgRVhURVJOQUxfS0lORFMuRlVOQ1RJT046CgkgIGkudHlwZSA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgaWYgKGkudHlwZSA+PSAoc2VjdGlvbnNbU0VDVElPTlMuVFlQRV0gfHwgW10pLmxlbmd0aCkgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiaW1wb3J0IGhhcyB1bmtub3duIHR5cGU6ICIgKyBpLnR5cGUpCgkgIH0KCSAgYnJlYWsKCWNhc2UgRVhURVJOQUxfS0lORFMuVEFCTEU6CgkgIGlmIChoYXNUYWJsZSkgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibXVsdGlwbGUgdGFibGVzIikKCSAgfQoJICBoYXNUYWJsZSA9IHRydWU7CgkgIGkudHlwZSA9IHBhcnNlVGFibGVUeXBlKCk7CgkgIGJyZWFrCgljYXNlIEVYVEVSTkFMX0tJTkRTLk1FTU9SWToKCSAgaWYgKGhhc01lbW9yeSkgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibXVsdGlwbGUgbWVtb3JpZXMiKQoJICB9CgkgIGhhc01lbW9yeSA9IHRydWU7CgkgIGkudHlwZSA9IHBhcnNlTWVtb3J5VHlwZSgpOwoJICBicmVhawoJY2FzZSBFWFRFUk5BTF9LSU5EUy5HTE9CQUw6CgkgIGkudHlwZSA9IHBhcnNlR2xvYmFsVHlwZSgpOwoJICBpZiAoaS50eXBlLm11dGFiaWxpdHkpIHsKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm11dGFibGUgZ2xvYmFscyBjYW5ub3QgYmUgaW1wb3J0ZWQiKQoJICB9CgkgIGJyZWFrCglkZWZhdWx0OgoJICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVua25vd24gaW1wb3J0IGtpbmQ6IiArIGkua2luZCkKICAgICAgfQogICAgICByZXR1cm4gaQogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VGdW5jdGlvblNlY3Rpb24oKSB7CiAgICB2YXIgY291bnQgPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICB2YXIgdHlwZXMgPSBbXTsKICAgIHdoaWxlIChjb3VudCA+IDApIHsKICAgICAgdHlwZXMucHVzaChzLnJlYWRfdmFydWludDMyKCkpOwogICAgICBjb3VudC0tOwogICAgfQogICAgcmV0dXJuIHR5cGVzCiAgfQoKICBmdW5jdGlvbiBwYXJzZVRhYmxlU2VjdGlvbigpIHsKICAgIHZhciBjb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAgICAgIGlmIChoYXNUYWJsZSkgewoJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJtdWx0aXBsZSB0YWJsZXMiKQogICAgICB9CiAgICAgIGhhc1RhYmxlID0gdHJ1ZTsKICAgICAgZW50cmllcy5wdXNoKHBhcnNlVGFibGVUeXBlKCkpOwogICAgICBjb3VudC0tOwogICAgfQogICAgaWYgKGVudHJpZXMubGVuZ3RoID4gMSkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm1vcmUgdGhhbiBvbmUgdGFibGUgZW50cnkiKQogICAgfQogICAgcmV0dXJuIGVudHJpZXMKICB9CgogIGZ1bmN0aW9uIHBhcnNlTWVtb3J5U2VjdGlvbigpIHsKICAgIHZhciBjb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAgICAgIGlmIChoYXNNZW1vcnkpIHsKCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibXVsdGlwbGUgbWVtb3JpZXMiKQogICAgICB9CiAgICAgIGhhc01lbW9yeSA9IHRydWU7CiAgICAgIGVudHJpZXMucHVzaChwYXJzZU1lbW9yeVR5cGUoKSk7CiAgICAgIGNvdW50LS07CiAgICB9CiAgICBpZiAoZW50cmllcy5sZW5ndGggPiAxKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibW9yZSB0aGFuIG9uZSBtZW1vcnkgZW50cnkiKQogICAgfQogICAgcmV0dXJuIGVudHJpZXMKICB9CgogIGZ1bmN0aW9uIHBhcnNlR2xvYmFsU2VjdGlvbigpIHsKICAgIHZhciBjb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIHZhciBnbG9iYWxzID0gW107CiAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAgICAgIGdsb2JhbHMucHVzaChwYXJzZUdsb2JhbFZhcmlhYmxlKCkpOwogICAgICBjb3VudC0tOwogICAgfQogICAgcmV0dXJuIGdsb2JhbHMKCiAgICBmdW5jdGlvbiBwYXJzZUdsb2JhbFZhcmlhYmxlKCkgewogICAgICB2YXIgZyA9IHt9OwogICAgICBnLnR5cGUgPSBwYXJzZUdsb2JhbFR5cGUoKTsKICAgICAgZy5pbml0ID0gcGFyc2VJbml0RXhwcihnLnR5cGUuY29udGVudF90eXBlKTsKICAgICAgcmV0dXJuIGcKICAgIH0KICB9CgogIGZ1bmN0aW9uIHBhcnNlRXhwb3J0U2VjdGlvbigpIHsKICAgIHZhciBudW1JbXBvcnRlZEZ1bmN0aW9ucyA9IGdldEltcG9ydGVkRnVuY3Rpb25zKCkubGVuZ3RoOwogICAgdmFyIG51bUltcG9ydGVkR2xvYmFscyA9IGdldEltcG9ydGVkR2xvYmFscygpLmxlbmd0aDsKICAgIHZhciBudW1JbXBvcnRlZFRhYmxlcyA9IGdldEltcG9ydGVkVGFibGVzKCkubGVuZ3RoOwogICAgdmFyIG51bUltcG9ydGVkTWVtb3JpZXMgPSBnZXRJbXBvcnRlZE1lbW9yaWVzKCkubGVuZ3RoOwoKICAgIHZhciBjb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICB2YXIgc2VlbkZpZWxkcyA9IHt9OwogICAgd2hpbGUgKGNvdW50ID4gMCkgewogICAgICBlbnRyaWVzLnB1c2gocGFyc2VFeHBvcnRFbnRyeSgpKTsKICAgICAgY291bnQtLTsKICAgIH0KICAgIHJldHVybiBlbnRyaWVzCgogICAgZnVuY3Rpb24gcGFyc2VFeHBvcnRFbnRyeSgpIHsKICAgICAgdmFyIGUgPSB7fTsKICAgICAgdmFyIGZpZWxkX2xlbiA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgZS5maWVsZCA9IHMucmVhZF9ieXRlcyhmaWVsZF9sZW4pOwogICAgICBpZiAoZS5maWVsZCBpbiBzZWVuRmllbGRzKSB7Cgl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImR1cGxpY2F0ZSBleHBvcnQgbmFtZTogIiArIGUuZmllbGQpCiAgICAgIH0KICAgICAgc2VlbkZpZWxkc1tlLmZpZWxkXSA9IHRydWU7CiAgICAgIGUua2luZCA9IHBhcnNlRXh0ZXJuYWxLaW5kKCk7CiAgICAgIGUuaW5kZXggPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICAgIHN3aXRjaCAoZS5raW5kKSB7CgljYXNlIEVYVEVSTkFMX0tJTkRTLkZVTkNUSU9OOgoJICBpZiAoZS5pbmRleCA+PSAoc2VjdGlvbnNbU0VDVElPTlMuRlVOQ1RJT05dfHxbXSkubGVuZ3RoICsgbnVtSW1wb3J0ZWRGdW5jdGlvbnMpIHsKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImV4cG9ydCBvZiBub24tZXhpc3RlbnQgZnVuY3Rpb24iKQoJICB9CgkgIGJyZWFrCgljYXNlIEVYVEVSTkFMX0tJTkRTLkdMT0JBTDoKCSAgaWYgKGUuaW5kZXggPj0gKHNlY3Rpb25zW1NFQ1RJT05TLkdMT0JBTF18fFtdKS5sZW5ndGggKyBudW1JbXBvcnRlZEdsb2JhbHMpIHsKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImV4cG9ydCBvZiBub24tZXhpc3RlbnQgZ2xvYmFsIikKCSAgfQoJICBpZiAoZ2V0R2xvYmFsTXV0YWJpbGl0eShlLmluZGV4KSkgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibXV0YWJsZSBnbG9iYWxzIGNhbm5vdCBiZSBleHBvcnRlZCIpCgkgIH0KCSAgYnJlYWsKCWNhc2UgRVhURVJOQUxfS0lORFMuVEFCTEU6CgkgIGlmIChlLmluZGV4ID49IChzZWN0aW9uc1tTRUNUSU9OUy5UQUJMRV18fFtdKS5sZW5ndGggKyBudW1JbXBvcnRlZFRhYmxlcykgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiZXhwb3J0IG9mIG5vbi1leGlzdGVudCB0YWJsZSIpCgkgIH0KCSAgYnJlYWsKCWNhc2UgRVhURVJOQUxfS0lORFMuTUVNT1JZOgoJICBpZiAoZS5pbmRleCA+PSAoc2VjdGlvbnNbU0VDVElPTlMuTUVNT1JZXXx8W10pLmxlbmd0aCArIG51bUltcG9ydGVkTWVtb3JpZXMpIHsKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImV4cG9ydCBvZiBub24tZXhpc3RlbnQgbWVtb3J5IikKCSAgfQoJICBicmVhawoJZGVmYXVsdDoKCSAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bmNoZWNrZWQgZXhwb3J0IGtpbmQ6ICIgKyBlLmtpbmQpCiAgICAgIH0KICAgICAgLy8gWFhYIFRPRE86IGVhcmx5IGNoZWNrIHRoYXQgaW5kZXggaXMgd2l0aGluIGJvdW5kcyBmb3IgcmVsZXZhbnQgaW5kZXggc3BhY2U/CiAgICAgIHJldHVybiBlCiAgICB9CiAgfQoKICBmdW5jdGlvbiBwYXJzZVN0YXJ0U2VjdGlvbigpIHsKICAgIHZhciBmdW5jX2luZGV4ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwogICAgdmFyIHNpZyA9IGdldEZ1bmN0aW9uU2lnbmF0dXJlKGZ1bmNfaW5kZXgpOwogICAgaWYgKHNpZy5wYXJhbV90eXBlcy5sZW5ndGggPiAwKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgic3RhcnQgZnVuY3Rpb24gbXVzdCB0YWtlIG5vIHBhcmFtZXRlcnMiKQogICAgfQogICAgaWYgKHNpZy5yZXR1cm5fdHlwZXMubGVuZ3RoID4gMCkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInN0YXJ0IGZ1bmN0aW9uIG11c3QgcmV0dXJuIG5vIHJlc3VsdHMiKQogICAgfQogICAgcmV0dXJuIGZ1bmNfaW5kZXgKICB9CgogIGZ1bmN0aW9uIHBhcnNlRWxlbWVudFNlY3Rpb24oKSB7CiAgICB2YXIgY291bnQgPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICB2YXIgZW50cmllcyA9IFtdOwogICAgd2hpbGUgKGNvdW50ID4gMCkgewogICAgICBlbnRyaWVzLnB1c2gocGFyc2VFbGVtZW50U2VnbWVudCgpKTsKICAgICAgY291bnQtLTsKICAgIH0KICAgIHJldHVybiBlbnRyaWVzCgogICAgZnVuY3Rpb24gcGFyc2VFbGVtZW50U2VnbWVudCgpIHsKICAgICAgdmFyIGUgPSB7fTsKICAgICAgZS5pbmRleCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgaWYgKGUuaW5kZXggIT09IDApIHsKCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiTVZQIHJlcXVpcmVzIGVsZW1lbnRzIGluZGV4IGJlIHplcm8iKQogICAgICB9CiAgICAgIC8vIENoZWNrIHRoYXQgaXQncyBhIHZhbGlkIHRhYmxlIHJlZmVyZW5jZS4KICAgICAgZ2V0VGFibGVUeXBlKGUuaW5kZXgpOwogICAgICBlLm9mZnNldCA9IHBhcnNlSW5pdEV4cHIoVFlQRVMuSTMyKTsKICAgICAgdmFyIG51bV9lbGVtcyA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgZS5lbGVtcyA9IFtdOwogICAgICB3aGlsZSAobnVtX2VsZW1zID4gMCkgewoJZS5lbGVtcy5wdXNoKHMucmVhZF92YXJ1aW50MzIoKSk7CgludW1fZWxlbXMtLTsKICAgICAgfQogICAgICByZXR1cm4gZQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0SW1wb3J0ZWRGdW5jdGlvbnMoKSB7CiAgICB2YXIgaW1wb3J0cyA9IHNlY3Rpb25zW1NFQ1RJT05TLklNUE9SVF0gfHwgW107CiAgICB2YXIgaW1wb3J0ZWRGdW5jcyA9IFtdOwogICAgaW1wb3J0cy5mb3JFYWNoKGZ1bmN0aW9uKGksIGluZGV4KSB7CiAgICAgIGlmIChpLmtpbmQgPT09IEVYVEVSTkFMX0tJTkRTLkZVTkNUSU9OKSB7CglpbXBvcnRlZEZ1bmNzLnB1c2goaW5kZXgpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBpbXBvcnRlZEZ1bmNzCiAgfQoKICBmdW5jdGlvbiBnZXRJbXBvcnRlZEdsb2JhbHMoKSB7CiAgICB2YXIgaW1wb3J0cyA9IHNlY3Rpb25zW1NFQ1RJT05TLklNUE9SVF0gfHwgW107CiAgICB2YXIgaW1wb3J0ZWRHbG9iYWxzID0gW107CiAgICBpbXBvcnRzLmZvckVhY2goZnVuY3Rpb24oaSwgaW5kZXgpIHsKICAgICAgaWYgKGkua2luZCA9PT0gRVhURVJOQUxfS0lORFMuR0xPQkFMKSB7CglpbXBvcnRlZEdsb2JhbHMucHVzaChpKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gaW1wb3J0ZWRHbG9iYWxzCiAgfQoKICBmdW5jdGlvbiBnZXRJbXBvcnRlZFRhYmxlcygpIHsKICAgIHZhciBpbXBvcnRzID0gc2VjdGlvbnNbU0VDVElPTlMuSU1QT1JUXSB8fCBbXTsKICAgIHZhciBpbXBvcnRlZFRhYmxlcyA9IFtdOwogICAgaW1wb3J0cy5mb3JFYWNoKGZ1bmN0aW9uKGksIGluZGV4KSB7CiAgICAgIGlmIChpLmtpbmQgPT09IEVYVEVSTkFMX0tJTkRTLlRBQkxFKSB7CglpbXBvcnRlZFRhYmxlcy5wdXNoKGkudHlwZSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGltcG9ydGVkVGFibGVzCiAgfQoKICBmdW5jdGlvbiBnZXRJbXBvcnRlZE1lbW9yaWVzKCkgewogICAgdmFyIGltcG9ydHMgPSBzZWN0aW9uc1tTRUNUSU9OUy5JTVBPUlRdIHx8IFtdOwogICAgdmFyIGltcG9ydGVkTWVtb3JpZXMgPSBbXTsKICAgIGltcG9ydHMuZm9yRWFjaChmdW5jdGlvbihpLCBpbmRleCkgewogICAgICBpZiAoaS5raW5kID09PSBFWFRFUk5BTF9LSU5EUy5NRU1PUlkpIHsKCWltcG9ydGVkTWVtb3JpZXMucHVzaChpLnR5cGUpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBpbXBvcnRlZE1lbW9yaWVzCiAgfQoKICBmdW5jdGlvbiBnZXRHbG9iYWxUeXBlKGluZGV4KSB7CiAgICB2YXIgZ2xvYmFscyA9IGdldEltcG9ydGVkR2xvYmFscygpOwogICAgZ2xvYmFscyA9IGdsb2JhbHMuY29uY2F0KHNlY3Rpb25zW1NFQ1RJT05TLkdMT0JBTF0gfHwgW10pOwogICAgaWYgKGluZGV4ID49IGdsb2JhbHMubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibm8gc3VjaCBnbG9iYWw6ICIgKyBpbmRleCkKICAgIH0KICAgIHJldHVybiBnbG9iYWxzW2luZGV4XS50eXBlLmNvbnRlbnRfdHlwZQogIH0KCiAgZnVuY3Rpb24gZ2V0R2xvYmFsTXV0YWJpbGl0eShpbmRleCkgewogICAgdmFyIGdsb2JhbHMgPSBnZXRJbXBvcnRlZEdsb2JhbHMoKTsKICAgIGdsb2JhbHMgPSBnbG9iYWxzLmNvbmNhdChzZWN0aW9uc1tTRUNUSU9OUy5HTE9CQUxdIHx8IFtdKTsKICAgIGlmIChpbmRleCA+PSBnbG9iYWxzLmxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm5vIHN1Y2ggZ2xvYmFsOiAiICsgaW5kZXgpCiAgICB9CiAgICByZXR1cm4gZ2xvYmFsc1tpbmRleF0udHlwZS5tdXRhYmlsaXR5CiAgfQoKICBmdW5jdGlvbiBnZXRUYWJsZVR5cGUoaW5kZXgpIHsKICAgIHZhciB0YWJsZXMgPSBnZXRJbXBvcnRlZFRhYmxlcygpOwogICAgdGFibGVzID0gdGFibGVzLmNvbmNhdChzZWN0aW9uc1tTRUNUSU9OUy5UQUJMRV0gfHwgW10pOwogICAgaWYgKGluZGV4ID49IHRhYmxlcy5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJubyBzdWNoIHRhYmxlOiAiICsgaW5kZXgpCiAgICB9CiAgICByZXR1cm4gdGFibGVzW2luZGV4XQogIH0KCiAgZnVuY3Rpb24gZ2V0TWVtb3J5VHlwZShpbmRleCkgewogICAgdmFyIG1lbW9yaWVzID0gZ2V0SW1wb3J0ZWRNZW1vcmllcygpOwogICAgbWVtb3JpZXMgPSBtZW1vcmllcy5jb25jYXQoc2VjdGlvbnNbU0VDVElPTlMuTUVNT1JZXSB8fCBbXSk7CiAgICBpZiAoaW5kZXggPj0gbWVtb3JpZXMubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgibm8gc3VjaCBtZW1vcnk6ICIgKyBpbmRleCkKICAgIH0KICAgIHJldHVybiBtZW1vcmllc1tpbmRleF0KICB9CgogIGZ1bmN0aW9uIGdldEZ1bmN0aW9uU2lnbmF0dXJlKGluZGV4KSB7CiAgICB2YXIgY291bnQgPSAwOwogICAgdmFyIGltcG9ydHMgPSBzZWN0aW9uc1tTRUNUSU9OUy5JTVBPUlRdIHx8IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbXBvcnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChpbXBvcnRzW2ldLmtpbmQgPT09IEVYVEVSTkFMX0tJTkRTLkZVTkNUSU9OKSB7CglpZiAoaW5kZXggPT09IGNvdW50KSB7CgkgIC8vIEl0IHJlZmVycyB0byBhbiBpbXBvcnRlZCBmdW5jdGlvbi4KCSAgcmV0dXJuIGdldFR5cGVTaWduYXR1cmUoaW1wb3J0c1tpXS50eXBlKQoJfQoJY291bnQrKzsKICAgICAgfQogICAgfQogICAgLy8gSXQgbXVzdCByZWZlciB0byBhIGxvY2FsbHktZGVmaW5lZCBmdW5jdGlvbi4KICAgIGluZGV4IC09IGNvdW50OwogICAgdmFyIGZ1bmN0aW9ucyA9IHNlY3Rpb25zW1NFQ1RJT05TLkZVTkNUSU9OXSB8fCBbXTsKICAgIGlmIChpbmRleCA+PSBmdW5jdGlvbnMubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiSW52YWxpZCBmdW5jdGlvbiBpbmRleDogIiArIGluZGV4KQogICAgfQogICAgcmV0dXJuIGdldFR5cGVTaWduYXR1cmUoZnVuY3Rpb25zW2luZGV4XSkKICB9CgogIGZ1bmN0aW9uIGdldFR5cGVTaWduYXR1cmUoaW5kZXgpIHsKICAgIHZhciB0eXBlU2VjdGlvbiA9IHNlY3Rpb25zW1NFQ1RJT05TLlRZUEVdIHx8IFtdOwogICAgaWYgKGluZGV4ID49IHR5cGVTZWN0aW9uLmxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIkludmFsaWQgdHlwZSBpbmRleDogIiArIGluZGV4KQogICAgfQogICAgcmV0dXJuIHR5cGVTZWN0aW9uW2luZGV4XQogIH0KCiAgZnVuY3Rpb24gcGFyc2VDb2RlU2VjdGlvbigpIHsKICAgIHZhciBudW1JbXBvcnRlZEZ1bmN0aW9ucyA9IGdldEltcG9ydGVkRnVuY3Rpb25zKCkubGVuZ3RoOwogICAgdmFyIGNvdW50ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwogICAgaWYgKHNlY3Rpb25zW1NFQ1RJT05TLkZVTkNUSU9OXSA9PT0gbnVsbCkgewogICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImNvZGUgc2VjdGlvbiB3aXRob3V0IGZ1bmN0aW9uIHNlY3Rpb24iKQogICAgfQogICAgaWYgKGNvdW50ICE9PSBzZWN0aW9uc1tTRUNUSU9OUy5GVU5DVElPTl0ubGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiY29kZSBzZWN0aW9uIHNpemUgZGlmZmVyZW50IHRvIGZ1bmN0aW9uIHNlY3Rpb24gc2l6ZSIpCiAgICB9CiAgICB2YXIgZW50cmllcyA9IFtdOwogICAgd2hpbGUgKGNvdW50ID4gMCkgewogICAgICBlbnRyaWVzLnB1c2gocGFyc2VGdW5jdGlvbkJvZHkoZW50cmllcy5sZW5ndGgpKTsKICAgICAgY291bnQtLTsKICAgIH0KICAgIHJldHVybiBlbnRyaWVzCgogICAgZnVuY3Rpb24gcGFyc2VGdW5jdGlvbkJvZHkoaW5kZXgpIHsKICAgICAgdmFyIGYgPSB7fTsKICAgICAgLy8gWFhYIFRPRE86IGNoZWNrIHRoYXQgdGhlIGZ1bmN0aW9uIGVudHJ5IGV4aXN0cwogICAgICBmLm5hbWUgPSAiRiIgKyAoaW5kZXggKyBudW1JbXBvcnRlZEZ1bmN0aW9ucyk7CiAgICAgIHZhciBzaWdfaW5kZXggPSBzZWN0aW9uc1tTRUNUSU9OUy5GVU5DVElPTl1baW5kZXhdOwogICAgICBpZiAoc2lnX2luZGV4ID49IChzZWN0aW9uc1tTRUNUSU9OUy5UWVBFXSB8fCBbXSkubGVuZ3RoKSB7Cgl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVua25vd24gZnVuY3Rpb24gdHlwZTogIiArIHNpZ19pbmRleCkKICAgICAgfQogICAgICBmLnNpZyA9IHNlY3Rpb25zW1NFQ1RJT05TLlRZUEVdW3NpZ19pbmRleF07CiAgICAgIGYuc2lnU3RyID0gbWFrZVNpZ1N0cihmLnNpZyk7CiAgICAgIHZhciBib2R5X3NpemUgPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICAgIHZhciBlbmRfb2ZfYm9keV9pZHggPSBzLmlkeCArIGJvZHlfc2l6ZTsKICAgICAgdmFyIGxvY2FsX2NvdW50ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwogICAgICBmLmxvY2FscyA9IFtdOwogICAgICB3aGlsZSAobG9jYWxfY291bnQgPiAwKSB7CglmLmxvY2Fscy5wdXNoKHBhcnNlTG9jYWxFbnRyeSgpKTsKCWxvY2FsX2NvdW50LS07CiAgICAgIH0KICAgICAgZi5jb2RlID0gcGFyc2VGdW5jdGlvbkNvZGUoZik7CiAgICAgIHMuc2tpcF90byhlbmRfb2ZfYm9keV9pZHgpOwogICAgICByZXR1cm4gZgogICAgfQoKICAgIGZ1bmN0aW9uIHBhcnNlTG9jYWxFbnRyeSgpIHsKICAgICAgdmFyIGUgPSB7fTsKICAgICAgZS5jb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgICAgZS50eXBlID0gcGFyc2VWYWx1ZVR5cGUoKTsKICAgICAgcmV0dXJuIGUKICAgIH0KCiAgICAvLyBPSywgdGhpcyBpcyB3aGVyZSBpcyBnZXRzIGludGVyZXN0aW5nLgogICAgLy8gV2UgYXR0ZW1wdCB0byBjb252ZXJ0IHRoZSBXQVNNIG9wY29kZSBpbnRvIGEgY29ycmVzcG9uZGluZwogICAgLy8gamF2YXNjcmlwdCBmdW5jdGlvbi4gIEl0IHdpbGwgYmUgYXNtanMtbGlrZSBidXQgd2UncmUgbm90CiAgICAvLyBnb2luZyB0byB3b3JyeSBhYm91dCBmdWxsIHZhbGlkYXRpbmcgYXNtIGNvbXBsaWFuY2UganVzdCB5ZXQsCiAgICAvLyBub3QgbGVhc3QgYmVjYXVzZSB0aGF0IGRvZXNuJ3Qgc3VwcG9ydCBncm93YWJsZSBtZW1vcnkgYW55d2F5LgoKICAgIGZ1bmN0aW9uIHBhcnNlRnVuY3Rpb25Db2RlKGYpIHsKICAgICAgdmFyIGMgPSB7CgloZWFkZXJfbGluZXM6IFtdLAoJYm9keV9saW5lczogW10sCglmb290ZXJfbGluZXM6IFtdCiAgICAgIH07CgogICAgICB2YXIgZGVjbGFyZWRWYXJzID0ge307CgogICAgICBjLmhlYWRlcl9saW5lcy5wdXNoKCJmdW5jdGlvbiAiICsgZi5uYW1lICsgIigiICsgbWFrZVBhcmFtTGlzdCgpICsgIikgeyIpOwogICAgICAvL2MuaGVhZGVyX2xpbmVzLnB1c2goImNvbnNvbGUubG9nKCdFTlRFUiAiICsgZi5uYW1lICsgIicpIikKICAgICAgLy9pZiAoZi5uYW1lID09ICJGODA5OSIpIHsKICAgICAgLy8gIGMuaGVhZGVyX2xpbmVzLnB1c2goImNvbnNvbGUubG9nKCdcXG5cXG5MT09LIEFUIE1FPT09PT09PT09XFxuXFxuJykiKQogICAgICAvLyAgYy5oZWFkZXJfbGluZXMucHVzaCgiY29uc29sZS5sb2cobmV3IEFycmF5KGFyZ3VtZW50cykpIikKICAgICAgLy8gIGMuaGVhZGVyX2xpbmVzLnB1c2goImNvbnNvbGUubG9nKEY4MDk5LnRvU3RyaW5nKCkpIikKICAgICAgLy99CiAgICAgIGMuZm9vdGVyX2xpbmVzLnB1c2goIn0iKTsKCiAgICAgIGZ1bmN0aW9uIG1ha2VQYXJhbUxpc3QoKSB7Cgl2YXIgcGFyYW1zID0gW107CglmLnNpZy5wYXJhbV90eXBlcy5mb3JFYWNoKGZ1bmN0aW9uKHR5cCwgaWR4KSB7CgkgIHBhcmFtcy5wdXNoKGdldExvY2FsVmFyKGlkeCwgdHlwLCB0cnVlKSk7Cgl9KTsKCXJldHVybiBwYXJhbXMuam9pbigiLCIpCiAgICAgIH0KCiAgICAgIC8vIFdlIHJlcHJlc2VudCBXQVNNJ3MgInN0cnVjdGVkIHN0YWNrIiBhcyBhICJzdGFjayBvZiBzdGFja3MiLgogICAgICAvLyBFYWNoIHRpbWUgd2UgZW50ZXIgYSBibG9jaywgd2UgcHVzaCBhIG5ldyBzdGFjayBvbiB0b3Agb2YKICAgICAgLy8gdGhlIGV4aXN0aW5nIGNvbnRyb2wtZmxvdyBzdHJ1Y3R1cmVzLiAgQ29kZSBjYW4gb25seSBhY2Nlc3MKICAgICAgLy8gaXRlbXMgZnJvbSB3aXRoaW4gdGhpcyB0b3AtbW9zdCBzdGFjaywgbm90IGFueSBvZiB0aGUgc3RhY2tzCiAgICAgIC8vIGJlbG93IGl0LgogICAgICAvLwogICAgICAvLyBYWFggVE9ETzogdGhpcyBjb2RlIHNob3VsZCBiZSByZWZhY3RvcmVkIG91dCBpbnRvIGEgaGVscGVyIGNsYXNzCiAgICAgIC8vIHJhdGhlciB0aGFuIHVzaW5nIGEgYnVuY2ggb2YgaW5saW5lIGZ1bmN0aW9uIGRlZmluaXRpb25zLgoKICAgICAgdmFyIGNmU3RhY2sgPSBbewoJb3A6IDAsCglzaWc6IChmLnNpZy5yZXR1cm5fdHlwZXMubGVuZ3RoID4gMCA/IGYuc2lnLnJldHVybl90eXBlc1swXSA6IFRZUEVTLk5PTkUpLAoJaW5kZXg6IDAsCglpc0RlYWQ6IGZhbHNlLAoJaXNQb2x5bW9ycGhpYzogZmFsc2UsCgllbmRSZWFjaGVkOiBmYWxzZSwKCXR5cGVTdGFjazogW10sCglwcmV2U3RhY2tIZWlnaHRzOiB7fQogICAgICB9XTsKICAgICAgY2ZTdGFja1swXS5wcmV2U3RhY2tIZWlnaHRzW1RZUEVTLkkzMl0gPSAwOwogICAgICBjZlN0YWNrWzBdLnByZXZTdGFja0hlaWdodHNbVFlQRVMuSTY0XSA9IDA7CiAgICAgIGNmU3RhY2tbMF0ucHJldlN0YWNrSGVpZ2h0c1tUWVBFUy5GMzJdID0gMDsKICAgICAgY2ZTdGFja1swXS5wcmV2U3RhY2tIZWlnaHRzW1RZUEVTLkY2NF0gPSAwOwoKICAgICAgZnVuY3Rpb24gcHVzaENvbnRyb2xGbG93KG9wLCBzaWcsIGVuZFJlYWNoZWQpIHsKCXZhciBwcmV2Q2YgPSBjZlN0YWNrW2NmU3RhY2subGVuZ3RoIC0gMV07Cgl2YXIgcHJldlN0YWNrSGVpZ2h0cyA9IHt9OwoJcHJldlN0YWNrSGVpZ2h0c1tUWVBFUy5JMzJdID0gcHJldkNmLnByZXZTdGFja0hlaWdodHNbVFlQRVMuSTMyXTsKCXByZXZTdGFja0hlaWdodHNbVFlQRVMuSTY0XSA9IHByZXZDZi5wcmV2U3RhY2tIZWlnaHRzW1RZUEVTLkk2NF07CglwcmV2U3RhY2tIZWlnaHRzW1RZUEVTLkYzMl0gPSBwcmV2Q2YucHJldlN0YWNrSGVpZ2h0c1tUWVBFUy5GMzJdOwoJcHJldlN0YWNrSGVpZ2h0c1tUWVBFUy5GNjRdID0gcHJldkNmLnByZXZTdGFja0hlaWdodHNbVFlQRVMuRjY0XTsKCXByZXZDZi50eXBlU3RhY2suZm9yRWFjaChmdW5jdGlvbih0eXApIHsKCSAgcHJldlN0YWNrSGVpZ2h0c1t0eXBdICs9IDE7Cgl9KTsKCWNmU3RhY2sucHVzaCh7CgkgIG9wOiBvcCwKCSAgc2lnOiBzaWcsCgkgIGluZGV4OiBjZlN0YWNrLmxlbmd0aCwKCSAgbGFiZWw6ICJMIiArIGNmU3RhY2subGVuZ3RoLAoJICBpc1BvbHltb3JwaGljOiBmYWxzZSwKCSAgaXNEZWFkOiBwcmV2Q2YuaXNEZWFkLAoJICBlbmRSZWFjaGVkOiAhIWVuZFJlYWNoZWQsCgkgIHR5cGVTdGFjazogW10sCgkgIHByZXZTdGFja0hlaWdodHM6IHByZXZTdGFja0hlaWdodHMKCX0pOwoJcmV0dXJuIGNmU3RhY2tbY2ZTdGFjay5sZW5ndGggLSAxXQogICAgICB9CgogICAgICBmdW5jdGlvbiBwb3BDb250cm9sRmxvdygpIHsKCWNmID0gY2ZTdGFjay5wb3AoKTsKCXJldHVybiBjZgogICAgICB9CgogICAgICBmdW5jdGlvbiBtYXJrRGVhZENvZGUoKSB7Cgl2YXIgY2YgPSBjZlN0YWNrW2NmU3RhY2subGVuZ3RoIC0gMV07CgljZi5pc0RlYWQgPSB0cnVlOwoJY2YuaXNQb2x5bW9ycGhpYyA9IHRydWU7CgljZi50eXBlU3RhY2sgPSBbXTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaXNEZWFkQ29kZSgpIHsKCXJldHVybiBjZlN0YWNrW2NmU3RhY2subGVuZ3RoIC0gMV0uaXNEZWFkCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHB1c2hMaW5lKGxuLCBpbmRlbnQpIHsKCWlmIChpc0RlYWRDb2RlKCkpIHsgcmV0dXJuIH0KCXZhciBpbmRlbnQgPSBjZlN0YWNrLmxlbmd0aCArIChpbmRlbnQgfHwgMCkgKyAxOwoJd2hpbGUgKGluZGVudCA+IDApIHsKCSAgbG4gPSAiICAiICsgbG47CgkgIGluZGVudC0tOwoJfQoJYy5ib2R5X2xpbmVzLnB1c2gobG4pOwogICAgICB9CgogICAgICBmdW5jdGlvbiBwdXNoU3RhY2tWYXIodHlwKSB7CgljZlN0YWNrW2NmU3RhY2subGVuZ3RoIC0gMV0udHlwZVN0YWNrLnB1c2godHlwKTsKCXJldHVybiBnZXRTdGFja1Zhcih0eXApCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHBlZWtTdGFja1R5cGUoKSB7Cgl2YXIgY2YgPSBjZlN0YWNrW2NmU3RhY2subGVuZ3RoIC0gMV07Cgl2YXIgc3RhY2sgPSBjZi50eXBlU3RhY2s7CglpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CgkgIGlmICghIGNmLmlzUG9seW1vcnBoaWMpIHsKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm5vdGhpbmcgb24gdGhlIHN0YWNrIikKCSAgfQoJICByZXR1cm4gVFlQRVMuVU5LTk9XTgoJfQoJcmV0dXJuIHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIHBvcFN0YWNrVmFyKHdhbnRUeXBlKSB7Cgl2YXIgbmFtZSA9IGdldFN0YWNrVmFyKHdhbnRUeXBlKTsKCXZhciBjZiA9IGNmU3RhY2tbY2ZTdGFjay5sZW5ndGggLSAxXTsKCXZhciB0eXAgPSBjZi50eXBlU3RhY2sucG9wKCk7CglpZiAod2FudFR5cGUgIT09IFRZUEVTLlVOS05PV04gJiYgdHlwICE9PSB3YW50VHlwZSAmJiB0eXAgIT09IFRZUEVTLlVOS05PV04pIHsKCSAgaWYgKCEgY2YuaXNQb2x5bW9ycGhpYykgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiU3RhY2sgdHlwZSBtaXNtYXRjaDogZXhwZWN0ZWQgIiArIHdhbnRUeXBlICsgIiwgZm91bmQgIiArIHR5cCkKCSAgfQoJICByZXR1cm4gIlVOUkVBQ0hBQkxFIgoJfQoJcmV0dXJuIG5hbWUKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0U3RhY2tWYXIodHlwLCBwb3MpIHsKCXZhciBjZiA9IGNmU3RhY2tbY2ZTdGFjay5sZW5ndGggLSAxXTsKCXZhciB3aGVyZSA9IGNmLnR5cGVTdGFjay5sZW5ndGggLSAxOwoJd2hlcmUgLT0gKHBvcyB8fCAwKTsKCWlmICh3aGVyZSA8IDApIHsKCSAgaWYgKCEgY2YuaXNQb2x5bW9ycGhpYykgewoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgic3RhY2sgYWNjZXNzIG91dHNpZGUgY3VycmVudCBibG9jayIpCgkgIH0KCSAgcmV0dXJuICJVTlJFQUNIQUJMRSIKCX0KCWlmICh0eXAgIT09IGNmLnR5cGVTdGFja1t3aGVyZV0gJiYgdHlwICE9PSBUWVBFUy5VTktOT1dOICYmIGNmLnR5cGVTdGFja1t3aGVyZV0gIT09IFRZUEVTLlVOS05PV04pIHsKCSAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJTdGFjayB0eXBlIG1pc21hdGNoOiBleHBlY3RlZCAiICsgdHlwICsgIiwgZm91bmQgIiArIGNmLnR5cGVTdGFja1t3aGVyZV0pCgl9Cgl2YXIgaGVpZ2h0ID0gY2YucHJldlN0YWNrSGVpZ2h0c1t0eXBdOwoJZm9yICh2YXIgaSA9IDA7IGkgPCB3aGVyZTsgaSsrKSB7CgkgIGlmIChjZi50eXBlU3RhY2tbaV0gPT09IHR5cCkgewoJICAgIGhlaWdodCArPSAxOwoJICB9Cgl9Cgl2YXIgbm07Cglzd2l0Y2ggKHR5cCkgewoJICBjYXNlIFRZUEVTLkkzMjoKCSAgICBubSA9ICJzaSIgKyBoZWlnaHQ7CgkgICAgYnJlYWsKCSAgY2FzZSBUWVBFUy5JNjQ6CgkgICAgbm0gPSAic2wiICsgaGVpZ2h0OwoJICAgIGJyZWFrCgkgIGNhc2UgVFlQRVMuRjMyOgoJICAgIG5tID0gInNmIiArIGhlaWdodDsKCSAgICBicmVhawoJICBjYXNlIFRZUEVTLkY2NDoKCSAgICBubSA9ICJzZCIgKyBoZWlnaHQ7CgkgICAgYnJlYWsKCSAgY2FzZSBUWVBFUy5VTktOT1dOOgoJICAgIG5tID0gIlVOUkVBQ0hBQkxFIjsKCSAgICBicmVhawoJICBkZWZhdWx0OgoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5leHBlY3RlZCB0eXBlIG9uIHN0YWNrOiAiICsgdHlwKQoJfQoJZGVjbGFyZVZhck5hbWUodHlwLCBubSk7CglyZXR1cm4gbm0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0QmxvY2tPdXRwdXRWYXIoY2YpIHsKCWlmIChjZi5zaWcgPT09IFRZUEVTLk5PTkUpIHsKCSAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJObyBvdXRwdXQgZnJvbSB2b2lkIGJsb2NrIikKCX0KCXZhciBoZWlnaHQgPSBjZi5wcmV2U3RhY2tIZWlnaHRzW2NmLnNpZ107Cglzd2l0Y2ggKGNmLnNpZykgewoJICBjYXNlIFRZUEVTLkkzMjoKCSAgICByZXR1cm4gInNpIiArIGhlaWdodAoJICBjYXNlIFRZUEVTLkk2NDoKCSAgICByZXR1cm4gInNsIiArIGhlaWdodAoJICBjYXNlIFRZUEVTLkYzMjoKCSAgICByZXR1cm4gInNmIiArIGhlaWdodAoJICBjYXNlIFRZUEVTLkY2NDoKCSAgICByZXR1cm4gInNkIiArIGhlaWdodAoJICBkZWZhdWx0OgoJICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5leHBlY3RlZCB0eXBlIG9uIHN0YWNrIikKCX0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gZ2V0QnJhbmNoVGFyZ2V0KGRlcHRoKSB7Cgl2YXIgd2hpY2ggPSBjZlN0YWNrLmxlbmd0aCAtICgxICsgZGVwdGgpOwoJaWYgKHdoaWNoIDwgMCkgewoJICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIkJyYW5jaCBkZXB0aCB0b28gbGFyZ2UiKQoJfQoJcmV0dXJuIGNmU3RhY2tbd2hpY2hdCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldExvY2FsVHlwZShpbmRleCkgewoJdmFyIGNvdW50ID0gZi5zaWcucGFyYW1fdHlwZXMubGVuZ3RoOwoJaWYgKGluZGV4IDwgY291bnQpIHsKCSAgcmV0dXJuIGYuc2lnLnBhcmFtX3R5cGVzW2luZGV4XQoJfQoJdmFyIG5leHQgPSAwOwoJd2hpbGUgKG5leHQgPCBmLmxvY2Fscy5sZW5ndGgpIHsKCSAgY291bnQgKz0gZi5sb2NhbHNbbmV4dF0uY291bnQ7CgkgIGlmIChjb3VudCA+IGluZGV4KSB7CgkgICAgcmV0dXJuIGYubG9jYWxzW25leHRdLnR5cGUKCSAgfQoJICBuZXh0Kys7Cgl9Cgl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImxvY2FsIGluZGV4IHRvbyBsYXJnZTogIiArIGluZGV4KQogICAgICB9CgogICAgICBmdW5jdGlvbiBnZXRMb2NhbFZhcihpbmRleCwgdHlwLCBwYXJhbSkgewoJdHlwID0gdHlwIHx8IGdldExvY2FsVHlwZShpbmRleCk7Cgl2YXIgbm07Cglzd2l0Y2ggKHR5cCkgewoJICBjYXNlIFRZUEVTLkkzMjoKCSAgICBubSA9ICAibGkiICsgaW5kZXg7CgkgICAgYnJlYWsKCSAgY2FzZSBUWVBFUy5JNjQ6CgkgICAgbm0gPSAibGwiICsgaW5kZXg7CgkgICAgYnJlYWsKCSAgY2FzZSBUWVBFUy5GMzI6CgkgICAgbm0gPSAibGYiICsgaW5kZXg7CgkgICAgYnJlYWsKCSAgY2FzZSBUWVBFUy5GNjQ6CgkgICAgbm0gPSAibGQiICsgaW5kZXg7CgkgICAgYnJlYWsKCSAgZGVmYXVsdDoKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuZXhwZWN0ZWQgdHlwZSBvZiBsb2NhbCIpCgl9CglpZiAoISBwYXJhbSkgewoJICBkZWNsYXJlVmFyTmFtZSh0eXAsIG5tKTsKCX0gZWxzZSB7CgkgIGRlY2xhcmVkVmFyc1tubV0gPSB0cnVlOwoJfQoJcmV0dXJuIG5tCiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGRlY2xhcmVWYXJOYW1lKHR5cCwgbm0pIHsKCXZhciBpbml0VmFsID0gInRyYXAoJ2ludmFsaWQgaW5pdGlhbCB2YWx1ZSkiOwoJc3dpdGNoICh0eXApIHsKCSAgY2FzZSBUWVBFUy5JMzI6CgkgICAgaW5pdFZhbCA9ICIwfDAiOwoJICAgIGJyZWFrCgkgIGNhc2UgVFlQRVMuSTY0OgoJICAgIGluaXRWYWwgPSAiTG9uZy5aRVJPIjsKCSAgICBicmVhawoJICBjYXNlIFRZUEVTLkYzMjoKCSAgICBpbml0VmFsID0gIjAuMCI7CgkgICAgYnJlYWsKCSAgY2FzZSBUWVBFUy5GNjQ6CgkgICAgaW5pdFZhbCA9ICIwLjAiOwoJICAgIGJyZWFrCgkgIGNhc2UgVFlQRVMuVU5LTk9XTjoKCSAgICByZXR1cm4KCSAgZGVmYXVsdDoKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuZXhwZWN0ZWQgdHlwZSBvZiB2YXJpYWJsZSIpCgl9CglpZiAoISBkZWNsYXJlZFZhcnNbbm1dKSB7CgkgIGMuaGVhZGVyX2xpbmVzLnB1c2goIiAgICB2YXIgIiArIG5tICsgIiA9ICIgKyBpbml0VmFsKTsKCSAgZGVjbGFyZWRWYXJzW25tXSA9IHRydWU7Cgl9CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGdldEdsb2JhbFZhcihpbmRleCwgdHlwKSB7CglyZXR1cm4gIkciICsgaW5kZXgKICAgICAgfQoKICAgICAgZnVuY3Rpb24gY2hlY2tHbG9iYWxNdXRhYmxlKGluZGV4KSB7Cgl2YXIgZ2xvYmFscyA9IHNlY3Rpb25zW1NFQ1RJT05TLkdMT0JBTF0gfHwgW107CglpZiAoaW5kZXggPj0gZ2xvYmFscy5sZW5ndGgpIHsKCSAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJubyBzdWNoIGdsb2JhbDogIiArIGluZGV4KQoJfQoJaWYgKCEgZ2xvYmFsc1tpbmRleF0udHlwZS5tdXRhYmlsaXR5KSB7CgkgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiZ2xvYmFsIGlzIGltbXV0YWJsZTogIiArIGluZGV4KQoJfQogICAgICB9CgogICAgICBmdW5jdGlvbiBpMzJfdW5hcnlPcCh3aGF0LCBjYXN0KSB7CgljYXN0ID0gY2FzdCB8fCAifDAiOwoJdmFyIG9wZXJhbmQgPSBnZXRTdGFja1ZhcihUWVBFUy5JMzIpOwoJcHVzaExpbmUob3BlcmFuZCArICIgPSAoIiArIHdoYXQgKyAiKCIgKyBvcGVyYW5kICsgIikpIiArIGNhc3QpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpMzJfYmluYXJ5T3Aod2hhdCwgY2FzdCkgewoJY2FzdCA9IGNhc3QgfHwgInwwIjsKCXZhciByaHMgPSAiKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgY2FzdCArICIpIjsKCXZhciBsaHMgPSAiKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgY2FzdCArICIpIjsKCS8vcHVzaExpbmUoImlmKCgoIiArIGxocyArIHdoYXQgKyByaHMgKyAiKSIgKyBjYXN0ICsgIikgPT0gICIgKyBCQURfQUREUiArICIpIHsgY29uc29sZS5sb2coJyIgKyB3aGF0ICsgIiBCQUQnLCAiICsgbGhzICsgIiwiICsgcmhzICsgIiwgKCIgKyBsaHMgKyAiICIgKyB3aGF0ICsgIiAiICsgcmhzICsgIikiICsgY2FzdCArICIpOyBjb25zb2xlLmxvZyhhcmd1bWVudHMuY2FsbGVlLnRvU3RyaW5nKCkpIDsgdGhyb3cgbmV3IEVycm9yKCdiaW5mdW5jIGJhZCcpfSIpCglwdXNoTGluZShwdXNoU3RhY2tWYXIoVFlQRVMuSTMyKSArICIgPSAoIiArIGxocyArIHdoYXQgKyByaHMgKyAiKSIgKyBjYXN0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTMyX2JpbmFyeUZ1bmMod2hhdCwgY2FzdCkgewoJY2FzdCA9IGNhc3QgfHwgInwwIjsKCXZhciByaHMgPSAiKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgY2FzdCArICIpIjsKCXZhciBsaHMgPSAiKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgY2FzdCArICIpIjsKCS8vcHVzaExpbmUoImlmKCIgKyB3aGF0ICsgIigiICsgbGhzICsgIiwiICsgcmhzICsgIikgPT0gIiArIEJBRF9BRERSICsgIikgeyBjb25zb2xlLmxvZygnIiArIHdoYXQgKyAiIEJBRCcsICIgKyBsaHMgKyAiLCIgKyByaHMgKyAiLCAiICsgd2hhdCArICIoIiArIGxocyArICIsIiArIHJocyArICIpIiArIGNhc3QgKyAiKTsgY29uc29sZS5sb2coYXJndW1lbnRzLmNhbGxlZS50b1N0cmluZygpKSA7IHRocm93IG5ldyBFcnJvcignYmluZnVuYyBiYWQnKX0iKQoJcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkkzMikgKyAiID0gKCIgKyB3aGF0ICsgIigiICsgbGhzICsgIiwgIiArIHJocyArICIpKSIgKyBjYXN0KTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTY0X3VuYXJ5RnVuYyh3aGF0KSB7Cgl2YXIgb3BlcmFuZCA9IGdldFN0YWNrVmFyKFRZUEVTLkk2NCk7CglwdXNoTGluZShvcGVyYW5kICsgIiA9ICIgKyB3aGF0ICsgIigiICsgb3BlcmFuZCArICIpIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGk2NF9iaW5hcnlGdW5jKHdoYXQpIHsKCXZhciByaHMgPSAiKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JNjQpICsgIikiOwoJdmFyIGxocyA9ICIoIiArIHBvcFN0YWNrVmFyKFRZUEVTLkk2NCkgKyAiKSI7CglwdXNoTGluZShwdXNoU3RhY2tWYXIoVFlQRVMuSTY0KSArICIgPSAiICsgd2hhdCArICIoIiArIGxocyArICIsICIgKyByaHMgKyAiKSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpNjRfY29tcGFyZUZ1bmMod2hhdCkgewoJdmFyIHJocyA9ICIoIiArIHBvcFN0YWNrVmFyKFRZUEVTLkk2NCkgKyAiKSI7Cgl2YXIgbGhzID0gIigiICsgcG9wU3RhY2tWYXIoVFlQRVMuSTY0KSArICIpIjsKCXB1c2hMaW5lKHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpICsgIiA9ICIgKyB3aGF0ICsgIigiICsgbGhzICsgIiwgIiArIHJocyArICIpfDAiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjMyX2NvbXBhcmVPcCh3aGF0KSB7Cgl2YXIgcmhzID0gcG9wU3RhY2tWYXIoVFlQRVMuRjMyKTsKCXZhciBsaHMgPSBwb3BTdGFja1ZhcihUWVBFUy5GMzIpOwoJdmFyIHJlcyA9IHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpOwoJcHVzaExpbmUocmVzICsgIiA9ICgiICsgbGhzICsgIiAiICsgd2hhdCArICIgIiArIHJocyArICIpfDAiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjMyX3VuYXJ5T3Aod2hhdCkgewoJdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5GMzIpOwoJcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkYzMikgKyAiID0gVG9GMzIoIiArIHdoYXQgKyIoIiArIG9wZXJhbmQgKyAiKSkiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjMyX2JpbmFyeU9wKHdoYXQpIHsKCXZhciByaHMgPSBwb3BTdGFja1ZhcihUWVBFUy5GMzIpOwoJdmFyIGxocyA9IHBvcFN0YWNrVmFyKFRZUEVTLkYzMik7CglwdXNoTGluZShwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKSArICIgPSBUb0YzMigiICsgbGhzICsgIiAiICsgd2hhdCArICIgIiArIHJocyArICIpIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGYzMl9iaW5hcnlGdW5jKHdoYXQpIHsKCXZhciByaHMgPSBwb3BTdGFja1ZhcihUWVBFUy5GMzIpOwoJdmFyIGxocyA9IHBvcFN0YWNrVmFyKFRZUEVTLkYzMik7CglwdXNoTGluZShwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKSArICIgPSBUb0YzMigiICsgd2hhdCArICIoIiArIGxocyArICIsICIgKyByaHMgKyAiKSkiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjY0X2NvbXBhcmVPcCh3aGF0KSB7Cgl2YXIgcmhzID0gcG9wU3RhY2tWYXIoVFlQRVMuRjY0KTsKCXZhciBsaHMgPSBwb3BTdGFja1ZhcihUWVBFUy5GNjQpOwoJcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkkzMikgKyAiID0gKCIgKyBsaHMgKyAiICIgKyB3aGF0ICsgIiAiICsgcmhzICsgIil8MCIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBmNjRfdW5hcnlPcCh3aGF0KSB7Cgl2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkY2NCk7CglwdXNoTGluZShwdXNoU3RhY2tWYXIoVFlQRVMuRjY0KSArICIgPSAiICsgd2hhdCArIigiICsgb3BlcmFuZCArICIpIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGY2NF9iaW5hcnlPcCh3aGF0KSB7Cgl2YXIgcmhzID0gcG9wU3RhY2tWYXIoVFlQRVMuRjY0KTsKCXZhciBsaHMgPSBwb3BTdGFja1ZhcihUWVBFUy5GNjQpOwoJcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkY2NCkgKyAiID0gIiArIGxocyArICIgIiArIHdoYXQgKyAiICIgKyByaHMpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBmNjRfYmluYXJ5RnVuYyh3aGF0KSB7Cgl2YXIgcmhzID0gcG9wU3RhY2tWYXIoVFlQRVMuRjY0KTsKCXZhciBsaHMgPSBwb3BTdGFja1ZhcihUWVBFUy5GNjQpOwoJcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkY2NCkgKyAiID0gIiArIHdoYXQgKyAiKCIgKyBsaHMgKyAiLCAiICsgcmhzICsgIikiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCBzaXplKSB7CglwdXNoTGluZSgiaWYgKCgiICsgYWRkciArICI+Pj4wKSArICIgKyAob2Zmc2V0ICsgc2l6ZSkgKyAiID4gbWVtb3J5U2l6ZSkgeyByZXR1cm4gdHJhcCgnT09CJykgfSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpMzJfbG9hZF91bmFsaWduZWQoYWRkciwgb2Zmc2V0KSB7Cgl2YXIgcmVzID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CglwdXNoTGluZShyZXMgKyAiID0gSERWLmdldEludDMyKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiLCB0cnVlKSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpMzJfbG9hZF9hbGlnbmVkKGFkZHIsIG9mZnNldCkgewoJdmFyIHJlcyA9IHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpOwoJLy9wdXNoTGluZSgiICB2YXIgWCA9ICIgKyBhZGRyKQoJcHVzaExpbmUoImlmICgoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpICYgMHgwMykgeyIpOwoJcHVzaExpbmUoIiAgIiArIHJlcyArICIgPSBIRFYuZ2V0SW50MzIoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsIHRydWUpIik7CglwdXNoTGluZSgifSBlbHNlIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gSEkzMlsoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpPj4yXSIpOwoJLy9wdXNoTGluZSgiICBpZigiICsgcmVzICsgIiA9PSAiICsgQkFEX0FERFIgKyAiKSB7IGNvbnNvbGUubG9nKCdCQUQgTE9BRCcsIFgsICIgKyBvZmZzZXQgKyAiLCIgKyByZXMgKyAiKTsgY29uc29sZS5sb2coYXJndW1lbnRzLmNhbGxlZS50b1N0cmluZygpKTsgdGhyb3cgbmV3IEVycm9yKCdsb2FkIGJhZCcpfSIpCglwdXNoTGluZSgifSIpOwogICAgICB9CgogICAgICBmdW5jdGlvbiBpMzJfbG9hZDhfcyhhZGRyLCBvZmZzZXQsIHZhbHVlKSB7Cgl2YXIgcmVzID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CglwdXNoTGluZShyZXMgKyAiID0gSEk4WygiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIildIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGkzMl9sb2FkOF91KGFkZHIsIG9mZnNldCwgdmFsdWUpIHsKCXZhciByZXMgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTMyKTsKCXB1c2hMaW5lKHJlcyArICIgPSBIVThbKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiKV0iKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTMyX2xvYWQxNl91X3VuYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlKSB7Cgl2YXIgcmVzID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CglwdXNoTGluZShyZXMgKyAiID0gSERWLmdldEludDE2KCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiLCB0cnVlKSAmIDB4MDAwMEZGRkYiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTMyX2xvYWQxNl9zX2FsaWduZWQoYWRkciwgb2Zmc2V0LCB2YWx1ZSkgewoJdmFyIHJlcyA9IHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpOwoJcHVzaExpbmUoImlmICgoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpICYgMHgwMSkgeyIpOwoJcHVzaExpbmUoIiAgIiArIHJlcyArICIgPSBIRFYuZ2V0SW50MTYoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsIHRydWUpIik7CglwdXNoTGluZSgifSBlbHNlIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gSEkxNlsoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpPj4xXSIpOwoJcHVzaExpbmUoIn0iKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTMyX2xvYWQxNl91X2FsaWduZWQoYWRkciwgb2Zmc2V0LCB2YWx1ZSkgewoJdmFyIHJlcyA9IHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpOwoJcHVzaExpbmUoImlmICgoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpICYgMHgwMSkgeyIpOwoJcHVzaExpbmUoIiAgIiArIHJlcyArICIgPSBIRFYuZ2V0SW50MTYoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsIHRydWUpICYgMHgwMDAwRkZGRiIpOwoJcHVzaExpbmUoIn0gZWxzZSB7Iik7CglwdXNoTGluZSgiICAiICsgcmVzICsgIiA9IEhVMTZbKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiKT4+MV0iKTsKCXB1c2hMaW5lKCJ9Iik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGkzMl9zdG9yZV91bmFsaWduZWQoYWRkciwgb2Zmc2V0LCB2YWx1ZSkgewoJcHVzaExpbmUoIkhEVi5zZXRJbnQzMigiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIiwgIiArIHZhbHVlICsgIiwgdHJ1ZSkiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTMyX3N0b3JlX2FsaWduZWQoYWRkciwgb2Zmc2V0LCB2YWx1ZSkgewoJcHVzaExpbmUoImlmICgoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpICYgMHgwMykgeyIpOwoJcHVzaExpbmUoIiAgSERWLnNldEludDMyKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiLCAiICsgdmFsdWUgKyAiLCB0cnVlKSIpOwoJcHVzaExpbmUoIn0gZWxzZSB7Iik7CglwdXNoTGluZSgiICBISTMyWygiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIik+PjJdID0gIiArIHZhbHVlKTsKCXB1c2hMaW5lKCJ9Iik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGkzMl9zdG9yZTgoYWRkciwgb2Zmc2V0LCB2YWx1ZSkgewoJLy9wdXNoTGluZSgiICBpZigoIiArIGFkZHIgKyAiKyIgKyBvZmZzZXQgKyIpIDw9ICIgKyA4ICsgIil7Y29uc29sZS5sb2coJ0xPVyBTVE9SRScsIiArIGFkZHIgKyAiLCIgKyBvZmZzZXQgKyAiLCIgKyB2YWx1ZSArICIpfSIpCgkvL3B1c2hMaW5lKCIgIGlmKCgiICsgYWRkciArICIrIiArIG9mZnNldCArIikgPT0gIiArIDEgKyAiKXtjb25zb2xlLmxvZygnTE9XIFNUT1JFIScpOyBjb25zb2xlLmxvZyhhcmd1bWVudHMuY2FsbGVlLnRvU3RyaW5nKCkpOyB0aHJvdyBuZXcgRXJyb3IoJ0hFUkUhJyk7fSIpCglwdXNoTGluZSgiSFU4WygiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIildID0gIiArIHZhbHVlKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gaTMyX3N0b3JlMTYoYWRkciwgb2Zmc2V0LCB2YWx1ZSkgewoJcHVzaExpbmUoImlmICgoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpICYgMHgwRikgeyIpOwoJcHVzaExpbmUoIiAgSERWLnNldEludDMyKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiLCAiICsgdmFsdWUgKyAiLCB0cnVlKSIpOwoJcHVzaExpbmUoIn0gZWxzZSB7Iik7CglwdXNoTGluZSgiICBIVTE2WygiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIik+PjFdID0gIiArIHZhbHVlKTsKCXB1c2hMaW5lKCJ9Iik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGYzMl9sb2FkX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQpIHsKCXZhciByZXMgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKTsKCXB1c2hMaW5lKHJlcyArICIgPSBIRFYuZ2V0RmxvYXQzMigiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIiwgdHJ1ZSkiKTsKCXB1c2hMaW5lKHJlcyArICIgPSBmMzJfbG9hZF9maXhfc2lnbmFsbGluZygiICsgcmVzICsgIiwgSFU4LCAiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIikiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjMyX2xvYWRfYWxpZ25lZChhZGRyLCBvZmZzZXQpIHsKCXZhciByZXMgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKTsKCXB1c2hMaW5lKCJpZiAoKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiKSAmIDB4MDMpIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gSERWLmdldEZsb2F0MzIoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsIHRydWUpIik7CglwdXNoTGluZSgifSBlbHNlIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gSEYzMlsoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpPj4yXSIpOwoJcHVzaExpbmUoIn0iKTsKCXB1c2hMaW5lKHJlcyArICIgPSBmMzJfbG9hZF9maXhfc2lnbmFsbGluZygiICsgcmVzICsgIiwgSFU4LCAiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIikiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjMyX3N0b3JlX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlKSB7CglwdXNoTGluZSgiSERWLnNldEZsb2F0MzIoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsICIgKyB2YWx1ZSArICIsIHRydWUpIik7CglwdXNoTGluZSgiZjMyX3N0b3JlX2ZpeF9zaWduYWxsaW5nKCIgKyB2YWx1ZSArICIsIEhVOCwgIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGYzMl9zdG9yZV9hbGlnbmVkKGFkZHIsIG9mZnNldCwgdmFsdWUpIHsKCXB1c2hMaW5lKCJpZiAoKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiKSAmIDB4MDMpIHsiKTsKCXB1c2hMaW5lKCIgIEhEVi5zZXRGbG9hdDMyKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiLCAiICsgdmFsdWUgKyAiLCB0cnVlKSIpOwoJcHVzaExpbmUoIn0gZWxzZSB7Iik7CglwdXNoTGluZSgiICBIRjMyWygiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIik+PjJdID0gIiArIHZhbHVlKTsKCXB1c2hMaW5lKCJ9Iik7CglwdXNoTGluZSgiZjMyX3N0b3JlX2ZpeF9zaWduYWxsaW5nKCIgKyB2YWx1ZSArICIsIEhVOCwgIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGY2NF9sb2FkX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQpIHsKCXZhciByZXMgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjY0KTsKCXB1c2hMaW5lKHJlcyArICIgPSBIRFYuZ2V0RmxvYXQ2NCgiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIiwgdHJ1ZSkiKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjY0X2xvYWRfYWxpZ25lZChhZGRyLCBvZmZzZXQpIHsKCXZhciByZXMgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjY0KTsKCXB1c2hMaW5lKCJpZiAoKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiKSAmIDB4MDcpIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gSERWLmdldEZsb2F0NjQoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsIHRydWUpIik7CglwdXNoTGluZSgifSBlbHNlIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gSEY2NFsoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIpPj4zXSIpOwoJcHVzaExpbmUoIn0iKTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gZjY0X3N0b3JlX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlKSB7CglwdXNoTGluZSgiSERWLnNldEZsb2F0NjQoIiArIGFkZHIgKyAiICsgIiArIG9mZnNldCArICIsICIgKyB2YWx1ZSArICIsIHRydWUpIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGY2NF9zdG9yZV9hbGlnbmVkKGFkZHIsIG9mZnNldCwgdmFsdWUpIHsKCXB1c2hMaW5lKCJpZiAoKCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiKSAmIDB4MDcpIHsiKTsKCXB1c2hMaW5lKCIgIEhEVi5zZXRGbG9hdDY0KCIgKyBhZGRyICsgIiArICIgKyBvZmZzZXQgKyAiLCAiICsgdmFsdWUgKyAiLCB0cnVlKSIpOwoJcHVzaExpbmUoIn0gZWxzZSB7Iik7CglwdXNoTGluZSgiICBIRjY0WygiICsgYWRkciArICIgKyAiICsgb2Zmc2V0ICsgIik+PjNdID0gIiArIHZhbHVlKTsKCXB1c2hMaW5lKCJ9Iik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGk2NF9mcm9tX2kzMl9zKCkgewoJdmFyIGxvdzMyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCXZhciByZXMgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTY0KTsKCXB1c2hMaW5lKCJpZiAoIiArIGxvdzMyICsgIiAmIDB4ODAwMDAwMDApIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gbmV3IExvbmcoIiArIGxvdzMyICsgIiwgLTEpIik7CglwdXNoTGluZSgifSBlbHNlIHsiKTsKCXB1c2hMaW5lKCIgICIgKyByZXMgKyAiID0gbmV3IExvbmcoIiArIGxvdzMyICsgIiwgMCkiKTsKCXB1c2hMaW5lKCJ9Iik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGk2NF9mcm9tX2kzMl91KCkgewoJdmFyIGxvdzMyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCXB1c2hMaW5lKHB1c2hTdGFja1ZhcihUWVBFUy5JNjQpICsgIiA9IG5ldyBMb25nKCIgKyBsb3czMiArICIsIDApIik7CiAgICAgIH0KCiAgICAgIGZ1bmN0aW9uIGk2NF9mcm9tX2kzMngyKCkgewoJdmFyIGhpZ2gzMiA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7Cgl2YXIgbG93MzIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkk2NCkgKyAiID0gbmV3IExvbmcoIiArIGxvdzMyICsgIiwgIiArIGhpZ2gzMiArICIpIik7CiAgICAgIH0KCiAgICAgIERFQ09ERTogd2hpbGUgKHRydWUpIHsKCXZhciBvcCA9IHMucmVhZF9ieXRlKCk7Cglzd2l0Y2ggKG9wKSB7CgoJICBjYXNlIE9QQ09ERVMuVU5SRUFDSEFCTEU6CgkgICAgcHVzaExpbmUoInJldHVybiB0cmFwKCd1bnJlYWNoYWJsZScpIik7CgkgICAgbWFya0RlYWRDb2RlKCk7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5OT1A6CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5CTE9DSzoKCSAgICB2YXIgc2lnID0gcGFyc2VCbG9ja1R5cGUoKTsKCSAgICB2YXIgY2YgPSBwdXNoQ29udHJvbEZsb3cob3AsIHNpZyk7CgkgICAgcHVzaExpbmUoY2YubGFiZWwgKyAiOiBkbyB7IiwgLTEpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuTE9PUDoKCSAgICB2YXIgc2lnID0gcGFyc2VCbG9ja1R5cGUoKTsKCSAgICB2YXIgY2YgPSBwdXNoQ29udHJvbEZsb3cob3AsIHNpZyk7CgkgICAgcHVzaExpbmUoY2YubGFiZWwgKyAiOiB3aGlsZSAoMSkgeyIsIC0xKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLklGOgoJICAgIHZhciBzaWcgPSBwYXJzZUJsb2NrVHlwZSgpOwoJICAgIHZhciBjb25kID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgY2YgPSBwdXNoQ29udHJvbEZsb3cob3AsIHNpZyk7CgkgICAgcHVzaExpbmUoY2YubGFiZWwgKyAiOiBkbyB7IGlmICggIiArIGNvbmQgKyAiKSB7IiwgLTEpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRUxTRToKCSAgICAvLyBYWFggVE9ETzogbmVlZCB0byBzYW5pdHktY2hlY2sgdGhhdCB0aGUgYGlmYCBicmFuY2gKCSAgICAvLyBsZWZ0IHByZWNpc2VseSBvbmUgdmFsdWUsIG9mIGNvcnJlY3QgdHlwZSwgb24gdGhlIHN0YWNrLgoJICAgIC8vIFRoZSBwdXNoL3BvcCBoZXJlIHJlc2V0cyBzdGFjayBzdGF0ZSBiZXR3ZWVuIHRoZSB0d28gYnJhbmNoZXMuCgkgICAgdmFyIGNmID0gcG9wQ29udHJvbEZsb3coKTsKCSAgICBpZiAoY2Yub3AgIT09IE9QQ09ERVMuSUYpIHsKCSAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiRUxTRSBvdXRzaWRlIG9mIElGIikKCSAgICB9CgkgICAgaWYgKCEgY2YuaXNEZWFkKSB7CgkgICAgICBjZi5lbmRSZWFjaGVkID0gdHJ1ZTsKCSAgICB9CgkgICAgcHVzaExpbmUoIn0gZWxzZSB7Iik7CgkgICAgcHVzaENvbnRyb2xGbG93KE9QQ09ERVMuRUxTRSwgY2Yuc2lnLCBjZi5lbmRSZWFjaGVkKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkVORDoKCSAgICBpZiAoY2ZTdGFjay5sZW5ndGggPT09IDEpIHsKCSAgICAgIC8vIEVuZCBvZiB0aGUgZW50aXJlIGZ1bmN0aW9uLgoJICAgICAgaWYgKGYuc2lnLnJldHVybl90eXBlcy5sZW5ndGggPT09IDApIHsKCQlpZiAoY2ZTdGFja1swXS50eXBlU3RhY2subGVuZ3RoID4gMCkgewoJCSAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ2b2lkIGZ1bmN0aW9uIGxlZnQgc29tZXRoaW5nIG9uIHRoZSBzdGFjayIpCgkJfQoJCXB1c2hMaW5lKCJyZXR1cm4iKTsKCSAgICAgIH0gZWxzZSB7CgkJcHVzaExpbmUoInJldHVybiAiICsgcG9wU3RhY2tWYXIoZi5zaWcucmV0dXJuX3R5cGVzWzBdKSk7CgkgICAgICB9CgkgICAgICBicmVhayBERUNPREUKCSAgICB9IGVsc2UgewoJICAgICAgLy8gRW5kIG9mIGEgY29udHJvbCBibG9jawoJICAgICAgdmFyIGNmID0gY2ZTdGFja1tjZlN0YWNrLmxlbmd0aCAtIDFdOwoJICAgICAgaWYgKCEgY2YuaXNEZWFkKSB7CgkJY2YuZW5kUmVhY2hlZCA9IHRydWU7CgkgICAgICB9IGVsc2UgaWYgKGNmLmVuZFJlYWNoZWQgJiYgY2Yuc2lnICE9PSBUWVBFUy5OT05FKSB7CgkJLy8gV2UncmUgcmVhY2hlZCBieSBhIGJyYW5jaCwgYnV0IG5vdCBieSBmYWxsLXRocm91Z2gsCgkJLy8gc28gdGhlcmUncyBub3QgZ29pbmcgdG8gYmUgYW4gZW50cnkgb24gdGhlIHN0YWNrLgoJCS8vIE1ha2Ugb25lLgoJCXB1c2hTdGFja1ZhcihjZi5zaWcpOwoJICAgICAgfQogICAgICAgICAgICAgIC8vIEFuIGlmIHdpdGhvdXQgYW4gZWxzZSBhbHdheXMgcmVhY2hlcyB0aGUgZW5kIG9mIHRoZSBibG9jay4KICAgICAgICAgICAgICBpZiAoY2Yub3AgPT09IE9QQ09ERVMuSUYpIHsKICAgICAgICAgICAgICAgIGNmLmVuZFJlYWNoZWQgPSB0cnVlOwogICAgICAgICAgICAgIH0KCSAgICAgIGlmIChjZi5lbmRSZWFjaGVkKSB7CgkJaWYgKGNmLnNpZyAhPT0gVFlQRVMuTk9ORSkgewoJCSAgdmFyIG91dHB1dCA9IGdldFN0YWNrVmFyKGNmLnNpZyk7CgkJfSBlbHNlIHsKCQkgIGlmIChjZi50eXBlU3RhY2subGVuZ3RoID4gMCkgewoJCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInZvaWQgYmxvY2sgbGVmdCB2YWx1ZXMgb24gdGhlIHN0YWNrIikKCQkgIH0KCQl9CgkgICAgICB9CgkgICAgICBwb3BDb250cm9sRmxvdygpOwoJICAgICAgaWYgKGNmLnNpZyAhPT0gVFlQRVMuTk9ORSAmJiBjZi5lbmRSZWFjaGVkKSB7CgkJcHVzaExpbmUoIiAgIiArIHB1c2hTdGFja1ZhcihjZi5zaWcpICsgIiA9ICIgKyBvdXRwdXQpOwoJICAgICAgfQoJICAgICAgc3dpdGNoIChjZi5vcCkgewoJCWNhc2UgT1BDT0RFUy5CTE9DSzoKCQkgIHB1c2hMaW5lKCJ9IHdoaWxlKDApIik7CgkJICBicmVhawoJCWNhc2UgT1BDT0RFUy5MT09QOgoJCSAgcHVzaExpbmUoIiAgYnJlYWsgIiArIGNmLmxhYmVsKTsKCQkgIHB1c2hMaW5lKCJ9Iik7CgkJICBicmVhawoJCWNhc2UgT1BDT0RFUy5JRjoKCQljYXNlIE9QQ09ERVMuRUxTRToKCQkgIHB1c2hMaW5lKCJ9IH0gd2hpbGUgKDApIik7CgkJICBicmVhawoJCWRlZmF1bHQ6CgkJICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIlBvcHBlZCBhbiB1bmV4cGVjdGVkIGNvbnRyb2wgb3AiKQoJICAgICAgfQogICAgICAgICAgICAgIC8vIFhYWCBUT0RPOiBlbnN1cmUgZW5kIG9mIGFuIGlmIGlzIGFsd2F5cyByZWFjaGVkIHdoZW4uCiAgICAgICAgICAgICAgLy8gaXQgaGFzIG5vIGVsc2UuICBUaGUgY29udGFpbmluZyBibG9jayBpZiAqbm90KiBkZWFkIGNvZGUuCgkgICAgICBpZiAoISBjZi5lbmRSZWFjaGVkKSB7CiAgICAgICAgICAgICAgICBtYXJrRGVhZENvZGUoKTsKCSAgICAgIH0KCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5CUjoKCSAgICB2YXIgZGVwdGggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGNmID0gZ2V0QnJhbmNoVGFyZ2V0KGRlcHRoKTsKCSAgICBzd2l0Y2ggKGNmLm9wKSB7CgkgICAgICBjYXNlIE9QQ09ERVMuQkxPQ0s6CgkgICAgICBjYXNlIE9QQ09ERVMuSUY6CgkgICAgICBjYXNlIE9QQ09ERVMuRUxTRToKCQljZi5lbmRSZWFjaGVkID0gdHJ1ZTsKCQlpZiAoY2Yuc2lnICE9PSBUWVBFUy5OT05FKSB7CgkJICB2YXIgcmVzdWx0VmFyID0gcG9wU3RhY2tWYXIoY2Yuc2lnKTsKCQkgIHZhciBvdXRwdXRWYXIgPSBnZXRCbG9ja091dHB1dFZhcihjZik7CgkJICBpZiAob3V0cHV0VmFyICE9PSByZXN1bHRWYXIpIHsKCQkgICAgcHVzaExpbmUob3V0cHV0VmFyICsgIiA9ICIgKyByZXN1bHRWYXIpOwoJCSAgfQoJCX0KCQlwdXNoTGluZSgiYnJlYWsgIiArIGNmLmxhYmVsKTsKCQlicmVhawoJICAgICAgY2FzZSAwOgoJCWNmLmVuZFJlYWNoZWQgPSB0cnVlOwoJCWlmIChjZi5zaWcgIT09IFRZUEVTLk5PTkUpIHsKCQkgIHZhciByZXN1bHRWYXIgPSBwb3BTdGFja1ZhcihjZi5zaWcpOwoJCSAgcHVzaExpbmUoInJldHVybiAiICsgcmVzdWx0VmFyKTsKCQl9IGVsc2UgewoJCSAgcHVzaExpbmUoInJldHVybiIpOwoJCX0KCQlicmVhawoJICAgICAgY2FzZSBPUENPREVTLkxPT1A6CgkJcHVzaExpbmUoImNvbnRpbnVlICIgKyBjZi5sYWJlbCk7CgkJYnJlYWsKCSAgICAgIGRlZmF1bHQ6CgkJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJCcmFuY2ggdG8gdW5zdXBwb3J0ZWQgb3Bjb2RlIikKCSAgICB9CgkgICAgbWFya0RlYWRDb2RlKCk7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5CUl9JRjoKCSAgICB2YXIgZGVwdGggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGNmID0gZ2V0QnJhbmNoVGFyZ2V0KGRlcHRoKTsKCSAgICBzd2l0Y2ggKGNmLm9wKSB7CgkgICAgICBjYXNlIE9QQ09ERVMuQkxPQ0s6CgkgICAgICBjYXNlIE9QQ09ERVMuSUY6CgkgICAgICBjYXNlIE9QQ09ERVMuRUxTRToKCQljZi5lbmRSZWFjaGVkID0gdHJ1ZTsKCQlwdXNoTGluZSgiaWYgKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgIikgeyIpOwoJCWlmIChjZi5zaWcgIT09IFRZUEVTLk5PTkUpIHsKCQkgIC8vIFRoaXMgaXMgbGVmdCBvbiB0aGUgc3RhY2sgaWYgY29uZGl0aW9uIGlzIG5vdCB0cnVlLgoJCSAgLy8gWFhYIFRPRE8gdGhpcyBuZWVkcyB0byBjaGVjayB3aGF0J3Mgb24gdGhlIHN0YWNrLgoJCSAgcHVzaExpbmUoIi8vIFNUQUNLICIgKyBKU09OLnN0cmluZ2lmeShjZlN0YWNrKSk7CgkJICBwdXNoTGluZSgiLy8gQkxPQ0sgVFlQRSAiICsgY2Yuc2lnKTsKCQkgIHZhciByZXN1bHRWYXIgPSBnZXRTdGFja1ZhcihjZi5zaWcpOwoJCSAgdmFyIG91dHB1dFZhciA9IGdldEJsb2NrT3V0cHV0VmFyKGNmKTsKCQkgIGlmIChvdXRwdXRWYXIgIT09IHJlc3VsdFZhcikgewoJCSAgICBwdXNoTGluZSgiICAiICsgb3V0cHV0VmFyICsgIiA9ICIgKyByZXN1bHRWYXIpOwoJCSAgfQoJCX0KCQlwdXNoTGluZSgiICBicmVhayAiICsgY2YubGFiZWwpOwoJCXB1c2hMaW5lKCJ9Iik7CgkJYnJlYWsKCSAgICAgIGNhc2UgMDoKCQljZi5lbmRSZWFjaGVkID0gdHJ1ZTsKCQlwdXNoTGluZSgiaWYgKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgIikgeyIpOwoJCWlmIChjZi5zaWcgIT09IFRZUEVTLk5PTkUpIHsKCQkgIHZhciByZXN1bHRWYXIgPSBnZXRTdGFja1ZhcihjZi5zaWcpOwoJCSAgcHVzaExpbmUoInJldHVybiAiICsgcmVzdWx0VmFyKTsKCQl9IGVsc2UgewoJCSAgcHVzaExpbmUoInJldHVybiIpOwoJCX0KCQlwdXNoTGluZSgifSIpOwoJCWJyZWFrCgkgICAgICBjYXNlIE9QQ09ERVMuTE9PUDoKCQlwdXNoTGluZSgiaWYgKCIgKyBwb3BTdGFja1ZhcihUWVBFUy5JMzIpICsgIikgeyBjb250aW51ZSAiICsgY2YubGFiZWwgKyAiIH0iKTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIkJyYW5jaCB0byB1bnN1cHBvcnRlZCBvcGNvZGUiKQoJICAgIH0KCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkJSX1RBQkxFOgoJICAgIC8vIFRlcnJpYmx5IGluZWZmaWNpZW50IGltcGxlbWVudGF0aW9uIG9mIGJyX3RhYmxlCgkgICAgLy8gdXNpbmcgYSBiaWcgb2wnIHN3aXRjaCBzdGF0ZW1lbnQuCgkgICAgdmFyIGNvdW50ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB0YXJnZXRzID0gW107CgkgICAgd2hpbGUgKGNvdW50ID4gMCkgewoJICAgICAgdGFyZ2V0cy5wdXNoKHMucmVhZF92YXJ1aW50MzIoKSk7CgkgICAgICBjb3VudC0tOwoJICAgIH0KCSAgICB2YXIgZGVmYXVsdF90YXJnZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGRlZmF1bHRfY2YgPSBnZXRCcmFuY2hUYXJnZXQoZGVmYXVsdF90YXJnZXQpOwoJICAgIHB1c2hMaW5lKCJzd2l0Y2goIiArIHBvcFN0YWNrVmFyKFRZUEVTLkkzMikgKyAiKSB7Iik7CgkgICAgLy8gWFhYIFRPRE86IHR5cGVjaGVja2luZyB0aGF0IGFsbCB0YXJnZXRzIGFjY2VwdCB0aGUKCSAgICAvLyBzYW1lIHJlc3VsdCB0eXBlIGV0Yy4KCSAgICB2YXIgcmVzdWx0VmFyID0gbnVsbDsKCSAgICBpZiAoZGVmYXVsdF9jZi5zaWcgIT09IFRZUEVTLk5PTkUpIHsKCSAgICAgIHJlc3VsdFZhciA9IHBvcFN0YWNrVmFyKGRlZmF1bHRfY2Yuc2lnKTsKCSAgICB9CgkgICAgdGFyZ2V0cy5mb3JFYWNoKGZ1bmN0aW9uKHRhcmdldCwgdGFyZ2V0TnVtKSB7CgkgICAgICBwdXNoTGluZSgiICBjYXNlICIgKyB0YXJnZXROdW0gKyAiOiIpOwoJICAgICAgdmFyIGNmID0gZ2V0QnJhbmNoVGFyZ2V0KHRhcmdldCk7CgkgICAgICBjZi5lbmRSZWFjaGVkID0gdHJ1ZTsKCSAgICAgIGlmIChjZi5zaWcgIT09IFRZUEVTLk5PTkUpIHsKCQl2YXIgb3V0cHV0VmFyID0gZ2V0QmxvY2tPdXRwdXRWYXIoY2YpOwoJCWlmIChvdXRwdXRWYXIgIT09IHJlc3VsdFZhcikgewoJCSAgcHVzaExpbmUoIiAgICAiICsgb3V0cHV0VmFyICsgIiA9ICIgKyByZXN1bHRWYXIpOwoJCX0KCSAgICAgIH0KCSAgICAgIHN3aXRjaCAoY2Yub3ApIHsKCQljYXNlIE9QQ09ERVMuQkxPQ0s6CgkJY2FzZSBPUENPREVTLklGOgoJCWNhc2UgT1BDT0RFUy5FTFNFOgoJCSAgcHVzaExpbmUoIiAgICBicmVhayAiICsgY2YubGFiZWwpOwoJCSAgYnJlYWsKCQljYXNlIE9QQ09ERVMuTE9PUDoKCQkgIHB1c2hMaW5lKCIgICAgY29udGludWUgIiArIGNmLmxhYmVsKTsKCQkgIGJyZWFrCgkJY2FzZSAwOgoJCSAgcHVzaExpbmUoIiAgICByZXR1cm4gIiArIG91dHB1dFZhcik7CgkJICBicmVhawoJCWRlZmF1bHQ6CgkJICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVua25vd24gYnJhbmNoIHRhcmdldCB0eXBlIikKCSAgICAgIH0KCSAgICB9KTsKCSAgICBwdXNoTGluZSgiICBkZWZhdWx0OiIpOwoJICAgIGlmIChkZWZhdWx0X2NmLnNpZyAhPT0gVFlQRVMuTk9ORSkgewoJICAgICAgdmFyIG91dHB1dFZhciA9IGdldEJsb2NrT3V0cHV0VmFyKGRlZmF1bHRfY2YpOwoJICAgICAgaWYgKG91dHB1dFZhciAhPT0gcmVzdWx0VmFyKSB7CgkJcHVzaExpbmUoIiAgICAiICsgb3V0cHV0VmFyICsgIiA9ICIgKyByZXN1bHRWYXIpOwoJICAgICAgfQoJICAgIH0KCSAgICBkZWZhdWx0X2NmLmVuZFJlYWNoZWQgPSB0cnVlOwoJICAgIHN3aXRjaCAoZGVmYXVsdF9jZi5vcCkgewoJICAgICAgY2FzZSBPUENPREVTLkJMT0NLOgoJICAgICAgY2FzZSBPUENPREVTLklGOgoJICAgICAgY2FzZSBPUENPREVTLkVMU0U6CgkJcHVzaExpbmUoIiAgICBicmVhayAiICsgZGVmYXVsdF9jZi5sYWJlbCk7CgkJYnJlYWsKCSAgICAgIGNhc2UgT1BDT0RFUy5MT09QOgoJCXB1c2hMaW5lKCIgICAgY29udGludWUgIiArIGRlZmF1bHRfY2YubGFiZWwpOwoJCWJyZWFrCgkgICAgICBjYXNlIDA6CgkJcHVzaExpbmUoIiAgICByZXR1cm4gIiArIG91dHB1dFZhcik7CgkJYnJlYWsKCSAgICAgIGRlZmF1bHQ6CgkJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bmtub3duIGJyYW5jaCB0YXJnZXQgdHlwZSIpCgkgICAgfQoJICAgIHB1c2hMaW5lKCJ9Iik7CgkgICAgbWFya0RlYWRDb2RlKCk7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5SRVRVUk46CgkgICAgaWYgKGYuc2lnLnJldHVybl90eXBlcy5sZW5ndGggPT09IDApIHsKCSAgICAgIHB1c2hMaW5lKCJyZXR1cm4iKTsKCSAgICB9IGVsc2UgewoJICAgICAgcHVzaExpbmUoInJldHVybiAiICsgcG9wU3RhY2tWYXIoZi5zaWcucmV0dXJuX3R5cGVzWzBdKSk7CgkgICAgfQoJICAgIG1hcmtEZWFkQ29kZSgpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuQ0FMTDoKCSAgICB2YXIgaW5kZXggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGNhbGxTaWcgPSBnZXRGdW5jdGlvblNpZ25hdHVyZShpbmRleCk7CgkgICAgLy8gVGhlIHJpZ2h0bW9zdCBhcmcgaXMgdGhlIG9uZSBvbiB0b3Agb2Ygc3RhY2ssCgkgICAgLy8gc28gd2UgaGF2ZSB0byBwb3AgdGhlbSBpbiByZXZlcnNlLgoJICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGNhbGxTaWcucGFyYW1fdHlwZXMubGVuZ3RoKTsKCSAgICBmb3IgKHZhciBpID0gY2FsbFNpZy5wYXJhbV90eXBlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewoJICAgICAgYXJnc1tpXSA9IHBvcFN0YWNrVmFyKGNhbGxTaWcucGFyYW1fdHlwZXNbaV0pOwoJICAgIH0KCSAgICBpZiAoY2FsbFNpZy5yZXR1cm5fdHlwZXMubGVuZ3RoID09PSAwKSB7CgkgICAgICBwdXNoTGluZSgiRiIgKyBpbmRleCArICIoIiArIGFyZ3Muam9pbigiLCIpICsgIikiKTsKCSAgICB9IGVsc2UgewoJICAgICAgLy8gV2Uga25vdyB0aGVyZSdzIGF0IG1vc3Qgb25lIHJldHVybiB0eXBlLCBmb3Igbm93LgoJICAgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihjYWxsU2lnLnJldHVybl90eXBlc1swXSk7CgkgICAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gRiIgKyBpbmRleCArICIoIiArIGFyZ3Muam9pbigiLCIpICsgIikiKTsKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5DQUxMX0lORElSRUNUOgoJICAgIHZhciB0eXBlX2luZGV4ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB0YWJsZV9pbmRleCA9IHMucmVhZF92YXJ1aW50MSgpOwoJICAgIGlmICh0YWJsZV9pbmRleCAhPT0gMCkgewoJICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJNVlAgcmVzZXJ2ZWQtdmFsdWUgY29uc3RyYWludCB2aW9sYXRpb24iKQoJICAgIH0KCSAgICBnZXRUYWJsZVR5cGUodGFibGVfaW5kZXgpOyAvLyBjaGVjayB0aGF0IHRoZSB0YWJsZSBleGlzdHMKCSAgICB2YXIgY2FsbFNpZyA9IGdldFR5cGVTaWduYXR1cmUodHlwZV9pbmRleCk7CgkgICAgdmFyIGNhbGxJZHggPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIC8vIFRoZSByaWdodG1vc3QgYXJnIGlzIHRoZSBvbmUgb24gdG9wIG9mIHN0YWNrLAoJICAgIC8vIHNvIHdlIGhhdmUgdG8gcG9wIHRoZW0gaW4gcmV2ZXJzZS4KCSAgICB2YXIgYXJncyA9IG5ldyBBcnJheShjYWxsU2lnLnBhcmFtX3R5cGVzLmxlbmd0aCk7CgkgICAgZm9yICh2YXIgaSA9IGNhbGxTaWcucGFyYW1fdHlwZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKCSAgICAgIGFyZ3NbaV0gPSBwb3BTdGFja1ZhcihjYWxsU2lnLnBhcmFtX3R5cGVzW2ldKTsKCSAgICB9CgkgICAgLy8gWFhYIFRPRE86IGhvdyB0byBkeW5hbWljYWxseSBjaGVjayBjYWxsIHNpZ25hdHVyZT8KCSAgICAvLyBTaGFsbCB3ZSBqdXN0IGFsd2F5cyBjYWxsIGEgc3R1YiB0aGF0IGRvZXMgdGhpcyBmb3IgdXM/CgkgICAgLy8gU2hhbGwgd2UgdXNlIGFzbWpzLXN0eWxlIHNpZ25hdHVyZS1zcGVjaWZpYyB0YWJsZXMgd2l0aAoJICAgIC8vIHBsYWNlaG9sZGVycyB0aGF0IHRyYXA/CgkgICAgLy8gRm9yIG5vdyB3ZSBqdXN0IGRvIGEgYnVuY2ggb2YgZXhwbGljaXQgY2hlY2tzLgoJICAgIHB1c2hMaW5lKCJpZiAoIVQwWyIgKyBjYWxsSWR4ICsgIl0pIHsiKTsKCSAgICBwdXNoTGluZSgiICB0cmFwKCd0YWJsZSBPT0InKSIpOwoJICAgIHB1c2hMaW5lKCJ9Iik7CgkgICAgcHVzaExpbmUoImlmIChUMFsiICsgY2FsbElkeCArICJdLl93YXNtVHlwZVNpZ1N0cikgeyIpOwoJICAgIHB1c2hMaW5lKCIgIGlmIChUMFsiICsgY2FsbElkeCArICJdLl93YXNtVHlwZVNpZ1N0ciAhPT0gJyIgKyBtYWtlU2lnU3RyKGNhbGxTaWcpICsgIicpIHsiKTsKCSAgICBwdXNoTGluZSgiICAgIHRyYXAoJ3RhYmxlIHNpZycpIik7CgkgICAgcHVzaExpbmUoIiAgfSIpOwoJICAgIHB1c2hMaW5lKCJ9Iik7CgkgICAgaWYgKGNhbGxTaWcucmV0dXJuX3R5cGVzLmxlbmd0aCA9PT0gMCkgewoJICAgICAgcHVzaExpbmUoIlQwWyIgKyBjYWxsSWR4ICsgIl0oIiArIGFyZ3Muam9pbigiLCIpICsgIikiKTsKCSAgICB9IGVsc2UgewoJICAgICAgLy8gV2Uga25vdyB0aGVyZSdzIGF0IG1vc3Qgb25lIHJldHVybiB0eXBlLCBmb3Igbm93LgoJICAgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihjYWxsU2lnLnJldHVybl90eXBlc1swXSk7CgkgICAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gVDBbIiArIGNhbGxJZHggKyAiXSgiICsgYXJncy5qb2luKCIsIikgKyAiKSIpOwoJICAgICAgLy9wdXNoTGluZSgiaWYoIiArIG91dHB1dCArICIgPT0gIDE3MDE2NjcxNDMpIHsgY29uc29sZS5sb2coJ0NBTExJIEJBRCcpO3Rocm93IG5ldyBFcnJvcignY2FsbGkgYmFkJyl9IikKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5EUk9QOgoJICAgIHBvcFN0YWNrVmFyKFRZUEVTLlVOS05PV04pOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuU0VMRUNUOgoJICAgIHZhciBjb25kVmFyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgdHlwID0gcGVla1N0YWNrVHlwZSgpOwoJICAgIHZhciBmYWxzZVZhciA9IHBvcFN0YWNrVmFyKHR5cCk7CgkgICAgdmFyIHRydWVWYXIgPSBwb3BTdGFja1Zhcih0eXApOwoJICAgIHB1c2hTdGFja1Zhcih0eXApOwoJICAgIHZhciBvdXRwdXRWYXIgPSBnZXRTdGFja1Zhcih0eXApOwoJICAgIHB1c2hMaW5lKG91dHB1dFZhciArICIgPSAiICsgY29uZFZhciArICIgPyAiICsgdHJ1ZVZhciArICI6IiArIGZhbHNlVmFyKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkdFVF9MT0NBTDoKCSAgICB2YXIgaW5kZXggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHR5cCA9IGdldExvY2FsVHlwZShpbmRleCk7CgkgICAgcHVzaFN0YWNrVmFyKHR5cCk7CgkgICAgcHVzaExpbmUoZ2V0U3RhY2tWYXIodHlwKSArICIgPSAiICsgZ2V0TG9jYWxWYXIoaW5kZXgpKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLlNFVF9MT0NBTDoKCSAgICB2YXIgaW5kZXggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgcHVzaExpbmUoZ2V0TG9jYWxWYXIoaW5kZXgpICsgIiA9ICIgKyBwb3BTdGFja1ZhcihnZXRMb2NhbFR5cGUoaW5kZXgpKSk7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5URUVfTE9DQUw6CgkgICAgdmFyIGluZGV4ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB0eXAgPSBnZXRMb2NhbFR5cGUoaW5kZXgpOwoJICAgIHB1c2hMaW5lKGdldExvY2FsVmFyKGluZGV4KSArICIgPSAiICsgcG9wU3RhY2tWYXIodHlwKSk7CgkgICAgcHVzaFN0YWNrVmFyKHR5cCk7IC8vIHRoaXMgdmFyIHdpbGwgYWxyZWFkeSBjb250YWluIHRoZSBwcmV2aW91cyB2YWx1ZQoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuR0VUX0dMT0JBTDoKCSAgICB2YXIgaW5kZXggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHR5cCA9IGdldEdsb2JhbFR5cGUoaW5kZXgpOwoJICAgIHB1c2hTdGFja1Zhcih0eXApOwoJICAgIHB1c2hMaW5lKGdldFN0YWNrVmFyKHR5cCkgKyAiID0gIiArIGdldEdsb2JhbFZhcihpbmRleCwgdHlwKSk7CgkgICAgcHVzaExpbmUoIiAgaWYoIiArIGdldFN0YWNrVmFyKHR5cCkgKyAiID09ICAxNzAxNjY3MTQzKSB7IHRocm93IG5ldyBFcnJvcignZ2xvYmFsIGJhZCcpfSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuU0VUX0dMT0JBTDoKCSAgICB2YXIgaW5kZXggPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHR5cCA9IGdldEdsb2JhbFR5cGUoaW5kZXgpOwoJICAgIGNoZWNrR2xvYmFsTXV0YWJsZShpbmRleCk7CgkgICAgcHVzaExpbmUoZ2V0R2xvYmFsVmFyKGluZGV4LCB0eXApICsgIiA9ICIgKyBwb3BTdGFja1Zhcih0eXApKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9MT0FEOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgNCk7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJICAgICAgY2FzZSAxOgoJCWkzMl9sb2FkX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQpOwoJCWJyZWFrCgkgICAgICBjYXNlIDI6CgkJaTMyX2xvYWRfYWxpZ25lZChhZGRyLCBvZmZzZXQpOwoJCWJyZWFrCgkgICAgICBkZWZhdWx0OgoJCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5zdXBwb3J0ZWQgbG9hZCBmbGFncyIpCgkgICAgfQoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X0xPQUQ6CgkgICAgZ2V0TWVtb3J5VHlwZSgwKTsKCSAgICB2YXIgZmxhZ3MgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIG9mZnNldCA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICAvLyBOZWVkIHR3byBpMzIgdmFycywgc28gY3JlYXRlIGEgdGVtcCBvbmUuCgkgICAgcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgdmFyIGFkZHJEdXAgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIHZhciBhZGRyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBwdXNoTGluZShhZGRyRHVwICsgIiA9ICIgKyBhZGRyKTsKCSAgICBib3VuZHNDaGVjayhhZGRyLCBvZmZzZXQsIDgpOwoJICAgIHN3aXRjaCAoZmxhZ3MpIHsKCSAgICAgIGNhc2UgMDoKCSAgICAgIGNhc2UgMToKCQlpMzJfbG9hZF91bmFsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlpMzJfbG9hZF91bmFsaWduZWQoYWRkckR1cCwgb2Zmc2V0ICsgNCk7CgkJYnJlYWsKCSAgICAgIGNhc2UgMjoKCSAgICAgIGNhc2UgMzoKCQlpMzJfbG9hZF9hbGlnbmVkKGFkZHIsIG9mZnNldCk7CgkJaTMyX2xvYWRfYWxpZ25lZChhZGRyRHVwLCBvZmZzZXQgKyA0KTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3MiKQoJICAgIH0KCSAgICBpNjRfZnJvbV9pMzJ4MigpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0xPQUQ6CgkgICAgZ2V0TWVtb3J5VHlwZSgwKTsKCSAgICB2YXIgZmxhZ3MgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIG9mZnNldCA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCA0KTsKCSAgICBzd2l0Y2ggKGZsYWdzKSB7CgkgICAgICBjYXNlIDA6CgkgICAgICBjYXNlIDE6CgkJZjMyX2xvYWRfdW5hbGlnbmVkKGFkZHIsIG9mZnNldCk7CgkJYnJlYWsKCSAgICAgIGNhc2UgMjoKCQlmMzJfbG9hZF9hbGlnbmVkKGFkZHIsIG9mZnNldCk7CgkJYnJlYWsKCSAgICAgIGRlZmF1bHQ6CgkJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bnN1cHBvcnRlZCBsb2FkIGZsYWdzIikKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GNjRfTE9BRDoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBhZGRyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBib3VuZHNDaGVjayhhZGRyLCBvZmZzZXQsIDgpOwoJICAgIHN3aXRjaCAoZmxhZ3MpIHsKCSAgICAgIGNhc2UgMDoKCSAgICAgIGNhc2UgMToKCSAgICAgIGNhc2UgMjoKCQlmNjRfbG9hZF91bmFsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgY2FzZSAzOgoJCWY2NF9sb2FkX2FsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3M6ICIgKyBmbGFncykKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfTE9BRDhfUzoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICBpZiAoZmxhZ3MgPiAwKSB7CgkgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImFsaWdubWVudCBsYXJnZXIgdGhhbiBuYXR1cmFsIikKCSAgICB9CgkgICAgdmFyIG9mZnNldCA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCAxKTsKCSAgICBpMzJfbG9hZDhfcyhhZGRyLCBvZmZzZXQpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0xPQUQ4X1U6CgkgICAgZ2V0TWVtb3J5VHlwZSgwKTsKCSAgICB2YXIgZmxhZ3MgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgaWYgKGZsYWdzID4gMCkgewoJICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJhbGlnbm1lbnQgbGFyZ2VyIHRoYW4gbmF0dXJhbCIpCgkgICAgfQoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgMSk7CgkgICAgaTMyX2xvYWQ4X3UoYWRkciwgb2Zmc2V0KTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9MT0FEMTZfUzoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBhZGRyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBib3VuZHNDaGVjayhhZGRyLCBvZmZzZXQsIDIpOwoJICAgIHN3aXRjaCAoZmxhZ3MpIHsKCSAgICAgIGNhc2UgMDoKCQlpMzJfbG9hZDE2X3NfdW5hbGlnbmVkKGFkZHIsIG9mZnNldCk7CgkJYnJlYWsKCSAgICAgIGNhc2UgMToKCQlpMzJfbG9hZDE2X3NfYWxpZ25lZChhZGRyLCBvZmZzZXQpOwoJCWJyZWFrCgkgICAgICBkZWZhdWx0OgoJCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5zdXBwb3J0ZWQgbG9hZCBmbGFncyIpCgkgICAgfQoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0xPQUQxNl9VOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgMik7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJCWkzMl9sb2FkMTZfdV91bmFsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgY2FzZSAxOgoJCWkzMl9sb2FkMTZfdV9hbGlnbmVkKGFkZHIsIG9mZnNldCk7CgkJYnJlYWsKCSAgICAgIGRlZmF1bHQ6CgkJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bnN1cHBvcnRlZCBsb2FkIGZsYWdzIikKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfTE9BRDhfUzoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICBpZiAoZmxhZ3MgPiAwKSB7CgkgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImFsaWdubWVudCBsYXJnZXIgdGhhbiBuYXR1cmFsIikKCSAgICB9CgkgICAgdmFyIG9mZnNldCA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCAxKTsKCSAgICBpMzJfbG9hZDhfcyhhZGRyLCBvZmZzZXQpOwoJICAgIGk2NF9mcm9tX2kzMl9zKCk7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfTE9BRDhfVToKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICBpZiAoZmxhZ3MgPiAwKSB7CgkgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoImFsaWdubWVudCBsYXJnZXIgdGhhbiBuYXR1cmFsIikKCSAgICB9CgkgICAgdmFyIG9mZnNldCA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCAxKTsKCSAgICBpMzJfbG9hZDhfdShhZGRyLCBvZmZzZXQpOwoJICAgIGk2NF9mcm9tX2kzMl91KCk7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfTE9BRDE2X1M6CgkgICAgZ2V0TWVtb3J5VHlwZSgwKTsKCSAgICB2YXIgZmxhZ3MgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIG9mZnNldCA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCAyKTsKCSAgICBzd2l0Y2ggKGZsYWdzKSB7CgkgICAgICBjYXNlIDA6CgkJaTMyX2xvYWQxNl9zX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQpOwoJCWJyZWFrCgkgICAgICBjYXNlIDE6CgkJaTMyX2xvYWQxNl9zX2FsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3MiKQoJICAgIH0KCSAgICBpNjRfZnJvbV9pMzJfcygpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X0xPQUQxNl9VOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgMik7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJCWkzMl9sb2FkMTZfdV91bmFsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgY2FzZSAxOgoJCWkzMl9sb2FkMTZfdV9hbGlnbmVkKGFkZHIsIG9mZnNldCk7CgkJYnJlYWsKCSAgICAgIGRlZmF1bHQ6CgkJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bnN1cHBvcnRlZCBsb2FkIGZsYWdzIikKCSAgICB9CgkgICAgaTY0X2Zyb21faTMyX3UoKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9MT0FEMzJfUzoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBhZGRyID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBib3VuZHNDaGVjayhhZGRyLCBvZmZzZXQsIDQpOwoJICAgIHN3aXRjaCAoZmxhZ3MpIHsKCSAgICAgIGNhc2UgMDoKCSAgICAgIGNhc2UgMToKCQlpMzJfbG9hZF91bmFsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgY2FzZSAyOgoJCWkzMl9sb2FkX2FsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3MiKQoJICAgIH0KCSAgICBpNjRfZnJvbV9pMzJfcygpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X0xPQUQzMl9VOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgNCk7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJICAgICAgY2FzZSAxOgoJCWkzMl9sb2FkX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQpOwoJICAgICAgY2FzZSAyOgoJCWkzMl9sb2FkX2FsaWduZWQoYWRkciwgb2Zmc2V0KTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3MiKQoJICAgIH0KCSAgICBpNjRfZnJvbV9pMzJfdSgpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1NUT1JFOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHZhbHVlID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCA0KTsKCSAgICBzd2l0Y2ggKGZsYWdzKSB7CgkgICAgICBjYXNlIDA6CgkgICAgICBjYXNlIDE6CgkJaTMyX3N0b3JlX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlKTsKCQlicmVhawoJICAgICAgY2FzZSAyOgoJCWkzMl9zdG9yZV9hbGlnbmVkKGFkZHIsIG9mZnNldCwgdmFsdWUpOwoJCWJyZWFrCgkgICAgICBkZWZhdWx0OgoJCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5zdXBwb3J0ZWQgbG9hZCBmbGFncyIpCgkgICAgfQoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1NUT1JFOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHZhbHVlID0gcG9wU3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCA4KTsKCSAgICBzd2l0Y2ggKGZsYWdzKSB7CgkgICAgICBjYXNlIDA6CgkgICAgICBjYXNlIDE6CgkJaTMyX3N0b3JlX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlICsgIi5sb3ciKTsKCQlpMzJfc3RvcmVfdW5hbGlnbmVkKGFkZHIsIG9mZnNldCArIDQsIHZhbHVlICsgIi5oaWdoIik7CgkJYnJlYWsKCSAgICAgIGNhc2UgMjoKCSAgICAgIGNhc2UgMzoKCQlpMzJfc3RvcmVfYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlICsgIi5sb3ciKTsKCQlpMzJfc3RvcmVfYWxpZ25lZChhZGRyLCBvZmZzZXQgKyA0LCB2YWx1ZSArICIuaGlnaCIpOwoJCWJyZWFrCgkgICAgICBkZWZhdWx0OgoJCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5zdXBwb3J0ZWQgbG9hZCBmbGFncyIpCgkgICAgfQoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX1NUT1JFOgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHZhbHVlID0gcG9wU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCA4KTsKCSAgICBzd2l0Y2ggKGZsYWdzKSB7CgkgICAgICBjYXNlIDA6CgkgICAgICBjYXNlIDE6CgkJZjMyX3N0b3JlX3VuYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlKTsKCQlicmVhawoJICAgICAgY2FzZSAyOgoJCWYzMl9zdG9yZV9hbGlnbmVkKGFkZHIsIG9mZnNldCwgdmFsdWUpOwoJCWJyZWFrCgkgICAgICBkZWZhdWx0OgoJCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidW5zdXBwb3J0ZWQgbG9hZCBmbGFnczogIiArIGZsYWdzKQoJICAgIH0KCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9TVE9SRToKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB2YWx1ZSA9IHBvcFN0YWNrVmFyKFRZUEVTLkY2NCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgOCk7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJICAgICAgY2FzZSAxOgoJICAgICAgY2FzZSAyOgoJCWY2NF9zdG9yZV91bmFsaWduZWQoYWRkciwgb2Zmc2V0LCB2YWx1ZSk7CgkJYnJlYWsKCSAgICAgIGNhc2UgMzoKCQlmNjRfc3RvcmVfYWxpZ25lZChhZGRyLCBvZmZzZXQsIHZhbHVlKTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3M6ICIgKyBmbGFncykKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfU1RPUkU4OgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIGlmIChmbGFncyA+IDApIHsKCSAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiYWxpZ25tZW50IGxhcmdlciB0aGFuIG5hdHVyYWwiKQoJICAgIH0KCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB2YWx1ZSA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgMSk7CgkgICAgaTMyX3N0b3JlOChhZGRyLCBvZmZzZXQsIHZhbHVlICsgIiAmIDB4RkYiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9TVE9SRTE2OgoJICAgIGdldE1lbW9yeVR5cGUoMCk7CgkgICAgdmFyIGZsYWdzID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHZhbHVlID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCAyKTsKCSAgICBzd2l0Y2ggKGZsYWdzKSB7CgkgICAgICBjYXNlIDA6CgkJaTMyX3N0b3JlOChhZGRyLCBvZmZzZXQgKyAwLCAiKCIgKyB2YWx1ZSArICIgJiAweDAwRkYpID4+PiAwIik7CgkJaTMyX3N0b3JlOChhZGRyLCBvZmZzZXQgKyAxLCAiKCIgKyB2YWx1ZSArICIgJiAweEZGMDApID4+PiA4Iik7CgkJYnJlYWsKCSAgICAgIGNhc2UgMToKCQlpMzJfc3RvcmUxNihhZGRyLCBvZmZzZXQsICIoIiArIHZhbHVlICsgIiAmIDB4RkZGRikgPj4+IDAiKTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3MiKQoJICAgIH0KCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9TVE9SRTg6CgkgICAgZ2V0TWVtb3J5VHlwZSgwKTsKCSAgICB2YXIgZmxhZ3MgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgaWYgKGZsYWdzID4gMCkgewoJICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJhbGlnbm1lbnQgbGFyZ2VyIHRoYW4gbmF0dXJhbCIpCgkgICAgfQoJICAgIHZhciBvZmZzZXQgPSBzLnJlYWRfdmFydWludDMyKCk7CgkgICAgdmFyIHZhbHVlID0gcG9wU3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICB2YXIgYWRkciA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgYm91bmRzQ2hlY2soYWRkciwgb2Zmc2V0LCAxKTsKCSAgICBpMzJfc3RvcmU4KGFkZHIsIG9mZnNldCwgIigiICsgdmFsdWUgKyAiLmxvdykgJiAweEZGIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfU1RPUkUxNjoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB2YWx1ZSA9IHBvcFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgMik7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJCWkzMl9zdG9yZTgoYWRkciwgb2Zmc2V0ICsgMCwgIigoIiArIHZhbHVlICsgIi5sb3cpICYgMHgwMEZGKSA+Pj4gMCIpOwoJCWkzMl9zdG9yZTgoYWRkciwgb2Zmc2V0ICsgMSwgIigoIiArIHZhbHVlICsgIi5sb3cpICYgMHhGRjAwKSA+Pj4gOCIpOwoJCWJyZWFrCgkgICAgICBjYXNlIDE6CgkJaTMyX3N0b3JlMTYoYWRkciwgb2Zmc2V0LCAiKCgiICsgdmFsdWUgKyAiLmxvdykgJiAweEZGRkYpID4+PiAwIik7CgkJYnJlYWsKCSAgICAgIGRlZmF1bHQ6CgkJdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bnN1cHBvcnRlZCBsb2FkIGZsYWdzIikKCSAgICB9CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfU1RPUkUzMjoKCSAgICBnZXRNZW1vcnlUeXBlKDApOwoJICAgIHZhciBmbGFncyA9IHMucmVhZF92YXJ1aW50MzIoKTsKCSAgICB2YXIgb2Zmc2V0ID0gcy5yZWFkX3ZhcnVpbnQzMigpOwoJICAgIHZhciB2YWx1ZSA9IHBvcFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgdmFyIGFkZHIgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIGJvdW5kc0NoZWNrKGFkZHIsIG9mZnNldCwgNCk7CgkgICAgc3dpdGNoIChmbGFncykgewoJICAgICAgY2FzZSAwOgoJCWkzMl9zdG9yZTgoYWRkciwgb2Zmc2V0ICsgMCwgIigoIiArIHZhbHVlICsgIi5sb3cpICYgMHgwMDAwMDBGRikgPj4+IDAiKTsKCQlpMzJfc3RvcmU4KGFkZHIsIG9mZnNldCArIDEsICIoKCIgKyB2YWx1ZSArICIubG93KSAmIDB4MDAwMEZGMDApID4+PiA4Iik7CgkJaTMyX3N0b3JlOChhZGRyLCBvZmZzZXQgKyAyLCAiKCgiICsgdmFsdWUgKyAiLmxvdykgJiAweDAwRkYwMDAwKSA+Pj4gMTYiKTsKCQlpMzJfc3RvcmU4KGFkZHIsIG9mZnNldCArIDMsICIoKCIgKyB2YWx1ZSArICIubG93KSAmIDB4RkYwMDAwMDApID4+PiAyNCIpOwoJCWJyZWFrCgkgICAgICBjYXNlIDE6CgkJaTMyX3N0b3JlMTYoYWRkciwgb2Zmc2V0ICsgMCwgIigoIiArIHZhbHVlICsgIi5sb3cpICYgMHgwMDAwRkZGRikgPj4+IDAiKTsKCQlpMzJfc3RvcmUxNihhZGRyLCBvZmZzZXQgKyAyLCAiKCgiICsgdmFsdWUgKyAiLmxvdykgJiAweEZGRkYwMDAwKSA+Pj4gMTYiKTsKCQlicmVhawoJICAgICAgY2FzZSAyOgoJCWkzMl9zdG9yZV9hbGlnbmVkKGFkZHIsIG9mZnNldCwgIigiICsgdmFsdWUgKyAiLmxvdykiKTsKCQlicmVhawoJICAgICAgZGVmYXVsdDoKCQl0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIGxvYWQgZmxhZ3MiKQoJICAgIH0KCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkNVUlJFTlRfTUVNT1JZOgoJICAgIHZhciBtZW1faW5kZXggPSBzLnJlYWRfdmFydWludDEoKTsKCSAgICBpZiAobWVtX2luZGV4ICE9PSAwKSB7CgkgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm9ubHkgb25lIG1lbW9yeSBpbiB0aGUgTVZQIikKCSAgICB9CgkgICAgZ2V0TWVtb3J5VHlwZShtZW1faW5kZXgpOwoJICAgIHB1c2hMaW5lKHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpICsgIiA9IChtZW1vcnlTaXplIC8gIiArIFBBR0VfU0laRSArICIpfDAiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkdST1dfTUVNT1JZOgoJICAgIHZhciBtZW1faW5kZXggPSBzLnJlYWRfdmFydWludDEoKTsKCSAgICBpZiAobWVtX2luZGV4ICE9PSAwKSB7CgkgICAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoIm9ubHkgb25lIG1lbW9yeSBpbiB0aGUgTVZQIikKCSAgICB9CgkgICAgZ2V0TWVtb3J5VHlwZShtZW1faW5kZXgpOwoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgcmVzID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgcHVzaExpbmUocmVzICsgIiA9IE0wLl9ncm93KCIgKyBvcGVyYW5kICsgIikiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9DT05TVDoKCSAgICB2YXIgdmFsID0gcy5yZWFkX3ZhcmludDMyKCk7CgkgICAgcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkkzMikgKyAiID0gIiArIHJlbmRlckpTVmFsdWUodmFsLCBjb25zdGFudHMpKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9DT05TVDoKCSAgICB2YXIgdmFsID0gcy5yZWFkX3ZhcmludDY0KCk7CgkgICAgcHVzaExpbmUocHVzaFN0YWNrVmFyKFRZUEVTLkk2NCkgKyAiID0gIiArIHJlbmRlckpTVmFsdWUodmFsLCBjb25zdGFudHMpKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkYzMl9DT05TVDoKCSAgICB2YXIgdmFsID0gcy5yZWFkX2Zsb2F0MzIoKTsKCSAgICBwdXNoTGluZShwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKSArICIgPSAiICsgcmVuZGVySlNWYWx1ZSh2YWwsIGNvbnN0YW50cykpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0NPTlNUOgoJICAgIHB1c2hMaW5lKHB1c2hTdGFja1ZhcihUWVBFUy5GNjQpICsgIiA9ICIgKyByZW5kZXJKU1ZhbHVlKHMucmVhZF9mbG9hdDY0KCksIGNvbnN0YW50cykpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0VRWjoKCSAgICB2YXIgb3BlcmFuZCA9IGdldFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgcHVzaExpbmUob3BlcmFuZCArICIgPSAoIiArIG9wZXJhbmQgKyAiID09PSAwKXwwIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfRVE6CgkgICAgaTMyX2JpbmFyeU9wKCI9PT0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9ORToKCSAgICBpMzJfYmluYXJ5T3AoIiE9PSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0xUX1M6CgkgICAgaTMyX2JpbmFyeU9wKCI8Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfTFRfVToKCSAgICBpMzJfYmluYXJ5T3AoIjwiLCAiPj4+MCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0dUX1M6CgkgICAgaTMyX2JpbmFyeU9wKCI+Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfR1RfVToKCSAgICBpMzJfYmluYXJ5T3AoIj4iLCAiPj4+MCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0xFX1M6CgkgICAgaTMyX2JpbmFyeU9wKCI8PSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0xFX1U6CgkgICAgaTMyX2JpbmFyeU9wKCI8PSIsICI+Pj4wIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfR0VfUzoKCSAgICBpMzJfYmluYXJ5T3AoIj49Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfR0VfVToKCSAgICBpMzJfYmluYXJ5T3AoIj49IiwgIj4+PjAiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9FUVo6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5JNjQpOwoJICAgIHZhciByZXN1bHQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBwdXNoTGluZShyZXN1bHQgKyAiID0gKCIgKyBvcGVyYW5kICsgIi5pc1plcm8oKSl8MCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X0VROgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2VxIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfTkU6CgkgICAgaTY0X2NvbXBhcmVGdW5jKCJpNjRfbmUiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9MVF9TOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2x0X3MiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9MVF9VOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2x0X3UiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9HVF9TOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2d0X3MiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9HVF9VOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2d0X3UiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9MRV9TOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2xlX3MiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9MRV9VOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2xlX3UiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9HRV9TOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2dlX3MiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9HRV9VOgoJICAgIGk2NF9jb21wYXJlRnVuYygiaTY0X2dlX3UiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkYzMl9FUToKCSAgICBmMzJfY29tcGFyZU9wKCI9PT0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkYzMl9ORToKCSAgICBmMzJfY29tcGFyZU9wKCIhPT0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkYzMl9MVDoKCSAgICBmMzJfY29tcGFyZU9wKCI8Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfR1Q6CgkgICAgZjMyX2NvbXBhcmVPcCgiPiIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0xFOgoJICAgIGYzMl9jb21wYXJlT3AoIjw9Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfR0U6CgkgICAgZjMyX2NvbXBhcmVPcCgiPj0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9FUToKCSAgICBmNjRfY29tcGFyZU9wKCI9PT0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9ORToKCSAgICBmNjRfY29tcGFyZU9wKCIhPT0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9MVDoKCSAgICBmNjRfY29tcGFyZU9wKCI8Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GNjRfR1Q6CgkgICAgZjY0X2NvbXBhcmVPcCgiPiIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0xFOgoJICAgIGY2NF9jb21wYXJlT3AoIjw9Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GNjRfR0U6CgkgICAgZjY0X2NvbXBhcmVPcCgiPj0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9DTFo6CgkgICAgaTMyX3VuYXJ5T3AoImkzMl9jbHoiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9DVFo6CgkgICAgaTMyX3VuYXJ5T3AoImkzMl9jdHoiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9QT1BDTlQ6CgkgICAgaTMyX3VuYXJ5T3AoImkzMl9wb3BjbnQiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9BREQ6CgkgICAgaTMyX2JpbmFyeU9wKCIrIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfU1VCOgoJICAgIGkzMl9iaW5hcnlPcCgiLSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX01VTDoKCSAgICBpMzJfYmluYXJ5RnVuYygiaTMyX211bCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0RJVl9TOgoJICAgIHZhciByaHMgPSBnZXRTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIHZhciBsaHMgPSBnZXRTdGFja1ZhcihUWVBFUy5JMzIsIDEpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIHJocyArICIgPT09IDApIHsgcmV0dXJuIHRyYXAoJ2kzMl9kaXZfcycpIH0iKTsKCSAgICBwdXNoTGluZSgiaWYgKCIgKyBsaHMgKyAiID09PSBJTlQzMl9NSU4gJiYgIiArIHJocyArICIgPT09IC0xKSB7IHJldHVybiB0cmFwKCdpMzJfZGl2X3MnKSB9Iik7CgkgICAgaTMyX2JpbmFyeU9wKCIvIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfRElWX1U6CgkgICAgdmFyIHJocyA9IGdldFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgdmFyIGxocyA9IGdldFN0YWNrVmFyKFRZUEVTLkkzMiwgMSk7CgkgICAgcHVzaExpbmUoImlmICgiICsgcmhzICsgIiA9PT0gMCkgeyByZXR1cm4gdHJhcCgnaTMyX2Rpdl91JykgfSIpOwoJICAgIGkzMl9iaW5hcnlPcCgiLyIsICI+Pj4wIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfUkVNX1M6CgkgICAgdmFyIHJocyA9IGdldFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgcHVzaExpbmUoImlmICgiICsgcmhzICsgIiA9PT0gMCkgeyByZXR1cm4gdHJhcCgnaTMyX3JlbV9zJykgfSIpOwoJICAgIGkzMl9iaW5hcnlPcCgiJSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1JFTV9VOgoJICAgIHZhciByaHMgPSBnZXRTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIC8vcHVzaExpbmUoImlmICgiICsgcmhzICsgIiA9PT0gMCkgeyByZXR1cm4gdHJhcCgnaTMyX3JlbV91JykgfSIpCgkgICAgaTMyX2JpbmFyeU9wKCIlIiwgIj4+PjAiKTsKCSAgICB2YXIgcmVzID0gZ2V0U3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBwdXNoTGluZShyZXMgKyAiID0gIiArIHJlcyArICJ8MCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX0FORDoKCSAgICBpMzJfYmluYXJ5T3AoIiYiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9PUjoKCSAgICBpMzJfYmluYXJ5T3AoInwiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9YT1I6CgkgICAgaTMyX2JpbmFyeU9wKCJeIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfU0hMOgoJICAgIGkzMl9iaW5hcnlPcCgiPDwiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9TSFJfUzoKCSAgICBpMzJfYmluYXJ5T3AoIj4+Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfU0hSX1U6CgkgICAgaTMyX2JpbmFyeU9wKCI+Pj4iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9ST1RMOgoJICAgIGkzMl9iaW5hcnlGdW5jKCJpMzJfcm90bCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1JPVFI6CgkgICAgaTMyX2JpbmFyeUZ1bmMoImkzMl9yb3RyIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfQ0xaOgoJICAgIGk2NF91bmFyeUZ1bmMoImk2NF9jbHoiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9DVFo6CgkgICAgaTY0X3VuYXJ5RnVuYygiaTY0X2N0eiIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1BPUENOVDoKCSAgICBpNjRfdW5hcnlGdW5jKCJpNjRfcG9wY250Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfQUREOgoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfYWRkIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfU1VCOgoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfc3ViIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfTVVMOgoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfbXVsIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfRElWX1M6CgkgICAgdmFyIHJocyA9IGdldFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgdmFyIGxocyA9IGdldFN0YWNrVmFyKFRZUEVTLkk2NCwgMSk7CgkgICAgcHVzaExpbmUoImlmICgiICsgcmhzICsgIi5pc1plcm8oKSkgeyByZXR1cm4gdHJhcCgnaTY0X2Rpdl9zJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIGxocyArICIuZXEoTG9uZy5NSU5fVkFMVUUpICYmICIgKyByaHMgKyAiLmVxKExvbmcuTkVHX09ORSkpIHsgcmV0dXJuIHRyYXAoJ2k2NF9kaXZfcycpIH0iKTsKCSAgICBpNjRfYmluYXJ5RnVuYygiaTY0X2Rpdl9zIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfRElWX1U6CgkgICAgdmFyIHJocyA9IGdldFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgcHVzaExpbmUoImlmICgiICsgcmhzICsgIi5pc1plcm8oKSkgeyByZXR1cm4gdHJhcCgnaTY0X2Rpdl91JykgfSIpOwoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfZGl2X3UiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9SRU1fUzoKCSAgICB2YXIgcmhzID0gZ2V0U3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICBwdXNoTGluZSgiaWYgKCIgKyByaHMgKyAiLmlzWmVybygpKSB7IHJldHVybiB0cmFwKCdpNjRfcmVtX3MnKSB9Iik7CgkgICAgaTY0X2JpbmFyeUZ1bmMoImk2NF9yZW1fcyIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1JFTV9VOgoJICAgIHZhciByaHMgPSBnZXRTdGFja1ZhcihUWVBFUy5JNjQpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIHJocyArICIuaXNaZXJvKCkpIHsgcmV0dXJuIHRyYXAoJ2k2NF9yZW1fdScpIH0iKTsKCSAgICBpNjRfYmluYXJ5RnVuYygiaTY0X3JlbV91Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfQU5EOgoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfYW5kIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfT1I6CgkgICAgaTY0X2JpbmFyeUZ1bmMoImk2NF9vciIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1hPUjoKCSAgICBpNjRfYmluYXJ5RnVuYygiaTY0X3hvciIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1NITDoKCSAgICBpNjRfYmluYXJ5RnVuYygiaTY0X3NobCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1NIUl9TOgoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfc2hyX3MiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9TSFJfVToKCSAgICBpNjRfYmluYXJ5RnVuYygiaTY0X3Nocl91Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfUk9UTDoKCSAgICBpNjRfYmluYXJ5RnVuYygiaTY0X3JvdGwiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9ST1RSOgoJICAgIGk2NF9iaW5hcnlGdW5jKCJpNjRfcm90ciIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0FCUzoKCSAgICBmMzJfdW5hcnlPcCgiZjMyX2FicyIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX05FRzoKCSAgICBmMzJfdW5hcnlPcCgiZjMyX25lZyIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0NFSUw6CgkgICAgZjMyX3VuYXJ5T3AoImYzMl9jZWlsIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfRkxPT1I6CgkgICAgZjMyX3VuYXJ5T3AoImYzMl9mbG9vciIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX1RSVU5DOgoJICAgIGYzMl91bmFyeU9wKCJmMzJfdHJ1bmMiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkYzMl9ORUFSRVNUOgoJICAgIGYzMl91bmFyeU9wKCJmMzJfbmVhcmVzdCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX1NRUlQ6CgkgICAgZjMyX3VuYXJ5T3AoImYzMl9zcXJ0Iik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfQUREOgoJICAgIGYzMl9iaW5hcnlPcCgiKyIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX1NVQjoKCSAgICBmMzJfYmluYXJ5T3AoIi0iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkYzMl9NVUw6CgkgICAgZjMyX2JpbmFyeU9wKCIqIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfRElWOgoJICAgIGYzMl9iaW5hcnlPcCgiLyIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX01JTjoKCSAgICBmMzJfYmluYXJ5RnVuYygiZjMyX21pbiIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX01BWDoKCSAgICBmMzJfYmluYXJ5RnVuYygiZjMyX21heCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0NPUFlTSUdOOgoJICAgIGYzMl9iaW5hcnlGdW5jKCJmMzJfY29weXNpZ24iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9BQlM6CgkgICAgZjY0X3VuYXJ5T3AoImY2NF9hYnMiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9ORUc6CgkgICAgZjY0X3VuYXJ5T3AoImY2NF9uZWciKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9DRUlMOgoJICAgIGY2NF91bmFyeU9wKCJmNjRfY2VpbCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0ZMT09SOgoJICAgIGY2NF91bmFyeU9wKCJmNjRfZmxvb3IiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9UUlVOQzoKCSAgICBmNjRfdW5hcnlPcCgiZjY0X3RydW5jIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GNjRfTkVBUkVTVDoKCSAgICBmNjRfdW5hcnlPcCgiZjY0X25lYXJlc3QiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9TUVJUOgoJICAgIGY2NF91bmFyeU9wKCJmNjRfc3FydCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0FERDoKCSAgICBmNjRfYmluYXJ5T3AoIisiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9TVUI6CgkgICAgZjY0X2JpbmFyeU9wKCItIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GNjRfTVVMOgoJICAgIGY2NF9iaW5hcnlPcCgiKiIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0RJVjoKCSAgICBmNjRfYmluYXJ5T3AoIi8iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9NSU46CgkgICAgZjY0X2JpbmFyeUZ1bmMoImY2NF9taW4iKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9NQVg6CgkgICAgZjY0X2JpbmFyeUZ1bmMoImY2NF9tYXgiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9DT1BZU0lHTjoKCSAgICBmNjRfYmluYXJ5RnVuYygiZjY0X2NvcHlzaWduIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JMzJfV1JBUF9JNjQ6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5JNjQpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gIiArIG9wZXJhbmQgKyAiLmxvdyIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1RSVU5DX1NfRjMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPiBJTlQzMl9NQVgpIHsgcmV0dXJuIHRyYXAoJ2kzMl90cnVuY19zJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIG9wZXJhbmQgKyAiIDwgSU5UMzJfTUlOKSB7IHJldHVybiB0cmFwKCdpMzJfdHJ1bmNfcycpIH0iKTsKCSAgICBwdXNoTGluZSgiaWYgKGlzTmFOKCIgKyBvcGVyYW5kICsgIikpIHsgcmV0dXJuIHRyYXAoKSB9Iik7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9ICgiICsgb3BlcmFuZCArICIpfDAiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkkzMl9UUlVOQ19TX0Y2NDoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkY2NCk7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIG9wZXJhbmQgKyAiID4gSU5UMzJfTUFYKSB7IHJldHVybiB0cmFwKCdpMzJfdHJ1bmNfcycpIH0iKTsKCSAgICBwdXNoTGluZSgiaWYgKCIgKyBvcGVyYW5kICsgIiA8IElOVDMyX01JTikgeyByZXR1cm4gdHJhcCgnaTMyX3RydW5jX3MnKSB9Iik7CgkgICAgcHVzaExpbmUoImlmIChpc05hTigiICsgb3BlcmFuZCArICIpKSB7IHJldHVybiB0cmFwKCdpMzJfdHJ1bmNfcycpIH0iKTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gKCIgKyBvcGVyYW5kICsgIil8MCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1RSVU5DX1VfRjMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPiBVSU5UMzJfTUFYKSB7IHJldHVybiB0cmFwKCdpMzJfdHJ1bmMnKSB9Iik7CgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPD0gLTEpIHsgcmV0dXJuIHRyYXAoJ2kzMl90cnVuYycpIH0iKTsKCSAgICBwdXNoTGluZSgiaWYgKGlzTmFOKCIgKyBvcGVyYW5kICsgIikpIHsgcmV0dXJuIHRyYXAoJ2kzMl90cnVuYycpIH0iKTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gKCgiICsgb3BlcmFuZCArICIpPj4+MCl8MCIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1RSVU5DX1VfRjY0OgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuRjY0KTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPiBVSU5UMzJfTUFYKSB7IHJldHVybiB0cmFwKCdpMzJfdHJ1bmMnKSB9Iik7CgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPD0gLTEpIHsgcmV0dXJuIHRyYXAoJ2kzMl90cnVuYycpIH0iKTsKCSAgICBwdXNoTGluZSgiaWYgKGlzTmFOKCIgKyBvcGVyYW5kICsgIikpIHsgcmV0dXJuIHRyYXAoJ2kzMl90cnVuYycpIH0iKTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gKCIgKyBvcGVyYW5kICsgIik+Pj4wIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfRVhURU5EX1NfSTMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9IExvbmcuZnJvbU51bWJlcigiICsgb3BlcmFuZCArICIpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfRVhURU5EX1VfSTMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9IExvbmcuZnJvbU51bWJlcigiICsgb3BlcmFuZCArICI+Pj4wLCB0cnVlKS50b1NpZ25lZCgpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfVFJVTkNfU19GMzI6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5GMzIpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICAvLyBYWFggVE9ETzogSSBhY3R1YWxseSBkb24ndCB1bmRlcnN0YW5kIGZsb2F0aW5nLXBvaW50IG11Y2ggYXQgYWxsLAoJICAgIC8vICAgICAgICAgICByaWdodCBub3cgYW0ganVzdCBoYWNraW5nIHRoZSB0ZXN0cyBpbnRvIHBhc3NpbmcuLi4KCSAgICBwdXNoTGluZSgiaWYgKCIgKyBvcGVyYW5kICsgIiA+PSA5LjIyMzM3MjAzNjg1ZSsxOCkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIG9wZXJhbmQgKyAiIDw9IC05LjIyMzM3MzEzNjM2ZSsxOCkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoaXNOYU4oIiArIG9wZXJhbmQgKyAiKSkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBMb25nLmZyb21OdW1iZXIoIiArIG9wZXJhbmQgKyAiKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1RSVU5DX1NfRjY0OgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuRjY0KTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgLy8gWFhYIFRPRE86IEkgYWN0dWFsbHkgZG9uJ3QgdW5kZXJzdGFuZCBmbG9hdGluZy1wb2ludCBtdWNoIGF0IGFsbCwKCSAgICAvLyAgICAgICAgICAgcmlnaHQgbm93IGFtIGp1c3QgaGFja2luZyB0aGUgdGVzdHMgaW50byBwYXNzaW5nLi4uCgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPj0gOTIyMzM3MjAzNjg1NDc3NTgwOC4wKSB7IHJldHVybiB0cmFwKCdpNjQtdHJ1bmMnKSB9Iik7CgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPD0gLTkyMjMzNzIwMzY4NTQ3Nzc4NTYuMCkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoaXNOYU4oIiArIG9wZXJhbmQgKyAiKSkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBMb25nLmZyb21OdW1iZXIoIiArIG9wZXJhbmQgKyAiKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTY0X1RSVU5DX1VfRjMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgLy8gWFhYIFRPRE86IEkgYWN0dWFsbHkgZG9uJ3QgdW5kZXJzdGFuZCBmbG9hdGluZy1wb2ludCBtdWNoIGF0IGFsbCwKCSAgICAvLyAgICAgICAgICAgcmlnaHQgbm93IGFtIGp1c3QgaGFja2luZyB0aGUgdGVzdHMgaW50byBwYXNzaW5nLi4uCgkgICAgcHVzaExpbmUoImlmICgiICsgb3BlcmFuZCArICIgPj0gMS44NDQ2NzQ0MDczN2UrMTkpIHsgcmV0dXJuIHRyYXAoJ2k2NC10cnVuYycpIH0iKTsKCSAgICBwdXNoTGluZSgiaWYgKCIgKyBvcGVyYW5kICsgIiA8PSAtMSkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoaXNOYU4oIiArIG9wZXJhbmQgKyAiKSkgeyByZXR1cm4gdHJhcCgnaTY0LXRydW5jJykgfSIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBMb25nLmZyb21OdW1iZXIoIiArIG9wZXJhbmQgKyAiLCB0cnVlKS50b1NpZ25lZCgpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5JNjRfVFJVTkNfVV9GNjQ6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5GNjQpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICAvLyBYWFggVE9ETzogSSBhY3R1YWxseSBkb24ndCB1bmRlcnN0YW5kIGZsb2F0aW5nLXBvaW50IG11Y2ggYXQgYWxsLAoJICAgIC8vICAgICAgICAgICByaWdodCBub3cgYW0ganVzdCBoYWNraW5nIHRoZSB0ZXN0cyBpbnRvIHBhc3NpbmcuLi4KCSAgICBwdXNoTGluZSgiaWYgKCIgKyBvcGVyYW5kICsgIiA+PSAxODQ0Njc0NDA3MzcwOTU1MTYxNi4wKSB7IHJldHVybiB0cmFwKCd0b28gYmlnJykgfSIpOwoJICAgIHB1c2hMaW5lKCJpZiAoIiArIG9wZXJhbmQgKyAiIDw9IC0xKSB7IHJldHVybiB0cmFwKCd0b28gc21hbGwnKSB9Iik7CgkgICAgcHVzaExpbmUoImlmIChpc05hTigiICsgb3BlcmFuZCArICIpKSB7IHJldHVybiB0cmFwKCdOYU4nKSB9Iik7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9IExvbmcuZnJvbU51bWJlcihmNjRfdHJ1bmMoIiArIG9wZXJhbmQgKyAiKSwgdHJ1ZSkudG9TaWduZWQoKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0NPTlZFUlRfU19JMzI6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gVG9GMzIoIiArIG9wZXJhbmQgKyAifDApIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfQ09OVkVSVF9VX0kzMjoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5GMzIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBUb0YzMigiICsgb3BlcmFuZCArICI+Pj4wKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjMyX0NPTlZFUlRfU19JNjQ6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5JNjQpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gVG9GMzIoIiArIG9wZXJhbmQgKyAiLnRvTnVtYmVyKCkpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfQ09OVkVSVF9VX0k2NDoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5GMzIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBUb0YzMigiICsgb3BlcmFuZCArICIudG9VbnNpZ25lZCgpLnRvTnVtYmVyKCkpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfREVNT1RFX0Y2NDoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkY2NCk7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5GMzIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBUb0YzMigiICsgb3BlcmFuZCArICIpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GNjRfQ09OVkVSVF9TX0kzMjoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkkzMik7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5GNjQpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSArKCIgKyBvcGVyYW5kICsgInwwKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0NPTlZFUlRfVV9JMzI6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjY0KTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gKygiICsgb3BlcmFuZCArICI+Pj4wKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X0NPTlZFUlRfU19JNjQ6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5JNjQpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuRjY0KTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gKygiICsgb3BlcmFuZCArICIudG9OdW1iZXIoKSkiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkY2NF9DT05WRVJUX1VfSTY0OgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkY2NCk7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9ICsoIiArIG9wZXJhbmQgKyAiLnRvVW5zaWduZWQoKS50b051bWJlcigpKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X1BST01PVEVfRjMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuRjMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkY2NCk7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9ICsoIiArIG9wZXJhbmQgKyAiKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuSTMyX1JFSU5URVJQUkVUX0YzMjoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkYzMik7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5JMzIpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBpMzJfcmVpbnRlcnByZXRfZjMyKCIgKyBvcGVyYW5kICsgIikiKTsKCSAgICBicmVhawoKCSAgY2FzZSBPUENPREVTLkk2NF9SRUlOVEVSUFJFVF9GNjQ6CgkgICAgdmFyIG9wZXJhbmQgPSBwb3BTdGFja1ZhcihUWVBFUy5GNjQpOwoJICAgIHZhciBvdXRwdXQgPSBwdXNoU3RhY2tWYXIoVFlQRVMuSTY0KTsKCSAgICBwdXNoTGluZShvdXRwdXQgKyAiID0gaTY0X3JlaW50ZXJwcmV0X2Y2NCgiICsgb3BlcmFuZCArICIpIik7CgkgICAgYnJlYWsKCgkgIGNhc2UgT1BDT0RFUy5GMzJfUkVJTlRFUlBSRVRfSTMyOgoJICAgIHZhciBvcGVyYW5kID0gcG9wU3RhY2tWYXIoVFlQRVMuSTMyKTsKCSAgICB2YXIgb3V0cHV0ID0gcHVzaFN0YWNrVmFyKFRZUEVTLkYzMik7CgkgICAgcHVzaExpbmUob3V0cHV0ICsgIiA9IGYzMl9yZWludGVycHJldF9pMzIoIiArIG9wZXJhbmQgKyAiKSIpOwoJICAgIGJyZWFrCgoJICBjYXNlIE9QQ09ERVMuRjY0X1JFSU5URVJQUkVUX0k2NDoKCSAgICB2YXIgb3BlcmFuZCA9IHBvcFN0YWNrVmFyKFRZUEVTLkk2NCk7CgkgICAgdmFyIG91dHB1dCA9IHB1c2hTdGFja1ZhcihUWVBFUy5GNjQpOwoJICAgIHB1c2hMaW5lKG91dHB1dCArICIgPSBmNjRfcmVpbnRlcnByZXRfaTY0KCIgKyBvcGVyYW5kICsgIikiKTsKCSAgICBicmVhawoKCSAgZGVmYXVsdDoKCSAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuc3VwcG9ydGVkIG9wY29kZTogMHgiICsgb3AudG9TdHJpbmcoMTYpKQoJfQogICAgICB9CgogICAgICByZXR1cm4gYwogICAgfQogIH0KCiAgZnVuY3Rpb24gcGFyc2VEYXRhU2VjdGlvbigpIHsKICAgIHZhciBjb3VudCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIHZhciBlbnRyaWVzID0gW107CiAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAgICAgIGVudHJpZXMucHVzaChwYXJzZURhdGFTZWdtZW50KCkpOwogICAgICBjb3VudC0tOwogICAgfQogICAgcmV0dXJuIGVudHJpZXMKICB9CgogIGZ1bmN0aW9uIHBhcnNlRGF0YVNlZ21lbnQoKSB7CiAgICB2YXIgZCA9IHt9OwogICAgZC5pbmRleCA9IHMucmVhZF92YXJ1aW50MzIoKTsKICAgIGlmIChkLmluZGV4ICE9PSAwKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgiTVZQIHJlcXVpcmVzIGRhdGEgaW5kZXggYmUgemVybyIpCiAgICB9CiAgICAvLyBDaGVjayB0aGF0IGl0J3MgYSB2YWxpZCBtZW1vcnkgcmVmZXJlbmNlLgogICAgZ2V0TWVtb3J5VHlwZShkLmluZGV4KTsKICAgIGQub2Zmc2V0ID0gcGFyc2VJbml0RXhwcihUWVBFUy5JMzIpOwogICAgdmFyIHNpemUgPSBzLnJlYWRfdmFydWludDMyKCk7CiAgICBkLmRhdGEgPSBzLnJlYWRfYnl0ZXMoc2l6ZSk7CiAgICByZXR1cm4gZAogIH0KCn0KCgovLwovLyBBIGxpdHRsZSBoZWxwZXIgb2JqZWN0IGZvciByZWFkaW5nIHByaW1pdGl2ZSB2YWx1ZXMKLy8gb3V0IG9mIHRoZSBieXRlc3RyZWFtLiAgT25lIGRheSB3ZSBtaWdodCByZWZhY3RvciB0aGlzCi8vIHRvIHN1cHBvcnQgZS5nLiBwcm9wZXIgc3RyZWFtaW5nIHJlYWRzLCBidXQgZm9yIG5vdwovLyBpdCdzIGp1c3QgYSBuaWNlIGFic3RyYWN0aW9uLgovLwoKZnVuY3Rpb24gUGFyc2VTdHJlYW0oYnl0ZXMpIHsKICB0aGlzLmJ5dGVzID0gYnl0ZXM7CiAgdGhpcy5pZHggPSAwOwp9CgpQYXJzZVN0cmVhbS5wcm90b3R5cGUuaGFzX21vcmVfYnl0ZXMgPSBmdW5jdGlvbiBoYXNfbW9yZV9ieXRlcygpIHsKICByZXR1cm4gKHRoaXMuaWR4IDwgdGhpcy5ieXRlcy5sZW5ndGgpCn07CgpQYXJzZVN0cmVhbS5wcm90b3R5cGUuc2tpcF90byA9IGZ1bmN0aW9uIHNraXBfdG8oaWR4KSB7CiAgaWYgKHRoaXMuaWR4ID4gaWR4KSB7CiAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInJlYWQgcGFzdCBlbmQgb2Ygc2VjdGlvbiIpCiAgfQogIGlmIChpZHggPiB0aGlzLmJ5dGVzLmxlbmd0aCkgewogICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ1bmVwZWN0ZWQgZW5kIG9mIGJ5dGVzIikKICB9CiAgdGhpcy5pZHggPSBpZHg7Cn07CgpQYXJzZVN0cmVhbS5wcm90b3R5cGUucmVhZF9ieXRlID0gZnVuY3Rpb24gcmVhZF9ieXRlKCkgewogIHZhciBiID0gdGhpcy5ieXRlc1t0aGlzLmlkeCsrXTsKICBpZiAodHlwZW9mIGIgPT09ICd1bmRlZmluZWQnKSB7CiAgICB0aHJvdyBuZXcgQ29tcGlsZUVycm9yJDEoInVuZXBlY3RlZCBlbmQgb2YgYnl0ZXMiKQogIH0KICByZXR1cm4gYgp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfYnl0ZXMgPSBmdW5jdGlvbiByZWFkX2J5dGVzKGNvdW50KSB7CiAgdmFyIG91dHB1dCA9IFtdOwogIHdoaWxlIChjb3VudCA+IDApIHsKICAgIG91dHB1dC5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUodGhpcy5yZWFkX2J5dGUoKSkpOwogICAgY291bnQtLTsKICB9CiAgcmV0dXJuIG91dHB1dC5qb2luKCIiKQp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfdWludDggPSBmdW5jdGlvbiByZWFkX3VpbnQ4KCkgewogIHJldHVybiB0aGlzLnJlYWRfYnl0ZSgpCn07CgpQYXJzZVN0cmVhbS5wcm90b3R5cGUucmVhZF91aW50MTYgPSBmdW5jdGlvbiByZWFkX3VpbnQxNigpIHsKICByZXR1cm4gKHRoaXMucmVhZF9ieXRlKCkpIHwKCSAodGhpcy5yZWFkX2J5dGUoKSA8PCA4KQp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfdWludDMyID0gZnVuY3Rpb24gcmVhZF91aW50MzIoKSB7CiAgcmV0dXJuICh0aGlzLnJlYWRfYnl0ZSgpKSB8CgkgKHRoaXMucmVhZF9ieXRlKCkgPDwgOCkgfAoJICh0aGlzLnJlYWRfYnl0ZSgpIDw8IDE2KSB8CgkgKHRoaXMucmVhZF9ieXRlKCkgPDwgMjQpCn07CgpQYXJzZVN0cmVhbS5wcm90b3R5cGUucmVhZF92YXJ1aW50MSA9IGZ1bmN0aW9uIHJlYWRfdmFydWludDEoKSB7CiAgdmFyIHYgPSB0aGlzLnJlYWRfdmFydWludDMyKCk7CiAgLy8gMS1iaXQgaW50LCBubyBiaXRzIG90aGVyIHRoYW4gdGhlIHZlcnkgbGFzdCBzaG91bGQgYmUgc2V0LgogIGlmICh2ICYgMHhGRkZGRkZGRSkgewogICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ2YXJ1aW50MSB0b28gbGFyZ2UiKQogIH0KICByZXR1cm4gdgp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfdmFydWludDcgPSBmdW5jdGlvbiByZWFkX3ZhcnVpbnQ3KCkgewogIHZhciB2ID0gdGhpcy5yZWFkX3ZhcnVpbnQzMigpOwogIC8vIDctYml0IGludCwgbm9uZSBvZiB0aGUgaGlnaGVyIGJpdHMgc2hvdWxkIGJlIHNldC4KICBpZiAodiAmIDB4RkZGRkZGODApIHsKICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidmFydWludDcgdG9vIGxhcmdlIikKICB9CiAgcmV0dXJuIHYKfTsKClBhcnNlU3RyZWFtLnByb3RvdHlwZS5yZWFkX3ZhcnVpbnQzMiA9IGZ1bmN0aW9uIHJlYWRfdmFydWludDMyKCkgewogIHZhciBiID0gMDsKICB2YXIgcmVzdWx0ID0gMDsKICB2YXIgc2hpZnQgPSAwOwogIGRvIHsKICAgIGlmIChzaGlmdCA+IDMyKSB7CiAgICAgIHRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidmFydWludDMyIHRvbyBsYXJnZSIpCiAgICB9CiAgICBiID0gdGhpcy5yZWFkX2J5dGUoKTsKICAgIHJlc3VsdCA9ICgoYiAmIDB4N0YpIDw8IHNoaWZ0KSB8IHJlc3VsdDsKICAgIHNoaWZ0ICs9IDc7CiAgfSB3aGlsZSAoYiAmIDB4ODApCiAgcmV0dXJuIHJlc3VsdCA+Pj4gMAp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfdmFyaW50NyA9IGZ1bmN0aW9uIHJlYWRfdmFyaW50NygpIHsKICB2YXIgdiA9IHRoaXMucmVhZF92YXJpbnQzMigpOwogIGlmICh2ID4gNjMgfHwgdiA8IC02NCkgewogICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ2YXJpbnQ3IHRvbyBsYXJnZSIpCiAgfQogIHJldHVybiB2Cn07CgpQYXJzZVN0cmVhbS5wcm90b3R5cGUucmVhZF92YXJpbnQzMiA9IGZ1bmN0aW9uIHJlYWRfdmFyaW50MzIoKSB7CiAgdmFyIGIgPSAwOwogIHZhciByZXN1bHQgPSAwOwogIHZhciBzaGlmdCA9IDA7CiAgZG8gewogICAgaWYgKHNoaWZ0ID4gMzIpIHsKICAgICAgdGhyb3cgbmV3IENvbXBpbGVFcnJvciQxKCJ2YXJ1aW50MzIgdG9vIGxhcmdlIikKICAgIH0KICAgIGIgPSB0aGlzLnJlYWRfYnl0ZSgpOwogICAgcmVzdWx0ID0gKChiICYgMHg3RikgPDwgc2hpZnQpIHwgcmVzdWx0OwogICAgc2hpZnQgKz0gNzsKICB9IHdoaWxlIChiICYgMHg4MCkKICBpZiAoYiAmIDB4NDAgJiYgc2hpZnQgPCAzMikgewogICAgcmVzdWx0ID0gKC0xIDw8IHNoaWZ0KSB8IHJlc3VsdDsKICB9CiAgcmV0dXJuIHJlc3VsdAp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfdmFyaW50NjQgPSBmdW5jdGlvbiByZWFkX3ZhcmludDY0KCkgewogIC8vIFRoaXMgaXMgYSBsaXR0bGUgZmlkZGx5LCB3ZSBoYXZlIHRvIHNwbGl0IHRoZSBsb29wIGludG8KICAvLyB0d28gaGFsdmVzIHNvIHdlIGNhbiByZWFkIHRoZSBsb3cgYW5kIGhpZ2ggcGFydHMgaW50bwogIC8vIHR3byBzZXBhcmF0ZSAzMi1iaXQgaW50ZWdlcnMuCiAgdmFyIGIgPSAwOwogIHZhciBsb3cgPSAwOwogIHZhciBoaWdoID0gMDsKICB2YXIgc2hpZnQgPSAwOwogIC8vIFJlYWQgdGhlIGxvdyBiaXRzIGZpcnN0LgogIC8vIElmIHRoZSBsb3cgYml0cyBhcmUgZnVsbCwgdGhpcyB3aWxsIGFsc28gcmVhZHkgdGhlIGZpcnN0IGZldyBoaWdoIGJpdHMuCiAgZG8gewogICAgaWYgKHNoaWZ0ID4gMzIpIHsKICAgICAgYnJlYWsKICAgIH0KICAgIGIgPSB0aGlzLnJlYWRfYnl0ZSgpOwogICAgbG93ID0gKChiICYgMHg3RikgPDwgc2hpZnQpIHwgbG93OwogICAgc2hpZnQgKz0gNzsKICB9IHdoaWxlIChiICYgMHg4MCkKICAvLyBEaWQgd2UgcmVhZCB0aGUgZnVsbCAzMiBsb3cgYml0cz8KICBpZiAoc2hpZnQgPCAzMikgewogICAgLy8gTm9wZS4gIE5lZWQgdG8gc2lnbi1leHRlbmQgaW50byBib3RoIGxvdyBhbmQgaGlnaC4KICAgIGlmIChiICYgMHg0MCkgewogICAgICBsb3cgPSAoLTEgPDwgc2hpZnQpIHwgbG93OwogICAgICBoaWdoID0gLTE7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8vIFllcC4gVGhlIGZpcnN0IDMgaGlnaCBiaXRzIHdpbGwgYmUgaW4gdGhlIGFscmVhZHktcmVhZCBieXRlLgogICAgc2hpZnQgPSAzOwogICAgdmFyIGhpZ2ggPSAoYiAmIDB4N0YpID4+IDQ7CiAgICB3aGlsZSAoYiAmIDB4ODApIHsKICAgICAgaWYgKHNoaWZ0ID4gMzIpIHsKCXRocm93IG5ldyBDb21waWxlRXJyb3IkMSgidmFydWludDY0IHRvbyBsYXJnZSIpCiAgICAgIH0KICAgICAgYiA9IHRoaXMucmVhZF9ieXRlKCk7CiAgICAgIGhpZ2ggPSAoKGIgJiAweDdGKSA8PCBzaGlmdCkgfCBoaWdoOwogICAgICBzaGlmdCArPSA3OwogICAgfQogICAgLy8gU2lnbi1leHRlbmQgaW50byB0aGUgaGlnaCBiaXRzLgogICAgaWYgKGIgJiAweDQwICYmIHNoaWZ0IDwgMzIpIHsKICAgICAgaGlnaCA9ICgtMSA8PCBzaGlmdCkgfCBoaWdoOwogICAgfQogIH0gCiAgcmV0dXJuIG5ldyBsb25nXzEobG93LCBoaWdoKQp9OwoKUGFyc2VTdHJlYW0ucHJvdG90eXBlLnJlYWRfZmxvYXQzMiA9IGZ1bmN0aW9uIHJlYWRfZmxvYXQzMigpIHsKICB2YXIgZHYgPSBuZXcgRGF0YVZpZXcodGhpcy5ieXRlcy5idWZmZXIpOwogIHZhciB2ID0gZHYuZ2V0RmxvYXQzMih0aGlzLmlkeCwgdHJ1ZSk7CiAgLy8gWFhYIFRPRE86IGlzIGl0IHBvc3NpYmxlIHRvIHByZXNlcnZlIHRoZSBzaWduYWxsaW5nIGJpdCBvZiBhIE5hTj8KICAvLyBUaGV5IGRvbid0IHNlZW0gdG8gcm91bmQtdHJpcCBwcm9wZXJseS4gIEZvciBub3csIHdlIGJveCB0aGVtIHRvCiAgLy8gZW5zdXJlIHRoYXQgd2UgY2FuIHJlYWQgdGhlIHNpZ25hbGxpbmcgYml0IGJhY2sgbGF0ZXIuCiAgaWYgKGlzTmFOKHYpKSB7CiAgICBpZiAoISh0aGlzLmJ5dGVzW3RoaXMuaWR4KzJdICYgMHg0MCkpIHsKICAgICAgLy8gUmVtZWJtZXIgdGhhdCBpdCB3YXMgYSBzaWduYWxsaW5nIE5hTi4KICAgICAgLy8gVGhpcyBib3hpbmcgd2lsbCBiZSBsb3N0IHdoZW4geW91IG9wZXJhdGUgb24gaXQsIGJ1dAogICAgICAvLyB3ZSBjYW4gcHJlc2VydmUgaXQgZm9yIGxvbmcgZW5vdWdoIHRvIGdldCB0ZXN0cyB0byBwYXNzLgogICAgICB2ID0gbmV3IE51bWJlcih2KTsKICAgICAgdi5fc2lnbmFsbGluZyA9IHRydWU7CiAgICB9CiAgfQogIHRoaXMuaWR4ICs9IDQ7CiAgcmV0dXJuIHYKfTsKClBhcnNlU3RyZWFtLnByb3RvdHlwZS5yZWFkX2Zsb2F0NjQgPSBmdW5jdGlvbiByZWFkX2Zsb2F0NjQoKSB7CiAgdmFyIGR2ID0gbmV3IERhdGFWaWV3KHRoaXMuYnl0ZXMuYnVmZmVyKTsKICB2YXIgdiA9IGR2LmdldEZsb2F0NjQodGhpcy5pZHgsIHRydWUpOwogIHRoaXMuaWR4ICs9IDg7CiAgcmV0dXJuIHYKfTsKCi8vCi8vIFJlbmRlciBhIHBhcnNlZCBXQVNNIG1vZHVsZSBpbnRvIHJ1bm5hYmxlIEphdmFTY3JpcHQuCi8vCi8vIFRoaXMgbW9kdWxlIGlzIHRoZSBjb21wbGVtZW50IHRvIHBhcnNlci5qcy4gIEl0IHRha2VzIHRoZSBkYXRhIHN0cnVjdHVyZXMKLy8gcGFyc2VkIGJ5IHRoYXQgbW9kdWxlLCBhbmQgcmVuZGVycyB0aGVtIGludG8gYSBqYXZhc2NyaXB0IGZ1bmN0aW9uIHRoYXQKLy8gbG9va3Mgc29tZXRoaW5nIGxpa2UgdGhpczoKLy8KLy8gICAgZnVuY3Rpb24gKFdlYkFzc2VtYmx5LCBpbXBvcnRzLCBjb25zdGFudHMsIHN0ZGxpYikgewovLwovLyAgICAgIC8vIExvY2FsIHJlZmVyZW5jZXMgdG8gaGVscGVyIGZ1bmN0aW9ucwovLyAgICAgIGNvbnN0IExvbmcgPSBXZWJBc3NlbWJseS5fTG9uZwovLyAgICAgIGNvbnN0IGk2NF9lcSA9IHN0ZGxpYi5pNjRfZXEKLy8gICAgICAuLi5ldGMuLi4KLy8KLy8gICAgICAvLyBJbXBvcnRlZCBmdW5jdGlvbnMsIGdsb2JhbHMsIGV0Yy4KLy8gICAgICB2YXIgRjAgPSBpbXBvcnRzWzBdCi8vICAgICAgdmFyIEcwID0gaW1wb3J0c1sxXQovLyAgICAgIHZhciBGMSA9IGltcG9ydHNbMl0KLy8gICAgICAuLi5ldGMuLi4KLy8KLy8gICAgICAvLyBMb2NhbCBUYWJsZSBhbmQgTWVtb3J5IGRlZmluaXRpb25zLgovLyAgICAgIHZhciBUMCA9IG5ldyBXZWJBc3NlbWJseS5UYWJsZSh7IGluaXRpYWw6IDEwMjQgfSkKLy8gICAgICB2YXIgTTAgPSBuZXcgV2ViQXNzZW1ibHkuTWVtb3J5KHsgaW5pdGlhbDogMTAyNCwgbWF4aW11bTogMjA0OCB9KQovLwovLyAgICAgIC8vIExvY2FsIHZpZXdzIG9udG8gdGhlIG1lbW9yeSBBcnJheUJ1ZmZlcgovLyAgICAgIHZhciBtZW1vcnlTaXplID0gTTAuYnVmZmVyLmJ5dGVMZW5ndGgKLy8gICAgICB2YXIgSEk4ID0gbmV3IEludDhBcnJheShNMC5idWZmZXIpCi8vICAgICAgdmFyIEhJMTYgPSBuZXcgSW50MTZBcnJheShNMC5idWZmZXIpCi8vICAgICAgdmFyIEhJMzIgPSBuZXcgSW50MzJBcnJheShNMC5idWZmZXIpCi8vICAgICAgdmFyIEhVOCA9IG5ldyBVaW50OEFycmF5KE0wLmJ1ZmZlcikKLy8gICAgICB2YXIgSFUxNiA9IG5ldyBVaW50MTZBcnJheShNMC5idWZmZXIpCi8vICAgICAgdmFyIEhVMzIgPSBuZXcgVWludDMyQXJyYXkoTTAuYnVmZmVyKQovLyAgICAgIHZhciBIRjMyID0gbmV3IEZsb2F0MzJBcnJheShNMC5idWZmZXIpCi8vICAgICAgdmFyIEhGNjQgPSBuZXcgRmxvYXQ2NEFycmF5KE0wLmJ1ZmZlcikKLy8gICAgICB2YXIgSERWID0gbmV3IERhdGFWaWV3KE0wLmJ1ZmZlcikKLy8KLy8gICAgICAvLyBBIGNhbGxiYWNrIHRoYXQncyBleGVjdXRlZCBpZiB0aGUgbWVtb3J5IGNoYW5nZXMsCi8vICAgICAgLy8gc28gd2UgY2FuIHVwZGF0ZSBvdXIgbG9jYWwgdmlld3MuCi8vICAgICAgdmFyIG9uTWVtb3J5Q2hhbmdlID0gZnVuY3Rpb24oKSB7Ci8vICAgICAgICBtZW1vcnlTaXplID0gTTAuYnVmZmVyLmJ5dGVMZW5ndGgKLy8gICAgICAgIEhJOCA9IG5ldyBJbnQ4QXJyYXkoTTAuYnVmZmVyKQovLyAgICAgICAgSEkxNiA9IG5ldyBJbnQxNkFycmF5KE0wLmJ1ZmZlcikKLy8gICAgICAgIEhJMzIgPSBuZXcgSW50MzJBcnJheShNMC5idWZmZXIpCi8vICAgICAgICBIVTggPSBuZXcgVWludDhBcnJheShNMC5idWZmZXIpCi8vICAgICAgICBIVTE2ID0gbmV3IFVpbnQxNkFycmF5KE0wLmJ1ZmZlcikKLy8gICAgICAgIEhVMzIgPSBuZXcgVWludDMyQXJyYXkoTTAuYnVmZmVyKQovLyAgICAgICAgSEYzMiA9IG5ldyBGbG9hdDMyQXJyYXkoTTAuYnVmZmVyKQovLyAgICAgICAgSEY2NCA9IG5ldyBGbG9hdDY0QXJyYXkoTTAuYnVmZmVyKQovLyAgICAgICAgSERWID0gbmV3IERhdGFWaWV3KE0wLmJ1ZmZlcikKLy8gICAgICB9Ci8vICAgICAgTTAuX29uQ2hhbmdlKG9uTWVtb3J5Q2hhbmdlKQovLwovLyAgICAgIC8vIEdsb2JhbCB2YXJpYWJsZSBkZWZpbml0aW9ucy4KLy8gICAgICB2YXIgRzEgPSAzLjE0MTUKLy8gICAgICB2YXIgRzIgPSA0MgovLwovLyAgICAgIC8vIFRoZSBjb2RlIGZvciBlYWNoIGZ1bmN0aW9uIGRlZmluZWQgaW4gdGhlIG1vZHVsZS4KLy8gICAgICAvLyBUaGUgdXNlIGxvY2FsIHZhcmlhYmxlcyB0byBzaW11bGF0ZSB0aGUgV0FTTSBzdGFjaywKLy8gICAgICAvLyBhbmQgZnJhbmtseSBkb24ndCBkbyBhIHRlcnJpYmx5IGNsZXZlciBqb2Igb2YgaXQuCi8vICAgICAgZnVuY3Rpb24gRjIobGkwKSB7Ci8vICAgICAgICB2YXIgc2kwID0gMHwwCi8vICAgICAgICB2YXIgc2kxID0gMHwwCi8vICAgICAgICBzaTAgPSBsaTAKLy8gICAgICAgIHNpMSA9IGxpMAovLyAgICAgICAgc2kwID0gc2kwICsgc2kxCi8vICAgICAgICByZXR1cm4gc2kwCi8vICAgICAgfQovLyAgICAgIEYyLl93YXNtVHlwZVNpZ1N0ciA9ICdpLT5pJwovLyAgICAgIEYyLl93YXNKU1dyYXBwZXIgPSBudWxsCi8vCi8vICAgICAgLy8gSW5zZXJ0IGZ1bmN0aW9ucyBpbnRvIHRoZSB0YWJsZSwgd2l0aCBib3VuZHMtY2hlY2tpbmcuCi8vICAgICAgaWYgKCgwICsgMyAtIDEpID49IFQwLmxlbmd0aCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCd0YWJsZSBvdXQgb2YgYm91bmRzJykgfQovLyAgICAgIFRbMCArIDBdID0gRjAKLy8gICAgICBUWzAgKyAxXSA9IEYxCi8vICAgICAgVFswICsgMl0gPSBGMgovLwovLyAgICAgIC8vIEluaXRpYWxpemUgbWVtb3J5IGRhdGEsIHdpdGggYm91bmRzLWNoZWNraW5nLgovLyAgICAgIGlmICgoMzIgKyA1ICsgLSAxKSA+PSBNMC5idWZmZXIuYnl0ZUxlbmd0aCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdtZW1vcnkgb3V0IG9mIGJvdW5kcycpIH0KLy8gICAgICBISThbMzIgKyAwXSA9IDB4QUEKLy8gICAgICBISThbMzIgKyAxXSA9IDB4QkIKLy8gICAgICBISThbMzIgKyAyXSA9IDB4Q0MKLy8gICAgICBISThbMzIgKyAzXSA9IDB4REQKLy8gICAgICBISThbMzIgKyA0XSA9IDB4RkYKLy8KLy8gICAgICAvLyBSdW4gdGhlIGBzdGFydGAgZnVuY3Rpb24gaWYgb25lIGlzIGRlZmluZWQuCi8vICAgICAgRjEoKQovLwovLyAgICAgIC8vIFJldHVybiBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgZXhwb3J0ZWQgZnVuY3Rpb25zLgovLyAgICAgIHZhciBleHBvcnRzID0ge30KLy8gICAgICBleHBvcnRzWyd0aW1lcy10d28nXSA9IEYyCi8vICAgICAgcmV0dXJuIGV4cG9ydHMKLy8gICAgfQovLwovLyBZb3UgbWlnaHQgbm90aWNlIHRoYXQgdGhpcyBsb29rcyBhIGxpdHRsZSBsaWtlIGFzbS5qcywgYW5kIGl0IGlzLCBidXQgaXQncyBnb3QKLy8gc2V2ZXJhbCBkaWZmZXJlbmNlIGluIG9yZGVyIHRvIGFjY291bnQgZm9yIHRoZSBkaWZmZXJlbnQgc2VtYW50aWNzIG9mIFdBU00sCi8vIGluIHBhcnRpY3VsYXIgYXJvdW5kIGdyb3dhYmxlIG1lbW9yeS4gSXQgd291bGQgYmUgaW50ZXJlc3RpbmcgdG8gdHJ5IHRvIG1ha2UKLy8gdGhpcyBtb3JlIGFuZCBtb3JlIGxpa2UgYXNtLmpzIGluIGZ1dHVyZSwgZm9yIG9idmlvdXMgc3BlZWQgYmVuZWZpdHMuCi8vIAoKZnVuY3Rpb24gcmVuZGVyVG9KUyhzZWN0aW9ucywgY29uc3RhbnRzKSB7CgogIC8vZHVtcCgiXG5cbi0tLS0gUkVOREVSSU5HIENPREUgLS0tLVxuXG4iKQoKICAvLyBGb3Igbm93LCBmb3Igc2ltcGxpY2l0eSwgd2UganVzdCBidWlsZCB1cCB0aGUgc3RyaW5ncwogIC8vIGluIGFuIGFycmF5LiAgV2Ugc2hvdWxkIHByb2JhYmx5IHRvIHRyeSB3cml0ZSB0aGVtIHRvCiAgLy8gZS5nLiBhbiBBcnJheUJ1ZmZlciBvciBzb21ldGhpbmcgbW9yZSBjbGV2ZXIgaW4gZnV0dXJlLgogIHZhciBzcmMgPSBbXTsKICBmdW5jdGlvbiBwdXNoTGluZShsbikgewogICAgbG4uc3BsaXQoIlxuIikuZm9yRWFjaChmdW5jdGlvbihsbikgewogICAgICBzcmMucHVzaChsbi50cmltKCkgKyAiXG4iKTsKICAgIH0pOwogIH0KCiAgLypyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewoKICB2YXIgY2FsbGJhY2tOYW1lID0gIl9vbkZpbmlzaFJlbmRlcmluZ1dBU01Qb2x5ZmlsbF8iICsgbnVtQ2FsbGJhY2tzKysKICB3aW5kb3dbY2FsbGJhY2tOYW1lXSA9IGZ1bmN0aW9uKHJlc3VsdCkgewogICAgY29uc29sZS5sb2coImZ1bmN0aW9uIHJlc29sdmVkISIpCiAgICBkZWxldGUgd2luZG93W2NhbGxiYWNrTmFtZV0KICAgIHJlc29sdmUocmVzdWx0KQogIH0KCiAgcHVzaExpbmUoIndpbmRvdy4iICsgY2FsbGJhY2tOYW1lICsgIihmdW5jdGlvbihXZWJBc3NlbWJseSwgaW1wb3J0cywgY29uc3RhbnRzLCBzdGRsaWIpIHsiKSovCgogIC8vIEltcG9ydCBhbGwgdGhlIHRoaW5ncyBmcm9tIHRoZSBzdGRsaWIuCiAgcHVzaExpbmUoIlxuLy8gIFdlYkFzc2VtYmx5IHN0ZGxpYiBhbmQgaGVscGVyIGZ1bmN0aW9uc1xuIik7CgogIHB1c2hMaW5lKCJjb25zdCBMb25nID0gV2ViQXNzZW1ibHkuX0xvbmciKTsKICBPYmplY3Qua2V5cyhzdGRsaWIkMSkuZm9yRWFjaChmdW5jdGlvbihrZXkpIHsKICAgIHB1c2hMaW5lKCJjb25zdCAiICsga2V5ICsgIiA9IHN0ZGxpYi4iICsga2V5KTsKICB9KTsKCiAgLy8gUHVsbCBpbiB2YXJpb3VzIGltcG9ydHMuCgogIHZhciBpbXBvcnRzID0gc2VjdGlvbnNbU0VDVElPTlMuSU1QT1JUXSB8fCBbXTsKICBpZiAoaW1wb3J0cy5sZW5ndGggPiAwKSB7CiAgICBwdXNoTGluZSgiXG4vLyAgSW1wb3J0c1xuIik7CiAgfQoKICB2YXIgY291bnRGdW5jcyA9IDA7CiAgdmFyIGNvdW50R2xvYmFscyA9IDA7CiAgdmFyIGNvdW50VGFibGVzID0gMDsKICB2YXIgY291bnRNZW1vcmllcyA9IDA7CiAgaW1wb3J0cy5mb3JFYWNoKGZ1bmN0aW9uKGksIGlkeCkgewogICAgc3dpdGNoIChpLmtpbmQpIHsKICAgICAgY2FzZSBFWFRFUk5BTF9LSU5EUy5GVU5DVElPTjoKCXB1c2hMaW5lKCJ2YXIgRiIgKyBjb3VudEZ1bmNzICsgIiA9IGltcG9ydHNbIiArIGlkeCArICJdIik7Cgljb3VudEZ1bmNzKys7CglicmVhawogICAgICBjYXNlIEVYVEVSTkFMX0tJTkRTLkdMT0JBTDoKCXB1c2hMaW5lKCJ2YXIgRyIgKyBjb3VudEdsb2JhbHMgKyAiID0gaW1wb3J0c1siICsgaWR4ICsgIl0iKTsKCWNvdW50R2xvYmFscysrOwoJYnJlYWsKICAgICAgY2FzZSBFWFRFUk5BTF9LSU5EUy5UQUJMRToKCXB1c2hMaW5lKCJ2YXIgVCIgKyBjb3VudFRhYmxlcyArICIgPSBpbXBvcnRzWyIgKyBpZHggKyAiXSIpOwoJY291bnRUYWJsZXMrKzsKCWJyZWFrCiAgICAgIGNhc2UgRVhURVJOQUxfS0lORFMuTUVNT1JZOgoJcHVzaExpbmUoInZhciBNIiArIGNvdW50TWVtb3JpZXMgKyAiID0gaW1wb3J0c1siICsgaWR4ICsgIl0iKTsKCWNvdW50TWVtb3JpZXMrKzsKCWJyZWFrCiAgICAgIGRlZmF1bHQ6Cgl0aHJvdyBuZXcgQ29tcGlsZUVycm9yKCJjYW5ub3QgcmVuZGVyIGltcG9ydCBraW5kOiAiICsgaS5raW5kKQogICAgfQogIH0pOwoKICAvLyBDcmVhdGUgcmVxdWVzdGVkIHRhYmxlcy4KCiAgdmFyIHRhYmxlcyA9IHNlY3Rpb25zW1NFQ1RJT05TLlRBQkxFXSB8fCBbXTsKICBpZiAodGFibGVzLmxlbmd0aCA+IDApIHsKICAgIHB1c2hMaW5lKCJcbi8vICBMb2NhbCB0YWJsZSBkZWZpbml0aW9uc1xuIik7CiAgfQogIHRhYmxlcy5mb3JFYWNoKGZ1bmN0aW9uKHQsIGlkeCkgewogICAgcHVzaExpbmUoInZhciBUIiArIChpZHggKyBjb3VudFRhYmxlcykgKyAiID0gbmV3IFdlYkFzc2VtYmx5LlRhYmxlKCIgKyBKU09OLnN0cmluZ2lmeSh0LmxpbWl0cykgKyAiKSIpOwogIH0pOwoKICAvLyBDcmVhdGUgcmVxdWVzdGVkIG1lbW9yeSwgYW5kIHByb3ZpZGUgdmlld3MgaW50byBpdC4KCiAgdmFyIG1lbW9yaWVzID0gc2VjdGlvbnNbU0VDVElPTlMuTUVNT1JZXSB8fCBbXTsKICBpZiAobWVtb3JpZXMubGVuZ3RoID4gMCkgewogICAgcHVzaExpbmUoIlxuLy8gIExvY2FsIG1lbW9yeSBkZWZpbml0aW9uc1xuIik7CiAgfQogIG1lbW9yaWVzLmZvckVhY2goZnVuY3Rpb24obSwgaWR4KSB7CiAgICBwdXNoTGluZSgidmFyIE0iICsgaWR4ICsgIiA9IG5ldyBXZWJBc3NlbWJseS5NZW1vcnkoIiArIEpTT04uc3RyaW5naWZ5KG0ubGltaXRzKSArICIpIik7CiAgfSk7CgogIGlmIChjb3VudE1lbW9yaWVzIHx8IG1lbW9yaWVzLmxlbmd0aCA+IDApIHsKICAgIHB1c2hMaW5lKCJ2YXIgbWVtb3J5U2l6ZSA9IE0wLmJ1ZmZlci5ieXRlTGVuZ3RoIik7CiAgICBwdXNoTGluZSgidmFyIEhJOCA9IG5ldyBJbnQ4QXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoInZhciBISTE2ID0gbmV3IEludDE2QXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoInZhciBISTMyID0gbmV3IEludDMyQXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoInZhciBIVTggPSBuZXcgVWludDhBcnJheShNMC5idWZmZXIpIik7CiAgICBwdXNoTGluZSgidmFyIEhVMTYgPSBuZXcgVWludDE2QXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoInZhciBIVTMyID0gbmV3IFVpbnQzMkFycmF5KE0wLmJ1ZmZlcikiKTsKICAgIHB1c2hMaW5lKCJ2YXIgSEYzMiA9IG5ldyBGbG9hdDMyQXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoInZhciBIRjY0ID0gbmV3IEZsb2F0NjRBcnJheShNMC5idWZmZXIpIik7CiAgICBwdXNoTGluZSgidmFyIEhEViA9IG5ldyBEYXRhVmlldyhNMC5idWZmZXIpIik7CiAgICBwdXNoTGluZSgidmFyIG9uTWVtb3J5Q2hhbmdlID0gZnVuY3Rpb24oKSB7Iik7CiAgICBwdXNoTGluZSgiICBtZW1vcnlTaXplID0gTTAuYnVmZmVyLmJ5dGVMZW5ndGgiKTsKICAgIHB1c2hMaW5lKCIgIEhJOCA9IG5ldyBJbnQ4QXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoIiAgSEkxNiA9IG5ldyBJbnQxNkFycmF5KE0wLmJ1ZmZlcikiKTsKICAgIHB1c2hMaW5lKCIgIEhJMzIgPSBuZXcgSW50MzJBcnJheShNMC5idWZmZXIpIik7CiAgICBwdXNoTGluZSgiICBIVTggPSBuZXcgVWludDhBcnJheShNMC5idWZmZXIpIik7CiAgICBwdXNoTGluZSgiICBIVTE2ID0gbmV3IFVpbnQxNkFycmF5KE0wLmJ1ZmZlcikiKTsKICAgIHB1c2hMaW5lKCIgIEhVMzIgPSBuZXcgVWludDMyQXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoIiAgSEYzMiA9IG5ldyBGbG9hdDMyQXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoIiAgSEY2NCA9IG5ldyBGbG9hdDY0QXJyYXkoTTAuYnVmZmVyKSIpOwogICAgcHVzaExpbmUoIiAgSERWID0gbmV3IERhdGFWaWV3KE0wLmJ1ZmZlcikiKTsKICAgIHB1c2hMaW5lKCJ9Iik7CiAgICBwdXNoTGluZSgiTTAuX29uQ2hhbmdlKG9uTWVtb3J5Q2hhbmdlKSIpOwogIH0KCiAgLy8gRGVjbGFyZSBnbG9iYWxzCgogIHZhciBnbG9iYWxzID0gc2VjdGlvbnNbU0VDVElPTlMuR0xPQkFMXSB8fCBbXTsKICBpZiAoZ2xvYmFscy5sZW5ndGggPiAwKSB7CiAgICBwdXNoTGluZSgiXG4vLyAgRGVmaW5lIGdsb2JhbHNcbiIpOwogIH0KICBnbG9iYWxzLmZvckVhY2goZnVuY3Rpb24oZywgaWR4KSB7CiAgICBwdXNoTGluZSgidmFyIEciICsgKGlkeCArIGNvdW50R2xvYmFscykgKyAiID0gIiArIGcuaW5pdC5qc2V4cHIpOwogIH0pOwoKICAvLyBSZW5kZXIgdGhlIGNvZGUgZm9yIGVhY2ggZnVuY3Rpb24uCgogIHZhciBjb2RlID0gc2VjdGlvbnNbU0VDVElPTlMuQ09ERV0gfHwgW107CiAgaWYgKGNvZGUubGVuZ3RoID4gMCkgewogICAgcHVzaExpbmUoIlxuLy8gIEZ1bmN0aW9uIGRlZmluaXRpb25zXG4iKTsKICB9CiAgY29kZS5mb3JFYWNoKGZ1bmN0aW9uKGYsIGlkeCkgewogICAgZi5jb2RlLmhlYWRlcl9saW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGxuKSB7CiAgICAgIHB1c2hMaW5lKGxuKTsKICAgIH0pOwogICAgZi5jb2RlLmJvZHlfbGluZXMuZm9yRWFjaChmdW5jdGlvbihsbikgewogICAgICBwdXNoTGluZShsbik7CiAgICB9KTsKICAgIGYuY29kZS5mb290ZXJfbGluZXMuZm9yRWFjaChmdW5jdGlvbihsbikgewogICAgICBwdXNoTGluZShsbik7CiAgICB9KTsKICAgIHB1c2hMaW5lKGYubmFtZSArICIuX3dhc21UeXBlU2lnU3RyID0gJyIgKyBmLnNpZ1N0ciArICInIik7CiAgICBwdXNoTGluZShmLm5hbWUgKyAiLl93YXNtSlNXcmFwcGVyID0gbnVsbCIpOwogICAgcHVzaExpbmUoIiIpOwogIH0pOwoKICAvLyBGaWxsIHRoZSB0YWJsZSB3aXRoIGRlZmluZWQgZWxlbWVudHMsIGlmIGFueS4KCiAgdmFyIGVsZW1lbnRzID0gc2VjdGlvbnNbU0VDVElPTlMuRUxFTUVOVF0gfHwgW107CiAgaWYgKGVsZW1lbnRzLmxlbmd0aCA+IDApIHsKICAgIHB1c2hMaW5lKCJcbi8vICBUYWJsZSBlbGVtZW50IGluaXRpYWxpemF0aW9uXG4iKTsKICB9CiAgZWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbihlLCBpZHgpIHsKICAgIHB1c2hMaW5lKCJpZiAoKCIgKyBlLm9mZnNldC5qc2V4cHIgKyAiICsgIiArIGUuZWxlbXMubGVuZ3RoICsgIiAtIDEpID49IFQiICsgZS5pbmRleCArICIubGVuZ3RoKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoJ3RhYmxlIG91dCBvZiBib3VuZHMnKSB9Iik7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGUuZWxlbXMubGVuZ3RoOyBpKyspIHsKICAgICAgcHVzaExpbmUoIlQiICsgZS5pbmRleCArICJbKCIgKyAoZXZhbChlLm9mZnNldC5qc2V4cHIgKyAiICsgIiArIGkpKSArICIpXSA9IEYiICsgZS5lbGVtc1tpXSk7CiAgICB9CiAgfSk7CgogIC8vIEZpbGwgdGhlIG1lbW9yeSB3aXRoIGRhdGEgZnJvbSB0aGUgbW9kdWxlLgoKICB2YXIgZGF0YXMgPSBzZWN0aW9uc1tTRUNUSU9OUy5EQVRBXSB8fCBbXTsKICBpZiAoZGF0YXMubGVuZ3RoID4gMCkgewogICAgcHVzaExpbmUoIlxuLy8gIE1lbW9yeSBkYXRhIGluaXRpYWxpemF0aW9uXG4iKTsKICB9CiAgZGF0YXMuZm9yRWFjaChmdW5jdGlvbihkLCBpZHgpIHsKICAgIGlmIChkLmRhdGEubGVuZ3RoID4gMCApIHsKICAgICAgcHVzaExpbmUoImlmICgoIiArIGQub2Zmc2V0LmpzZXhwciArICIgKyAiICsgZC5kYXRhLmxlbmd0aCArICIgLSAxKSA+PSBNMC5idWZmZXIuYnl0ZUxlbmd0aCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdtZW1vcnkgb3V0IG9mIGJvdW5kcycpIH0iKTsKICAgICAgLy8gU2V0IGluIGNodW5rcyB0byByZWR1Y2Ugc291cmNlIHN0cmluZyBzaXplLgogICAgICB2YXIgY2h1bmtTdGFydCA9IDA7CiAgICAgIHZhciBjaHVua0VuZCA9IE1hdGgubWluKDMyLCBkLmRhdGEubGVuZ3RoKTsKICAgICAgd2hpbGUgKGNodW5rU3RhcnQgPCBkLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgdmFyIGl0ZW1zID0gW107CiAgICAgICAgZm9yICh2YXIgaSA9IGNodW5rU3RhcnQ7IGkgPCBjaHVua0VuZDsgaSsrKSB7CiAgICAgICAgICBpdGVtcy5wdXNoKGQuZGF0YS5jaGFyQ29kZUF0KGkpKTsKICAgICAgICB9CiAgICAgICAgcHVzaExpbmUoIkhJOC5zZXQoWyIgKyBpdGVtcy5qb2luKCIsIikgKyAiXSwgKCIgKyBkLm9mZnNldC5qc2V4cHIgKyAiKSArICIgKyBjaHVua1N0YXJ0ICsgIikiKTsKICAgICAgICBjaHVua1N0YXJ0ID0gY2h1bmtFbmQ7CiAgICAgICAgY2h1bmtFbmQgPSBNYXRoLm1pbihjaHVua0VuZCArIDMyLCBkLmRhdGEubGVuZ3RoKTsKICAgICAgfQogICAgfQogIH0pOwoKICAvLyBSdW4gdGhlIGBzdGFydGAgZnVuY3Rpb24gaWYgaXQgZXhpc3RzLgoKICB2YXIgc3RhcnQgPSBzZWN0aW9uc1tTRUNUSU9OUy5TVEFSVF07CiAgaWYgKHN0YXJ0ICE9PSBudWxsKSB7CiAgICBwdXNoTGluZSgiXG4vLyAgUnVuIHRoZSBzdGFydCBmdW5jdGlvblxuIik7CiAgICBwdXNoTGluZSgiRiIgKyBzdGFydCArICIoKSIpOwogIH0KCiAgLy8gUmV0dXJuIHRoZSBleHBvcnRzIGFzIGFuIG9iamVjdC4KCiAgdmFyIGV4cG9ydHMgPSBzZWN0aW9uc1tTRUNUSU9OUy5FWFBPUlRdIHx8IFtdOwogIGlmIChleHBvcnRzLmxlbmd0aCA+IDApIHsKICAgIHB1c2hMaW5lKCJcbi8vICBFeHBvcnRzXG4iKTsKICB9CiAgcHVzaExpbmUoInZhciBleHBvcnRzID0ge30iKTsKICBleHBvcnRzLmZvckVhY2goZnVuY3Rpb24oZSwgaWR4KSB7CiAgICB2YXIgcmVmID0gInRyYXAoKSI7CiAgICBzd2l0Y2ggKGUua2luZCkgewogICAgICBjYXNlIEVYVEVSTkFMX0tJTkRTLkZVTkNUSU9OOgoJcmVmID0gIkYiICsgZS5pbmRleDsKCWJyZWFrCiAgICAgIGNhc2UgRVhURVJOQUxfS0lORFMuR0xPQkFMOgoJcmVmID0gIkciICsgZS5pbmRleDsKCWJyZWFrCiAgICAgIGNhc2UgRVhURVJOQUxfS0lORFMuTUVNT1JZOgoJcmVmID0gIk0iICsgZS5pbmRleDsKCWJyZWFrCiAgICAgIGNhc2UgRVhURVJOQUxfS0lORFMuVEFCTEU6CglyZWYgPSAiVCIgKyBlLmluZGV4OwoJYnJlYWsKICAgIH0KICAgIHB1c2hMaW5lKCJleHBvcnRzWyIgKyByZW5kZXJKU1ZhbHVlKGUuZmllbGQsIGNvbnN0YW50cykgKyAiXSA9ICIgKyByZWYpOwogIH0pOwogIHB1c2hMaW5lKCJyZXR1cm4gZXhwb3J0cyIpOwoKICAvLyBUaGF0J3MgaXQhICBDb21waWxlIGl0IGFzIGEgZnVuY3Rpb24gYW5kIHJldHVybiBpdC4KICAvLyBUaGUgY29kZSBpcyBwcm9iYWJseSB0b28gYmlnIHRvIHB1dCBpbnRvIGEgc3RyaW5nLi4uCiAgLy9wdXNoTGluZSgifSkiKQoKICB2YXIgc2l6ZSA9IDA7CiAgc3JjLmZvckVhY2goZnVuY3Rpb24obG4pIHsKICAgIHNpemUgKz0gbG4ubGVuZ3RoICsgMTsKICB9KTsKICBkdW1wKCJzY3JpcHQgc291cmNlIHNpemU6ICIsIHNpemUpOwovKgogIHZhciBvdXRwdXQgPSBuZXcgQXJyYXlCdWZmZXIoc2l6ZSkKICB2YXIgdmlldyA9IG5ldyBVaW50OEFycmF5KG91dHB1dCkKICBkdW1wKCJJIGFsbG9jYXRlZCB0aGUgYXJyYXlidWZmZXIsIGZpbGxpbmcgaXQuLi4iKQogIHZhciBpZHggPSAwCiAgc3JjLmZvckVhY2goZnVuY3Rpb24obG4pIHsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbG4ubGVuZ3RoOyBpKyspIHsKICAgICAgdmlld1tpZHgrK10gPSBsbi5jaGFyQ29kZUF0KGkpCiAgICB9CiAgICB2aWV3W2lkeCsrXSA9ICJcbiIuY2hhckNvZGVBdCgwKQogIH0pCiAgY29uc29sZS5sb2coIkkgZmlsbGVkIGl0ISBOb3cgaW5qZWN0aW5nIGludG8gdGhlIERPTSIpCiAgdmFyIGRhdGFVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKG5ldyBCbG9iKFt2aWV3XSkpOwogIHZhciBzY3JpcHRUYWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsKICB2YXIgY2xlYW51cCA9IGZ1bmN0aW9uKCkgewogICAgVVJMLnJldm9rZU9iamVjdFVSTChkYXRhVXJsKTsKICAgIHNjcmlwdFRhZy5yZW1vdmUoKTsKICB9CiAgc2NyaXB0VGFnLm9uZXJyb3IgPSBzY3JpcHRUYWcub25sb2FkID0gY2xlYW51cAogIHNjcmlwdFRhZy5zcmMgPSBkYXRhVXJsOwogIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0VGFnKTsKKi8KICBkdW1wKCJJIGZpbGxlZCBpdCEgTm93IGNvbnZlcnRpbmcgdG8gYSBzdHJpbmciKTsKICB0cnkgewogICAgLy92YXIgY29kZSA9IChuZXcgVGV4dERlY29kZXIoJ3V0Zi04JykpLmRlY29kZSh2aWV3KQogICAgdmFyIGNvZGUgPSBzcmMuam9pbigiIik7CiAgfSBjYXRjaCAoZXJyKSB7CiAgICBkdW1wKCJmYWlsZWQgdG8gbWFrZSBhIHN0cmluZyA6LSgiKTsKICAgIHRocm93IGVycgogIH0KICBkdW1wKCJtYWRlIGEgc3RyaW5nISIpOwogIC8vZHVtcChjb2RlKQogIC8vZHVtcCgiLS0tIikKICByZXR1cm4gbmV3IEZ1bmN0aW9uKCJXZWJBc3NlbWJseSIsICJpbXBvcnRzIiwgImNvbnN0YW50cyIsICJzdGRsaWIiLCBjb2RlKQp9CgovLwovLyBUaGUgYE1vZHVsZWAgb2JqZWN0LgovLwovLyBUaGlzIG9iamVjdCBjb29yZGluYXRlcyBwYXJzaW5nIHRoZSBXQVNNIGJ5dGVjb2RlCi8vIGFuZCBwcm92aWRpbmcgaXQgZm9yIGxpbmtpbmcgYXMgbGl2ZSBmdW5jdGlvbiBvYmplY3RzLgovLyBJdCBhbHNvIGxldHMgeW91IGludHJvc3BlY3Qgc29tZSBkZXRhaWxzIG9mIHRoZSBtb2R1bGUKLy8KCmZ1bmN0aW9uIE1vZHVsZShidWZmZXJTb3VyY2UpIHsKICBhc3NlcnRJc0RlZmluZWQodGhpcyk7CiAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXJGcm9tQnVmZmVyU291cmNlKGJ1ZmZlclNvdXJjZSkpOwogIHZhciBwYXJzZWQgPSBwYXJzZUJpbmFyeUVuY29kaW5nKGJ5dGVzKTsKICB0aGlzLl9pbnRlcm5hbHMgPSB7CiAgICBzZWN0aW9uczogcGFyc2VkLnNlY3Rpb25zLAogICAgY29uc3RhbnRzOiBwYXJzZWQuY29uc3RhbnRzLAogICAganNtb2R1bGU6IHJlbmRlclRvSlMocGFyc2VkLnNlY3Rpb25zLCBwYXJzZWQuY29uc3RhbnRzKQogIH07Cn0KCk1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gZXhwb3J0cyhtb2R1bGVPYmplY3QpIHsKICBhc3NlcnRJc0luc3RhbmNlKG1vZHVsZU9iamVjdCwgTW9kdWxlKTsKICB2YXIgZXhwb3J0cyA9IG1vZHVsZU9iamVjdC5faW50ZXJuYWxzLnNlY3Rpb25zW1NFQ1RJT05TLkVYUE9SVF0gfHwgW107CiAgcmV0dXJuIGV4cG9ydHMubWFwKGZ1bmN0aW9uKGUpIHsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGUuZmllbGQsIC8vIFhYWCBUT0RPOiBjb252ZXJ0IGZyb20gdXRmOAogICAgICBraW5kOiBFWFRFUk5BTF9LSU5EX05BTUVTW2Uua2luZF0KICAgIH0KICB9KQp9OwoKTW9kdWxlLmltcG9ydHMgPSBmdW5jdGlvbiBpbXBvcnRzKG1vZHVsZU9iamVjdCkgewogIGFzc2VydElzSW5zdGFuY2UobW9kdWxlT2JqZWN0LCBNb2R1bGUpOwogIHZhciBpbXBvcnRzID0gbW9kdWxlT2JqZWN0Ll9pbnRlcm5hbHMuc2VjdGlvbnNbU0VDVElPTlMuSU1QT1JUXSB8fCBbXTsKICByZXR1cm4gaW1wb3J0cy5tYXAoZnVuY3Rpb24oaSkgewogICAgcmV0dXJuIHsKICAgICAgbW9kdWxlOiBpLm1vZHVsZV9uYW1lLCAvLyBYWFggVE9ETzogY29udmVydCBmcm9tIHV0ZjgKICAgICAgbmFtZTogaS5pdGVtX25hbWUsIC8vIFhYWCBUT0RPOiBjb252ZXJ0IGZyb20gdXRmOAogICAgICBraW5kOiBFWFRFUk5BTF9LSU5EX05BTUVTW2kua2luZF0KICAgIH0KICB9KQp9OwoKTW9kdWxlLmN1c3RvbVNlY3Rpb25zID0gZnVuY3Rpb24gaW1wb3J0cyhtb2R1bGVPYmplY3QsIHNlY3Rpb25OYW1lKSB7CiAgYXNzZXJ0SXNJbnN0YW5jZShtb2R1bGVPYmplY3QsIE1vZHVsZSk7CiAgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvcignY3VzdG9tU2VjdGlvbnMgbm90IGltcGxlbWVudGVkIHlldCcpCn07CgpmdW5jdGlvbiBhcnJheUJ1ZmZlckZyb21CdWZmZXJTb3VyY2Uoc291cmNlKSB7CiAgaWYgKHNvdXJjZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSB7CiAgICByZXR1cm4gc291cmNlCiAgfQogIGNvbnN0IHZpZXdDbGFzc2VzID0gWwogICAgSW50OEFycmF5LAogICAgSW50MTZBcnJheSwKICAgIEludDMyQXJyYXksCiAgICBVaW50OEFycmF5LAogICAgVWludDE2QXJyYXksCiAgICBVaW50MzJBcnJheSwKICAgIFVpbnQ4Q2xhbXBlZEFycmF5LAogICAgRmxvYXQzMkFycmF5LAogICAgRmxvYXQ2NEFycmF5LAogICAgRGF0YVZpZXcKICBdOwogIGZvciAodmFyIGkgPSAwOyBpIDwgdmlld0NsYXNzZXMubGVuZ3RoOyBpKyspIHsKICAgIGlmIChzb3VyY2UgaW5zdGFuY2VvZiB2aWV3Q2xhc3Nlc1tpXSkgewogICAgICByZXR1cm4gc291cmNlLmJ1ZmZlcgogICAgfQogIH0KICByZXR1cm4gbnVsbAp9CgovLwovLyBUaGUgYFRhYmxlYCBvYmplY3QuCi8vCi8vIFRoaXMgaXMgYSBzdHJhaWdodGZvcndhcmQgd3JhcHBlciBhcm91bmQgYSBwbGFpbiBvbGQKLy8gSmF2YVNjcmlwdCBhcnJheS4KLy8KCmZ1bmN0aW9uIFRhYmxlKHRhYmxlRGVzY3JpcHRvcikgewogIGFzc2VydElzRGVmaW5lZCh0aGlzKTsKICBhc3NlcnRJc1R5cGUodGFibGVEZXNjcmlwdG9yLCAib2JqZWN0Iik7CiAgdmFyIGluaXRpYWwgPSBUb05vbldyYXBwaW5nVWludDMyKHRhYmxlRGVzY3JpcHRvci5pbml0aWFsKTsKICB2YXIgbWF4aW11bSA9IG51bGw7CiAgaWYgKHRhYmxlRGVzY3JpcHRvci5oYXNPd25Qcm9wZXJ0eSgibWF4aW11bSIpKSB7CiAgICBtYXhpbXVtID0gVG9Ob25XcmFwcGluZ1VpbnQzMih0YWJsZURlc2NyaXB0b3IubWF4aW11bSk7CiAgfQogIHZhciB2YWx1ZXMgPSBuZXcgQXJyYXkoaW5pdGlhbCk7CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbml0aWFsOyBpKyspIHsKICAgIHZhbHVlc1tpXSA9IG51bGw7CiAgfQogIHRoaXMuX2ludGVybmFscyA9IHsKICAgIHZhbHVlczogdmFsdWVzLAogICAgaW5pdGlhbDogaW5pdGlhbCwKICAgIG1heGltdW06IG1heGltdW0KICB9Owp9CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoVGFibGUucHJvdG90eXBlLCAibGVuZ3RoIiwgewogIGdldDogZnVuY3Rpb24oKSB7CiAgICBhc3NlcnRJc0luc3RhbmNlKHRoaXMsIFRhYmxlKTsKICAgIHJldHVybiB0aGlzLl9pbnRlcm5hbHMudmFsdWVzLmxlbmd0aAogIH0KfSk7CgpUYWJsZS5wcm90b3R5cGUuZ3JvdyA9IGZ1bmN0aW9uIGdyb3coZGVsdGEpIHsKICBhc3NlcnRJc0luc3RhbmNlKHRoaXMsIFRhYmxlKTsKICB2YXIgb2xkU2l6ZSA9IHRoaXMubGVuZ3RoOwogIHZhciBuZXdTaXplID0gb2xkU2l6ZSArIFRvTm9uV3JhcHBpbmdVaW50MzIoZGVsdGEpOwogIGlmIChuZXdTaXplIDwgb2xkU2l6ZSkgewogICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoKQogIH0KICBpZiAodGhpcy5faW50ZXJuYWxzLm1heGltdW0gIT09IG51bGwpIHsKICAgIGlmIChuZXdTaXplID4gdGhpcy5faW50ZXJuYWxzLm1heGltdW0pIHsKICAgICAgdGhyb3cgbmV3IFJhbmdlRXJyb3IoKQogICAgfQogIH0KICBmb3IgKHZhciBpID0gb2xkU2l6ZTsgaSA8IG5ld1NpemU7IGkrKykgewogICAgdGhpcy5faW50ZXJuYWxzLnZhbHVlcy5wdXNoKG51bGwpOwogIH0KICByZXR1cm4gb2xkU2l6ZQp9OwoKVGFibGUucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIGdldChpbmRleCkgewogIGFzc2VydElzSW5zdGFuY2UodGhpcywgVGFibGUpOwogIGluZGV4ID0gVG9Ob25XcmFwcGluZ1VpbnQzMihpbmRleCk7CiAgaWYgKGluZGV4ID49IHRoaXMuX2ludGVybmxzLnZhbHVlcy5sZW5ndGgpIHsKICAgIHRocm93IFJhbmdlRXJyb3IKICB9CiAgcmV0dXJuIHRoaXMuX2ludGVybmFscy52YWx1ZXNbaW5kZXhdCn07CgpUYWJsZS5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gc2V0KGluZGV4LCB2YWx1ZSkgewogIGFzc2VydElzSW5zdGFuY2UodGhpcywgVGFibGUpOwogIGluZGV4ID0gVG9Ob25XcmFwcGluZ1VpbnQzMihpbmRleCk7CiAgaWYgKGluZGV4ID49IHRoaXMuX2ludGVybmFscy52YWx1ZXMubGVuZ3RoKSB7CiAgICB0aHJvdyBSYW5nZUVycm9yCiAgfQogIHRoaXMuX2ludGVybmFscy52YWx1ZXNbaW5kZXhdID0gdmFsdWU7Cn07CgovLwovLyBUaGUgYE1lbW9yeWAgb2JqZWN0LgovLwovLyBXZSBkbyB0aGUgYmVzdCB3ZSBjYW4gdG8gaW1taXRhdGUgdGhlIGdyb3dhYmxlIG1lbW9yeSBvYmplY3RzCi8vIGZyb20gV0FTTSBvbiB0b3Agb2Ygbm9ybWFsIEFycmF5QnVmZmVycy4KLy8KLy8gT2YgcGFydGljdWxhciBpbnRlcmVzdCBoZXJlLCBpcyB0aGUgdXNlIG9mIGBfb25DaGFuZ2VgIGNhbGxiYWNrcwovLyB0byB0cmlnZ2VyIHJlY29uc3RydWN0aW9uIG9mIHRoZSBtZW1vcnkgc3RhdGUgb2YgYW55IGxpbmtlZAovLyBJbnN0YW5jZXMuICBXZSBleHBlY3QgY2hhbmdlcyB0byBiZSByYXJlIHNvIGl0IHNlZW1zIHZhbHVhYmxlCi8vIHRvIGhhdmUgdGhlIEluc3RhbmNlIHRha2UgYSBsb2NhbCByZWZlcmVuY2UgdG8gdGhlIGJ1ZmVyIGFuZAovLyByZXBsYWNlIGl0IHdoZW4gbmVjZXNzYXJ5LCByYXRoZXIgdGhhbiBhbHdheXMgZGVyZWZlcmVuY2luZyBpdAovLyBhZnJlc2ggZnJvbSB0aGUgTWVtb3J5IG9iamVjdC4KLy8KCmZ1bmN0aW9uIE1lbW9yeShtZW1vcnlEZXNjcmlwdG9yKSB7CiAgYXNzZXJ0SXNEZWZpbmVkKHRoaXMpOwogIGFzc2VydElzVHlwZShtZW1vcnlEZXNjcmlwdG9yLCAib2JqZWN0Iik7CiAgdmFyIGluaXRpYWwgPSBUb05vbldyYXBwaW5nVWludDMyKG1lbW9yeURlc2NyaXB0b3IuaW5pdGlhbCk7CiAgdmFyIG1heGltdW0gPSBudWxsOwogIGlmIChtZW1vcnlEZXNjcmlwdG9yLmhhc093blByb3BlcnR5KCJtYXhpbXVtIikpIHsKICAgIG1heGltdW0gPSBUb05vbldyYXBwaW5nVWludDMyKG1lbW9yeURlc2NyaXB0b3IubWF4aW11bSk7CiAgfQogIHRoaXMuX2ludGVybmFscyA9IHsKICAgIGJ1ZmZlcjogbmV3IEFycmF5QnVmZmVyKGluaXRpYWwgKiBQQUdFX1NJWkUpLAogICAgaW5pdGlhbDogaW5pdGlhbCwKICAgIGN1cnJlbnQ6IGluaXRpYWwsCiAgICBtYXhpbXVtOiBtYXhpbXVtLAogICAgY2FsbGJhY2tzOiBbXQogIH07Cn0KCi8vCi8vIFJlZ2lzdGVyIGEgY2FsbGJhY2sgdG8gYmUgZXhlY3V0ZWQgd2hlbiB0aGUgdW5kZXJseWluZwovLyBtZW1vcnkgYnVmZmVyIGNoYW5nZXMuCi8vCi8vIFhYWCBUT0RPOiBjYW4gd2UgdXNlIHdlYWtyZWZzIGZvciB0aGlzLCB0byBhdm9pZAovLyB0aGUgTWVtb3J5IGtlZXBpbmcgYWxsIGNvbm5lY3RlZCBpbnN0YW5jZXMgYWxpdmU/Ci8vIEkgc3VzcGVjdCBub3QsIGJ1dCB3b3J0aCBpbnZlc3RpZ2F0aW5nLgovLwpNZW1vcnkucHJvdG90eXBlLl9vbkNoYW5nZSA9IGZ1bmN0aW9uIF9vbkNoYW5nZShjYikgewogIHRoaXMuX2ludGVybmFscy5jYWxsYmFja3MucHVzaChjYik7Cn07CgpNZW1vcnkucHJvdG90eXBlLmdyb3cgPSBmdW5jdGlvbiBncm93KGRlbHRhKSB7CiAgdmFyIG9sZFNpemUgPSB0aGlzLl9ncm93KGRlbHRhKTsKICBpZiAob2xkU2l6ZSA8IDApIHsKICAgIHRocm93IG5ldyBSYW5nZUVycm9yKCkKICB9CiAgcmV0dXJuIG9sZFNpemUKfTsKCk1lbW9yeS5wcm90b3R5cGUuX2dyb3cgPSBmdW5jdGlvbiBfZ3JvdyhkZWx0YSkgewogIGFzc2VydElzSW5zdGFuY2UodGhpcywgTWVtb3J5KTsKICB2YXIgb2xkU2l6ZSA9IHRoaXMuX2ludGVybmFscy5jdXJyZW50OwogIGRlbHRhID0gVG9Ob25XcmFwcGluZ1VpbnQzMihkZWx0YSk7CiAgaWYgKGRlbHRhID4gNjU1MzYpIHsKICAgIHJldHVybiAtMQogIH0KICB2YXIgbmV3U2l6ZSA9IG9sZFNpemUgKyBkZWx0YTsKICBpZiAodGhpcy5faW50ZXJuYWxzLm1heGltdW0pIHsKICAgIGlmIChuZXdTaXplID4gdGhpcy5faW50ZXJuYWxzLm1heGltdW0pIHsKICAgICAgcmV0dXJuIC0xCiAgICB9CiAgfQogIGlmIChuZXdTaXplID4gNjU1MzYpIHsKICAgIHJldHVybiAtMQogIH0KICB2YXIgbmV3QnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKG5ld1NpemUgKiBQQUdFX1NJWkUpOwogIC8vIFhYWCBUT0RPIG1vcmUgZWZmaWNpZW50IGNvcHkgb2YgdGhlIG9sZCBidWZmZXI/CiAgbmV3IFVpbnQ4QXJyYXkobmV3QnVmZmVyKS5zZXQobmV3IFVpbnQ4QXJyYXkodGhpcy5faW50ZXJuYWxzLmJ1ZmZlcikpOwogIC8vIFhYWCBUT0RPOiBjbGVhbmx5IGRldGFjaCB0aGUgb2xkIGJ1ZmZlcgogIHRoaXMuX2ludGVybmFscy5idWZmZXIgPSBuZXdCdWZmZXI7CiAgdGhpcy5faW50ZXJuYWxzLmN1cnJlbnQgPSBuZXdTaXplOwogIC8vIE5vdGlmeSBsaXN0ZW5lcnMgdGhhdCB0aGluZ3MgaGF2ZSBjaGFuZ2VkLgogIHRoaXMuX2ludGVybmFscy5jYWxsYmFja3MuZm9yRWFjaChmdW5jdGlvbiAoY2IpewogICAgY2IoKTsKICB9KTsKICByZXR1cm4gb2xkU2l6ZQp9OwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KE1lbW9yeS5wcm90b3R5cGUsICJidWZmZXIiLCB7CiAgLy8gWFhYIFRPRE86IGRvIEkgbmVlZCB0byBkbyBhbnl0aGluZyB0byBwcmV2ZW50IHRocyBidWZmZXIKICAvLyBmcm9tIGJlaW5nIGRldGFjaGVkIGJ5IGNvZGUgdGhhdCBnZXRzIGl0PwogIGdldDogZnVuY3Rpb24oKSB7CiAgICBhc3NlcnRJc0luc3RhbmNlKHRoaXMsIE1lbW9yeSk7CiAgICByZXR1cm4gdGhpcy5faW50ZXJuYWxzLmJ1ZmZlcgogIH0KfSk7CgovLwovLyBUaGUgYEluc3RhbmNlYCBvYmplY3QuCi8vCi8vIFRoaXMgb2JqZWN0IHRha2VzIGEgY29tcGlsZWQgbW9kdWxlIGFuZCBwcm92aWRlcyB0aGUKLy8gbmVjZXNzYXJ5IHJ1bi10aW1lIGRhdGEgdG8gbWFrZSBsaXZlIGZ1bmN0aW9uIG9iamVjdHMuCi8vIEl0J3Mgd2hlcmUgd2UgY29vcmRpbmF0ZSB0aGUgZGV0YWlscyBvZiBwYXNzaW5nIHZhbHVlcwovLyBiYWNrLWFuZC1mb3J0aCBiZXR3ZWVuIEpTIGFuZCBXQVNNLgovLwoKZnVuY3Rpb24gSW5zdGFuY2UobW9kdWxlT2JqZWN0LCBpbXBvcnRPYmplY3QpIHsKICBhc3NlcnRJc0RlZmluZWQodGhpcyk7CiAgYXNzZXJ0SXNJbnN0YW5jZShtb2R1bGVPYmplY3QsIE1vZHVsZSk7CiAgaWYgKHR5cGVvZiBpbXBvcnRPYmplY3QgIT09ICJ1bmRlZmluZWQiKSB7CiAgICBpZiAodHlwZW9mIGltcG9ydE9iamVjdCAhPT0gIm9iamVjdCIpIHsKICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpCiAgICB9CiAgfQoKICAvLyBDb2xsZWN0LCB0eXBlLWNoZWNrIGFuZCBjb2VyY2UgdGhlIGltcG9ydHMuCgogIHZhciBzZWN0aW9ucyA9IG1vZHVsZU9iamVjdC5faW50ZXJuYWxzLnNlY3Rpb25zOwogIHZhciBpbXBvcnRzID0gW107CiAgKHNlY3Rpb25zW1NFQ1RJT05TLklNUE9SVF0gfHwgW10pLmZvckVhY2goZnVuY3Rpb24oaSkgewogICAgdmFyIG8gPSBpbXBvcnRPYmplY3RbaS5tb2R1bGVfbmFtZV07CiAgICBhc3NlcnRJc0luc3RhbmNlKG8sIE9iamVjdCk7CiAgICB2YXIgdiA9IG9baS5pdGVtX25hbWVdOwogICAgaWYgKHR5cGVvZiB2ID09PSAidW5kZWZpbmVkIikgewogICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJjYW5ub3QgaW1wb3J0IHVuZGVmaW5lZCIpCiAgICB9CiAgICBzd2l0Y2goaS5raW5kKSB7CiAgICAgIGNhc2UgRVhURVJOQUxfS0lORFMuRlVOQ1RJT046CiAgICAgICAgYXNzZXJ0SXNDYWxsYWJsZSh2KTsKICAgICAgICBpZiAoISB2Ll93YXNtUmF3RnVuYykgewogICAgICAgICAgLy8gSWYgdGhpcyBpcyBub3QgYSBmdW5jdGlvbiBmcm9tIGFub3RoZXIgV0FTTSBpbnN0YW5jZSwgdGhlbiB3ZQogICAgICAgICAgLy8gaGF2ZSB0byBjb252ZXJ0IGFyZ3MgYW5kIHJldHVybiB2YWx1ZXMgYmV0d2VlbiBXQVNNIGFuZCBKUyBzZW1hbnRpY3MuCiAgICAgICAgICAvLyBYWFggVE9ETzogd2UgY291bGQgcHJvYmFibHkgbWFrZSBhIG1vcmUgZWZmaWNpZW50IHRyYW5zbGF0aW9uIGxheWVyLi4uCiAgICAgICAgICB2YXIgdHlwID0gc2VjdGlvbnNbU0VDVElPTlMuVFlQRV1baS50eXBlXTsKICAgICAgICAgIGltcG9ydHMucHVzaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgdmFyIGFyZ3MgPSBbXTsKICAgICAgICAgICAgdmFyIG9yaWdBcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgICB0eXAucGFyYW1fdHlwZXMuZm9yRWFjaChmdW5jdGlvbihwYXJhbV90eXAsIGlkeCkgewogICAgICAgICAgICAgIGFyZ3MucHVzaChUb0pTVmFsdWUob3JpZ0FyZ3NbaWR4XSwgcGFyYW1fdHlwKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgcmVzID0gdi5hcHBseSh1bmRlZmluZWQsIGFyZ3MpOwogICAgICAgICAgICBpZiAodHlwLnJldHVybl90eXBlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgcmVzID0gVG9XQVNNVmFsdWUocmVzLCB0eXAucmV0dXJuX3R5cGVzWzBdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8gSWYgaW1wb3J0aW5nIGZ1bmN0aW9ucyBmcm9tIGFub3RoZXIgV0FTTSBpbnN0YW5jZSwKICAgICAgICAgIC8vIHdlIGNhbiBzaG9ydGN1dCAqYW5kKiB3ZSBjYW4gZG8gbW9yZSB0eXBlY2hlY2tpbmcuCiAgICAgICAgICBpZiAodi5fd2FzbVJhd0Z1bmMuX3dhc21UeXBlU2lnU3RyICE9PSBtYWtlU2lnU3RyKHNlY3Rpb25zW1NFQ1RJT05TLlRZUEVdW2kudHlwZV0pKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoImZ1bmN0aW9uIGltcG9ydCB0eXBlIG1pcy1tYXRjaCIpCiAgICAgICAgICB9CiAgICAgICAgICBpbXBvcnRzLnB1c2godi5fd2FzbVJhd0Z1bmMpOwogICAgICAgIH0KICAgICAgICBicmVhawogICAgICBjYXNlIEVYVEVSTkFMX0tJTkRTLkdMT0JBTDoKICAgICAgICBpbXBvcnRzLnB1c2goVG9XQVNNVmFsdWUodiwgaS50eXBlLmNvbnRlbnRfdHlwZSkpOwogICAgICAgIGJyZWFrCiAgICAgIGNhc2UgRVhURVJOQUxfS0lORFMuTUVNT1JZOgogICAgICAgIGFzc2VydElzSW5zdGFuY2UodiwgTWVtb3J5KTsKICAgICAgICBpZiAodi5faW50ZXJuYWxzLmN1cnJlbnQgPCBpLnR5cGUubGltaXRzLmluaXRpYWwpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1lbW9yeSBpbXBvcnQgdG9vIHNtYWxsIikKICAgICAgICB9CiAgICAgICAgaWYgKGkudHlwZS5saW1pdHMubWF4aW11bSkgewogICAgICAgICAgaWYgKHYuX2ludGVybmFscy5jdXJyZW50ID4gaS50eXBlLmxpbWl0cy5tYXhpbXVtKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1lbW9yeSBpbXBvcnQgdG9vIGJpZyIpCiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXYuX2ludGVybmFscy5tYXhpbXVtIHx8IHYuX2ludGVybmFscy5tYXhpbXVtID4gaS50eXBlLmxpbWl0cy5tYXhpbXVtKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIm1lbW9yeSBpbXBvcnQgaGFzIHRvbyBsYXJnZSBhIG1heGltdW0iKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpbXBvcnRzLnB1c2godik7CiAgICAgICAgYnJlYWsKICAgICAgY2FzZSBFWFRFUk5BTF9LSU5EUy5UQUJMRToKICAgICAgICBhc3NlcnRJc0luc3RhbmNlKHYsIFRhYmxlKTsKICAgICAgICBpZiAodi5sZW5ndGggPCBpLnR5cGUubGltaXRzLmluaXRpYWwpIHsKICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoInRhYmxlIGltcG9ydCB0b28gc21hbGwiKQogICAgICAgIH0KICAgICAgICBpZiAoaS50eXBlLmxpbWl0cy5tYXhpbXVtKSB7CiAgICAgICAgICBpZiAodi5sZW5ndGggPiBpLnR5cGUubGltaXRzLm1heGltdW0pIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigidGFibGUgaW1wb3J0IHRvbyBiaWciKQogICAgICAgICAgfQogICAgICAgICAgaWYgKCF2Ll9pbnRlcm5hbHMubWF4aW11bSB8fCB2Ll9pbnRlcm5hbHMubWF4aW11bSA+IGkudHlwZS5saW1pdHMubWF4aW11bSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCJ0YWJsZSBpbXBvcnQgaGFzIHRvbyBsYXJnZSBhIG1heGltdW0iKQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpbXBvcnRzLnB1c2godik7CiAgICAgICAgYnJlYWsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgUnVudGltZUVycm9yJDEoInVuZXhwZWN0ZWQgaW1wb3J0IGtpbmQ6ICIgKyBpLmtpbmQpCiAgICB9CiAgfSk7CgogIC8vIEluc3RhbnRpYXRlIHRoZSBjb21waWxlZCBqYXZhc2NyaXB0IG1vZHVsZSwgd2hpY2ggd2lsbCBnaXZlIHVzIGFsbCB0aGUgZXhwb3J0cy4KICB2YXIgY29uc3RhbnRzID0gbW9kdWxlT2JqZWN0Ll9pbnRlcm5hbHMuY29uc3RhbnRzOwogIHRoaXMuX2V4cG9ydHMgPSBtb2R1bGVPYmplY3QuX2ludGVybmFscy5qc21vZHVsZShXZWJBc3NlbWJseSQxLCBpbXBvcnRzLCBjb25zdGFudHMsIHN0ZGxpYiQxKTsKICB0aGlzLmV4cG9ydHMgPSB7fTsKICB2YXIgc2VsZiA9IHRoaXM7CiAgKG1vZHVsZU9iamVjdC5faW50ZXJuYWxzLnNlY3Rpb25zW1NFQ1RJT05TLkVYUE9SVF0gfHwgW10pLmZvckVhY2goZnVuY3Rpb24oZSkgewogICAgc3dpdGNoIChlLmtpbmQpIHsKICAgICAgY2FzZSBFWFRFUk5BTF9LSU5EUy5GVU5DVElPTjoKICAgICAgICB2YXIgd2FzbUZ1bmMgPSBzZWxmLl9leHBvcnRzW2UuZmllbGRdOwogICAgICAgIC8vIFdyYXAgZXhwb3J0ZWQgZnVuY3Rpb25zIHRvIGNvbnZlcnQgYmV0d2VlbiBKUyBhbmQgV0FTTSB2YWx1ZSBzZW1hbnRpY3MuCiAgICAgICAgLy8gV2UgY2FjaGUgdGhlIHdyYXBwZXIgb24gdGhlIGZ1bmN0aW9uLgogICAgICAgIGlmICghd2FzbUZ1bmMuX3dhc21KU1dyYXBwZXIpIHsKICAgICAgICAgIHdhc21GdW5jLl93YXNtSlNXcmFwcGVyID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAvLyBUeXBlLWNoZWNrIGFuZCBjb2VyY2UgYXJndW1lbnRzLgogICAgICAgICAgICAvLyBYWFggVE9ETzogd2UgY291bGQgcHJvYmFibHkgdXNlIHJhdyB0eXBlIGluZm8gcmF0aGVyIHRoYW4gc2lnc3RyIGhlcmUuCiAgICAgICAgICAgIC8vIFhYWCBUT0RPOiBjYW4gd2UgY29tZSB1cCB3aXRoIGEgbW9yZSBlZmZpY2llbnQgc3lzdGVtIGZvciB0aGlzLCBvbmUKICAgICAgICAgICAgLy8gdGhhdCBkb2Vzbid0IHVzZSB0aGUgYGFyZ3VtZW50c2Agb2JqZWN0IGluIGNvbW1vbiBjYXNlcz8KICAgICAgICAgICAgLy9jb25zb2xlLmxvZygiTUVNT1JZPyIsIG5ldyBVaW50MzJBcnJheShzZWxmLmV4cG9ydHNbIm1lbW9yeSJdLmJ1ZmZlci5zbGljZSgwLDY0KSkpCiAgICAgICAgICAgIC8vY29uc29sZS5sb2coIkNBTExJTkcgRVhQT1JURUQiLCB3YXNtRnVuYy5fd2FzbVR5cGVTaWdTdHIsIHdhc21GdW5jKQogICAgICAgICAgICAvL2lmICh3YXNtRnVuYy5uYW1lID09PSAnRjE4NTM5JykgewogICAgICAgICAgICAvLyAgY29uc29sZS5sb2cod2FzbUZ1bmMudG9TdHJpbmcoKSkKICAgICAgICAgICAgLy99CiAgICAgICAgICAgIC8vIGFsc28gIkY4MDk5IgogICAgICAgICAgICB2YXIgYXJncyA9IFtdOwogICAgICAgICAgICBBUkdMT09QOiBmb3IgKHZhciBpID0gMDsgaSA8IHdhc21GdW5jLl93YXNtVHlwZVNpZ1N0ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIHN3aXRjaCAod2FzbUZ1bmMuX3dhc21UeXBlU2lnU3RyLmNoYXJBdChpKSkgewogICAgICAgICAgICAgICAgY2FzZSAnaSc6CiAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaChhcmd1bWVudHNbaV18MCk7CiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlICdsJzoKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFcnJvciQxKCJjYW5ub3QgcGFzcyBpNjQgZnJvbSBqczogIiArIGFyZ3VtZW50c1tpXSkKICAgICAgICAgICAgICAgIGNhc2UgJ2YnOgogICAgICAgICAgICAgICAgICBhcmdzLnB1c2goTWF0aC5mcm91bmQoK2FyZ3VtZW50c1tpXSkpOwogICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY2FzZSAnZCc6CiAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCgrYXJndW1lbnRzW2ldKTsKICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgJy0nOgogICAgICAgICAgICAgICAgICBicmVhayBBUkdMT09QCiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUVycm9yJDEoIm1hbGZvcm1lZCBfd2FzbVR5cGVTaWdTdHIiKQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIiAgQVJHUyIsIGFyZ3MpCiAgICAgICAgICAgICAgdmFyIHJlcyA9IHdhc21GdW5jLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgICAgICAgICAgIC8vY29uc29sZS5sb2coIiAgUkVTVUxUIiwgcmVzKQogICAgICAgICAgICAgIHJldHVybiByZXMKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy8gRm9yIHRlc3QgY29tcGF0aWJpbHR5LCB3ZSB3YW50IHN0YWNrIHNwYWNlIGV4aGF1c3Rpb24gdG8gdHJhcC4KICAgICAgICAgICAgICAvLyBYWFggVE9ETzogdGhpcyBjYW4ndCByZWFsbHkgYmUgbmVjZXNzYXJ5IGluIHByYWN0aWNlLCByaWdodD8KICAgICAgICAgICAgICAvLyBTdXJlbHkganVzdCBwYXNzaW5nIHRocm91Z2ggdGhlIFJhbmdlRXJyb3Igd291bGQgc3VmZmljZT8KICAgICAgICAgICAgICBpZiAoZXJyIGluc3RhbmNlb2YgUmFuZ2VFcnJvcikgewogICAgICAgICAgICAgICAgaWYgKGVyci5tZXNzYWdlLmluZGV4T2YoImNhbGwgc3RhY2siKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXJyb3IkMSgiY2FsbCBzdGFjayBleGhhdXN0ZWQiKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyBlcnIKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHdhc21GdW5jLl93YXNtSlNXcmFwcGVyLl93YXNtUmF3RnVuYyA9IHdhc21GdW5jOwogICAgICAgIH0KICAgICAgICBzZWxmLmV4cG9ydHNbZS5maWVsZF0gPSB3YXNtRnVuYy5fd2FzbUpTV3JhcHBlcjsKICAgICAgICBicmVhawogICAgICBkZWZhdWx0OgogICAgICAgIHNlbGYuZXhwb3J0c1tlLmZpZWxkXSA9IHNlbGYuX2V4cG9ydHNbZS5maWVsZF07CiAgICB9CiAgfSk7Cn0KCi8vCi8vIFRoZSB0b3AtbGV2ZWwgYFdlYkFzc2VtYmx5YCBvYmplY3QuCi8vCi8vIFRoaXMgZXhwb3NlcyBhbiBvYmplY3QgbWltaWNpbmcsIGFzIGNsb3NlbHkgYXMgd2UgY2FuLAovLyB0aGUgbmFzY2VudCBgV2ViQXNzZW1ibHlgIGphdmFzY3JpcHQgQVBJIGRlc2NyaWJlZCBhdAovLwovLyAgICBodHRwOi8vd2ViYXNzZW1ibHkub3JnL2RvY3MvanMKLy8KLy8gWW91IGNhbiB1c2UgaXQgdG8gaW5zdGFudGlhdGUgYmluYXJ5IFdlYkFzc2VtYmx5IGNvZGUKLy8gaW50byBydW5uYWJsZSBKYXZhU2NyaXB0IG9iamVjdHMsIGFsdGhvdWdoIHlvdSdsbCBsaWtlbHkKLy8gYmUgZGlzYXBwb2ludGVkIHdpdGggdGhlIHBlcmZvcm1hbmNlIGNvbXBhcmVkIHRvIGEgbmF0aXZlCi8vIGJyb3dzZXIgaW1wbGVtZW50YXRpb24uLi4KLy8KCnZhciBXZWJBc3NlbWJseSQxID0gewogIE1vZHVsZTogTW9kdWxlLAogIEluc3RhbmNlOiBJbnN0YW5jZSwKICBNZW1vcnk6IE1lbW9yeSwKICBUYWJsZTogVGFibGUsCiAgQ29tcGlsZUVycm9yOiBDb21waWxlRXJyb3IkMSwKICBMaW5rRXJyb3I6IExpbmtFcnJvciwKICBSdW50aW1lRXJyb3I6IFJ1bnRpbWVFcnJvciQxLAogIGNvbXBpbGU6IGNvbXBpbGUsCiAgaW5zdGFudGlhdGU6IGluc3RhbnRpYXRlLAogIHZhbGlkYXRlOiB2YWxpZGF0ZSwKCiAgLy8gU29tZSBwcml2YXRlIHRoaW5ncyBmb3Igb3VyIG93biBjb252ZW5pZW5jZQogIF9Mb25nOiBsb25nXzEsCiAgX2Zyb21OYU5CeXRlczogX2Zyb21OYU5CeXRlcywKICBfZHVtcDogZHVtcAp9OwoKCmZ1bmN0aW9uIHZhbGlkYXRlKGJ5dGVzKSB7CiAgdHJ5IHsKICAgIG5ldyBNb2R1bGUoYnl0ZXMpOwogIH0gY2F0Y2ggKGVycikgewogICAgaWYgKGVyciBpbnN0YW5jZW9mIENvbXBpbGVFcnJvciQxKSB7CiAgICAgIHJldHVybiBmYWxzZQogICAgfQogICAgdGhyb3cgZXJyCiAgfQogIHJldHVybiB0cnVlCn0KCmZ1bmN0aW9uIGNvbXBpbGUoYnl0ZXMpIHsKICAvLyBUaGUgcGFyc2luZyBhbmQgY29tcGlsYXRpb24gaGVyZSBpcyBzeW5jaHJvbm91cywgYnV0IHdlIHJldHVybgogIC8vIGEgcHJvbWlzZSBmb3IgQVBJIGNvbnNpc3RlbmN5LiAgSWYgd2UgbW92ZSBpdCB0byBiZWluZyBhc3luY2hyb25vdXMKICAvLyB0aGVuIGl0J3MgaW1wb3J0YW50IHRoYXQgd2UgKHNlbWFudGljYWxseSkgb3BlcmF0ZSBvbiBhIGNvcHkgb2YKICAvLyB0aGUgc3RhdGUgb2YgYnl0ZXMgYXQgdGhlIHRpbWUgdGhpcyBmdW5jdGlvbiB3YXMgY2FsbGVkLgogIHRyeSB7CiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBNb2R1bGUoYnl0ZXMpKQogIH0gY2F0Y2ggKGVycikgewogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycikKICB9Cn0KCmZ1bmN0aW9uIGluc3RhbnRpYXRlKGJ5dGVzT3JNb2R1bGVPYmplY3QsIGltcG9ydE9iamVjdCkgewogIGlmIChieXRlc09yTW9kdWxlT2JqZWN0IGluc3RhbmNlb2YgTW9kdWxlKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICByZXNvbHZlKG5ldyBJbnN0YW5jZShieXRlc09yTW9kdWxlT2JqZWN0LCBpbXBvcnRPYmplY3QpKTsKICAgIH0pCiAgfQogIHJldHVybiBjb21waWxlKGJ5dGVzT3JNb2R1bGVPYmplY3QpLnRoZW4oZnVuY3Rpb24obSkgewogICAgcmV0dXJuIGluc3RhbnRpYXRlKG0sIGltcG9ydE9iamVjdCkudGhlbihmdW5jdGlvbihpKSB7CiAgICAgIHJldHVybiB7bW9kdWxlOiBtLCBpbnN0YW5jZTogaX0KICAgIH0pCiAgfSkKfQoKcmV0dXJuIFdlYkFzc2VtYmx5JDE7Cgp9KSkpOwo='

if (typeof window.wrappedJSObject.WebAssembly === 'undefined') {
  window.wrappedJSObject.eval(atob(src))
}